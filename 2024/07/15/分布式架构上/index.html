<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="1、分布式架构-演变">
<meta property="og:type" content="article">
<meta property="og:title" content="分布式架构上">
<meta property="og:url" content="http://example.com/2024/07/15/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%E4%B8%8A/index.html">
<meta property="og:site_name" content="进学阁">
<meta property="og:description" content="1、分布式架构-演变">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.fbbizyy.com/yuque/0/2022/png/1581532/1648273278095-383d560f-e330-4d5a-974d-e1c742f323f6.png?x-oss-process=image/resize,w_1170,limit_0">
<meta property="og:image" content="https://cdn.fbbizyy.com/yuque/0/2021/png/1581532/1609853952424-0478e92a-57c0-4cd7-9454-67c0072384ab.png">
<meta property="article:published_time" content="2024-07-14T16:00:00.000Z">
<meta property="article:modified_time" content="2025-03-06T09:55:27.166Z">
<meta property="article:author" content="139">
<meta property="article:tag" content="mysql">
<meta property="article:tag" content="分布式">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.fbbizyy.com/yuque/0/2022/png/1581532/1648273278095-383d560f-e330-4d5a-974d-e1c742f323f6.png?x-oss-process=image/resize,w_1170,limit_0">

<link rel="canonical" href="http://example.com/2024/07/15/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%E4%B8%8A/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>分布式架构上 | 进学阁</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">进学阁</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">业精于勤荒于嬉，行成于思毁于随</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">38</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">8</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">54</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/07/15/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%E4%B8%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/custom/avatar.jpg">
      <meta itemprop="name" content="139">
      <meta itemprop="description" content="一个普通的JAVA开发的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="进学阁">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          分布式架构上
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-07-15 00:00:00" itemprop="dateCreated datePublished" datetime="2024-07-15T00:00:00+08:00">2024-07-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-06 17:55:27" itemprop="dateModified" datetime="2025-03-06T17:55:27+08:00">2025-03-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="1、分布式架构-演变"><a href="#1、分布式架构-演变" class="headerlink" title="1、分布式架构-演变"></a>1、分布式架构-演变</h1><p><img src="https://cdn.fbbizyy.com/yuque/0/2022/png/1581532/1648273278095-383d560f-e330-4d5a-974d-e1c742f323f6.png?x-oss-process=image/resize,w_1170,limit_0"></p>
<span id="more"></span>
<h1 id="2、基础架构介绍"><a href="#2、基础架构介绍" class="headerlink" title="2、基础架构介绍"></a>2、基础架构介绍</h1><h2 id="2-1-环境准备："><a href="#2-1-环境准备：" class="headerlink" title="2.1 环境准备："></a>2.1 环境准备：</h2><ul>
<li>两台虚拟机 db01 db02 </li>
<li>每台创建四个mysql实例：3307  3308   &#x2F; 3309 3310  </li>
<li><img src="https://cdn.fbbizyy.com/yuque/0/2021/png/1581532/1609853952424-0478e92a-57c0-4cd7-9454-67c0072384ab.png"></li>
</ul>
<h2 id="2-2-删除历史环境："><a href="#2-2-删除历史环境：" class="headerlink" title="2.2 删除历史环境："></a>2.2 删除历史环境：</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pkill mysqld</span><br><span class="line">rm -rf /data/330*</span><br><span class="line">mv /etc/my.cnf /etc/my.cnf.bak</span><br></pre></td></tr></table></figure>

<h2 id="2-3-创建相关目录初始化数据"><a href="#2-3-创建相关目录初始化数据" class="headerlink" title="2.3 创建相关目录初始化数据"></a>2.3 创建相关目录初始化数据</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/33&#123;07..10&#125;/data -p</span><br><span class="line">mysqld --initialize-insecure --user=mysql --datadir=/data/3307/data --</span><br><span class="line">basedir=/data/app/mysql</span><br><span class="line">mysqld --initialize-insecure --user=mysql --datadir=/data/3308/data --</span><br><span class="line">basedir=/data/app/mysql</span><br><span class="line">mysqld --initialize-insecure --user=mysql --datadir=/data/3309/data --</span><br><span class="line">basedir=/data/app/mysql</span><br><span class="line">mysqld --initialize-insecure --user=mysql --datadir=/data/3310/data --</span><br><span class="line">basedir=/data/app/mysql</span><br></pre></td></tr></table></figure>

<h2 id="2-4-准备配置文件和启动脚本"><a href="#2-4-准备配置文件和启动脚本" class="headerlink" title="2.4 准备配置文件和启动脚本"></a>2.4 准备配置文件和启动脚本</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># ========db01==============</span></span><br><span class="line">cat &gt;/data/3307/my.cnf&lt;<span class="language-xml"><span class="tag">&lt;<span class="name">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">mysqld</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">basedir</span>=<span class="string">/data/app/mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">datadir</span>=<span class="string">/data/3307/data</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">socket</span>=<span class="string">/data/3307/mysql.sock</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">port</span>=<span class="string">3307</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log-error</span>=<span class="string">/data/3307/mysql.log</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log_bin</span>=<span class="string">/data/3307/mysql-bin</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_format</span>=<span class="string">row</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">skip-name-resolve</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">server-id</span>=<span class="string">7</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">gtid-mode</span>=<span class="string">on</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">enforce-gtid-consistency</span>=<span class="string">true</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log-slave-updates</span>=<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">rpl_semi_sync</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_enabled</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_timeout</span> =<span class="string">5000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_for_slave_count</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_no_slave</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_point</span> =<span class="string">AFTER_SYNC</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_slave_enabled</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">group</span> <span class="attr">commit</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_group_commit_sync_delay</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_group_commit_sync_no_delay_count</span> =<span class="string">1000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">gtid</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">gtid_mode</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">enforce_gtid_consistency</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log_slave_update</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">gtid</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">slave_parallel_type</span> =<span class="string">LOGICAL_CLOCK</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">slave_parallel_workers</span> =<span class="string">4</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">master_info_repository</span> =<span class="string">TABLE</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">relay_log_info_repository</span> =<span class="string">TABLE</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">cat</span> &gt;</span></span>/data/3308/my.cnf&lt;<span class="language-xml"><span class="tag">&lt;<span class="name">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">mysqld</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">basedir</span>=<span class="string">/data/app/mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">datadir</span>=<span class="string">/data/3308/data</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">port</span>=<span class="string">3308</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">socket</span>=<span class="string">/data/3308/mysql.sock</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log-error</span>=<span class="string">/data/3308/mysql.log</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log_bin</span>=<span class="string">/data/3308/mysql-bin</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_format</span>=<span class="string">row</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">skip-name-resolve</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">server-id</span>=<span class="string">8</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">gtid-mode</span>=<span class="string">on</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">enforce-gtid-consistency</span>=<span class="string">true</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log-slave-updates</span>=<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">rpl_semi_sync</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_enabled</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_timeout</span> =<span class="string">5000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_for_slave_count</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_no_slave</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_point</span> =<span class="string">AFTER_SYNC</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_slave_enabled</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">group</span> <span class="attr">commit</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_group_commit_sync_delay</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_group_commit_sync_no_delay_count</span> =<span class="string">1000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">gtid</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">gtid_mode</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">enforce_gtid_consistency</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log_slave_update</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">gtid</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">slave_parallel_type</span> =<span class="string">LOGICAL_CLOCK</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">slave_parallel_workers</span> =<span class="string">4</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">master_info_repository</span> =<span class="string">TABLE</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">relay_log_info_repository</span> =<span class="string">TABLE</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">cat</span> &gt;</span></span>/data/3309/my.cnf&lt;<span class="language-xml"><span class="tag">&lt;<span class="name">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">mysqld</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">basedir</span>=<span class="string">/data/app/mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">datadir</span>=<span class="string">/data/3309/data</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">socket</span>=<span class="string">/data/3309/mysql.sock</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">port</span>=<span class="string">3309</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log-error</span>=<span class="string">/data/3309/mysql.log</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log_bin</span>=<span class="string">/data/3309/mysql-bin</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_format</span>=<span class="string">row</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">skip-name-resolve</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">server-id</span>=<span class="string">9</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">gtid-mode</span>=<span class="string">on</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">enforce-gtid-consistency</span>=<span class="string">true</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log-slave-updates</span>=<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">rpl_semi_sync</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_enabled</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_timeout</span> =<span class="string">5000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_for_slave_count</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_no_slave</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_point</span> =<span class="string">AFTER_SYNC</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_slave_enabled</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">group</span> <span class="attr">commit</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_group_commit_sync_delay</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_group_commit_sync_no_delay_count</span> =<span class="string">1000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">gtid</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">gtid_mode</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">enforce_gtid_consistency</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log_slave_update</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">gtid</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">slave_parallel_type</span> =<span class="string">LOGICAL_CLOCK</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">slave_parallel_workers</span> =<span class="string">4</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">master_info_repository</span> =<span class="string">TABLE</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">relay_log_info_repository</span> =<span class="string">TABLE</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">cat</span> &gt;</span></span>/data/3310/my.cnf&lt;<span class="language-xml"><span class="tag">&lt;<span class="name">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">mysqld</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">basedir</span>=<span class="string">/data/app/mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">datadir</span>=<span class="string">/data/3310/data</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">socket</span>=<span class="string">/data/3310/mysql.sock</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">port</span>=<span class="string">3310</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log-error</span>=<span class="string">/data/3310/mysql.log</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log_bin</span>=<span class="string">/data/3310/mysql-bin</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_format</span>=<span class="string">row</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">skip-name-resolve</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">server-id</span>=<span class="string">10</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">gtid-mode</span>=<span class="string">on</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">enforce-gtid-consistency</span>=<span class="string">true</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log-slave-updates</span>=<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">rpl_semi_sync</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_enabled</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_timeout</span> =<span class="string">5000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_for_slave_count</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_no_slave</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_point</span> =<span class="string">AFTER_SYNC</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_slave_enabled</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">group</span> <span class="attr">commit</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_group_commit_sync_delay</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_group_commit_sync_no_delay_count</span> =<span class="string">1000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">gtid</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">gtid_mode</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">enforce_gtid_consistency</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log_slave_update</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">gtid</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">slave_parallel_type</span> =<span class="string">LOGICAL_CLOCK</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">slave_parallel_workers</span> =<span class="string">4</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">master_info_repository</span> =<span class="string">TABLE</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">relay_log_info_repository</span> =<span class="string">TABLE</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">cat</span> &gt;</span></span>/etc/systemd/system/mysqld3307.service&lt;<span class="language-xml"><span class="tag">&lt;<span class="name">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Unit</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Description</span>=<span class="string">MySQL</span> <span class="attr">Server</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Documentation</span>=<span class="string">man:mysqld(8)</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Documentation</span>=<span class="string">http://dev.mysql.com/doc/refman/en/using-systemd.html</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">After</span>=<span class="string">network.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">After</span>=<span class="string">syslog.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Install</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">WantedBy</span>=<span class="string">multi-user.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Service</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">User</span>=<span class="string">mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Group</span>=<span class="string">mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">ExecStart</span>=<span class="string">/data/app/mysql/bin/mysqld</span> <span class="attr">--defaults-file</span>=<span class="string">/data/3307/my.cnf</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">LimitNOFILE</span> = <span class="string">5000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">cat</span> &gt;</span></span>/etc/systemd/system/mysqld3308.service&lt;<span class="language-xml"><span class="tag">&lt;<span class="name">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Unit</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Description</span>=<span class="string">MySQL</span> <span class="attr">Server</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Documentation</span>=<span class="string">man:mysqld(8)</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Documentation</span>=<span class="string">http://dev.mysql.com/doc/refman/en/using-systemd.html</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">After</span>=<span class="string">network.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">After</span>=<span class="string">syslog.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Install</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">WantedBy</span>=<span class="string">multi-user.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Service</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">User</span>=<span class="string">mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Group</span>=<span class="string">mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">ExecStart</span>=<span class="string">/data/app/mysql/bin/mysqld</span> <span class="attr">--defaults-file</span>=<span class="string">/data/3308/my.cnf</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">LimitNOFILE</span> = <span class="string">5000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">cat</span> &gt;</span></span>/etc/systemd/system/mysqld3309.service&lt;<span class="language-xml"><span class="tag">&lt;<span class="name">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Unit</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Description</span>=<span class="string">MySQL</span> <span class="attr">Server</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Documentation</span>=<span class="string">man:mysqld(8)</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Documentation</span>=<span class="string">http://dev.mysql.com/doc/refman/en/using-systemd.html</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">After</span>=<span class="string">network.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">After</span>=<span class="string">syslog.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Install</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">WantedBy</span>=<span class="string">multi-user.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Service</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">User</span>=<span class="string">mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Group</span>=<span class="string">mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">ExecStart</span>=<span class="string">/data/app/mysql/bin/mysqld</span> <span class="attr">--defaults-file</span>=<span class="string">/data/3309/my.cnf</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">LimitNOFILE</span> = <span class="string">5000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">cat</span> &gt;</span></span>/etc/systemd/system/mysqld3310.service&lt;<span class="language-xml"><span class="tag">&lt;<span class="name">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Unit</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Description</span>=<span class="string">MySQL</span> <span class="attr">Server</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Documentation</span>=<span class="string">man:mysqld(8)</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Documentation</span>=<span class="string">http://dev.mysql.com/doc/refman/en/using-systemd.html</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">After</span>=<span class="string">network.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">After</span>=<span class="string">syslog.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Install</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">WantedBy</span>=<span class="string">multi-user.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Service</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">User</span>=<span class="string">mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Group</span>=<span class="string">mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">ExecStart</span>=<span class="string">/data/app/mysql/bin/mysqld</span> <span class="attr">--defaults-file</span>=<span class="string">/data/3310/my.cnf</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">LimitNOFILE</span> = <span class="string">5000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"># ========<span class="string">db02</span>===============</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="string">cat</span> &gt;</span></span>/data/3307/my.cnf&lt;<span class="language-xml"><span class="tag">&lt;<span class="name">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">mysqld</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">basedir</span>=<span class="string">/data/app/mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">datadir</span>=<span class="string">/data/3307/data</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">socket</span>=<span class="string">/data/3307/mysql.sock</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">port</span>=<span class="string">3307</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log-error</span>=<span class="string">/data/3307/mysql.log</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log_bin</span>=<span class="string">/data/3307/mysql-bin</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_format</span>=<span class="string">row</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">skip-name-resolve</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">server-id</span>=<span class="string">17</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">gtid-mode</span>=<span class="string">on</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">enforce-gtid-consistency</span>=<span class="string">true</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log-slave-updates</span>=<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">rpl_semi_sync</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_enabled</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_timeout</span> =<span class="string">5000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_for_slave_count</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_no_slave</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_point</span> =<span class="string">AFTER_SYNC</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_slave_enabled</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">group</span> <span class="attr">commit</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_group_commit_sync_delay</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_group_commit_sync_no_delay_count</span> =<span class="string">1000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">gtid</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">gtid_mode</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">enforce_gtid_consistency</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log_slave_update</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">gtid</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">slave_parallel_type</span> =<span class="string">LOGICAL_CLOCK</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">slave_parallel_workers</span> =<span class="string">4</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">master_info_repository</span> =<span class="string">TABLE</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">relay_log_info_repository</span> =<span class="string">TABLE</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">cat</span> &gt;</span></span>/data/3308/my.cnf&lt;<span class="language-xml"><span class="tag">&lt;<span class="name">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">mysqld</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">basedir</span>=<span class="string">/data/app/mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">datadir</span>=<span class="string">/data/3308/data</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">port</span>=<span class="string">3308</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">socket</span>=<span class="string">/data/3308/mysql.sock</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log-error</span>=<span class="string">/data/3308/mysql.log</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log_bin</span>=<span class="string">/data/3308/mysql-bin</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_format</span>=<span class="string">row</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">skip-name-resolve</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">server-id</span>=<span class="string">18</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">gtid-mode</span>=<span class="string">on</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">enforce-gtid-consistency</span>=<span class="string">true</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log-slave-updates</span>=<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">rpl_semi_sync</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_enabled</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_timeout</span> =<span class="string">5000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_for_slave_count</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_no_slave</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_point</span> =<span class="string">AFTER_SYNC</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_slave_enabled</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">group</span> <span class="attr">commit</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_group_commit_sync_delay</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_group_commit_sync_no_delay_count</span> =<span class="string">1000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">gtid</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">gtid_mode</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">enforce_gtid_consistency</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log_slave_update</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">gtid</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">slave_parallel_type</span> =<span class="string">LOGICAL_CLOCK</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">slave_parallel_workers</span> =<span class="string">4</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">master_info_repository</span> =<span class="string">TABLE</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">relay_log_info_repository</span> =<span class="string">TABLE</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">cat</span> &gt;</span></span>/data/3309/my.cnf&lt;<span class="language-xml"><span class="tag">&lt;<span class="name">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">mysqld</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">basedir</span>=<span class="string">/data/app/mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">datadir</span>=<span class="string">/data/3309/data</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">socket</span>=<span class="string">/data/3309/mysql.sock</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">port</span>=<span class="string">3309</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log-error</span>=<span class="string">/data/3309/mysql.log</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log_bin</span>=<span class="string">/data/3309/mysql-bin</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_format</span>=<span class="string">row</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">skip-name-resolve</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">server-id</span>=<span class="string">19</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">gtid-mode</span>=<span class="string">on</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">enforce-gtid-consistency</span>=<span class="string">true</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log-slave-updates</span>=<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">rpl_semi_sync</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_enabled</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_timeout</span> =<span class="string">5000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_for_slave_count</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_no_slave</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_point</span> =<span class="string">AFTER_SYNC</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_slave_enabled</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">group</span> <span class="attr">commit</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_group_commit_sync_delay</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_group_commit_sync_no_delay_count</span> =<span class="string">1000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">gtid</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">gtid_mode</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">enforce_gtid_consistency</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log_slave_update</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">gtid</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">slave_parallel_type</span> =<span class="string">LOGICAL_CLOCK</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">slave_parallel_workers</span> =<span class="string">4</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">master_info_repository</span> =<span class="string">TABLE</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">relay_log_info_repository</span> =<span class="string">TABLE</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">cat</span> &gt;</span></span>/data/3310/my.cnf&lt;<span class="language-xml"><span class="tag">&lt;<span class="name">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">mysqld</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">basedir</span>=<span class="string">/data/app/mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">datadir</span>=<span class="string">/data/3310/data</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">socket</span>=<span class="string">/data/3310/mysql.sock</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">port</span>=<span class="string">3310</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log-error</span>=<span class="string">/data/3310/mysql.log</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log_bin</span>=<span class="string">/data/3310/mysql-bin</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_format</span>=<span class="string">row</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">skip-name-resolve</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">server-id</span>=<span class="string">20</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">gtid-mode</span>=<span class="string">on</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">enforce-gtid-consistency</span>=<span class="string">true</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log-slave-updates</span>=<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">rpl_semi_sync</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_enabled</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_timeout</span> =<span class="string">5000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_for_slave_count</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_no_slave</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_master_wait_point</span> =<span class="string">AFTER_SYNC</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rpl_semi_sync_slave_enabled</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">group</span> <span class="attr">commit</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_group_commit_sync_delay</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">binlog_group_commit_sync_no_delay_count</span> =<span class="string">1000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">gtid</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">gtid_mode</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">enforce_gtid_consistency</span> =<span class="string">ON</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">log_slave_update</span> =<span class="string">1</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">#*************** <span class="attr">gtid</span> ***************</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">slave_parallel_type</span> =<span class="string">LOGICAL_CLOCK</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">slave_parallel_workers</span> =<span class="string">4</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">master_info_repository</span> =<span class="string">TABLE</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">relay_log_info_repository</span> =<span class="string">TABLE</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">cat</span> &gt;</span></span>/etc/systemd/system/mysqld3307.service&lt;<span class="language-xml"><span class="tag">&lt;<span class="name">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Unit</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Description</span>=<span class="string">MySQL</span> <span class="attr">Server</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Documentation</span>=<span class="string">man:mysqld(8)</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Documentation</span>=<span class="string">http://dev.mysql.com/doc/refman/en/using-systemd.html</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">After</span>=<span class="string">network.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">After</span>=<span class="string">syslog.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Install</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">WantedBy</span>=<span class="string">multi-user.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Service</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">User</span>=<span class="string">mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Group</span>=<span class="string">mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">ExecStart</span>=<span class="string">/data/app/mysql/bin/mysqld</span> <span class="attr">--defaults-file</span>=<span class="string">/data/3307/my.cnf</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">LimitNOFILE</span> = <span class="string">5000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">cat</span> &gt;</span></span>/etc/systemd/system/mysqld3308.service&lt;<span class="language-xml"><span class="tag">&lt;<span class="name">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Unit</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Description</span>=<span class="string">MySQL</span> <span class="attr">Server</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Documentation</span>=<span class="string">man:mysqld(8)</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Documentation</span>=<span class="string">http://dev.mysql.com/doc/refman/en/using-systemd.html</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">After</span>=<span class="string">network.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">After</span>=<span class="string">syslog.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Install</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">WantedBy</span>=<span class="string">multi-user.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Service</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">User</span>=<span class="string">mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Group</span>=<span class="string">mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">ExecStart</span>=<span class="string">/data/app/mysql/bin/mysqld</span> <span class="attr">--defaults-file</span>=<span class="string">/data/3308/my.cnf</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">LimitNOFILE</span> = <span class="string">5000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">cat</span> &gt;</span></span>/etc/systemd/system/mysqld3309.service&lt;<span class="language-xml"><span class="tag">&lt;<span class="name">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Unit</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Description</span>=<span class="string">MySQL</span> <span class="attr">Server</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Documentation</span>=<span class="string">man:mysqld(8)</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Documentation</span>=<span class="string">http://dev.mysql.com/doc/refman/en/using-systemd.html</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">After</span>=<span class="string">network.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">After</span>=<span class="string">syslog.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Install</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">WantedBy</span>=<span class="string">multi-user.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Service</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">User</span>=<span class="string">mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Group</span>=<span class="string">mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">ExecStart</span>=<span class="string">/data/app/mysql/bin/mysqld</span> <span class="attr">--defaults-file</span>=<span class="string">/data/3309/my.cnf</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">LimitNOFILE</span> = <span class="string">5000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">cat</span> &gt;</span></span>/etc/systemd/system/mysqld3310.service&lt;<span class="language-xml"><span class="tag">&lt;<span class="name">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Unit</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Description</span>=<span class="string">MySQL</span> <span class="attr">Server</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Documentation</span>=<span class="string">man:mysqld(8)</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Documentation</span>=<span class="string">http://dev.mysql.com/doc/refman/en/using-systemd.html</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">After</span>=<span class="string">network.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">After</span>=<span class="string">syslog.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Install</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">WantedBy</span>=<span class="string">multi-user.target</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">[<span class="attr">Service</span>]</span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">User</span>=<span class="string">mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">Group</span>=<span class="string">mysql</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">ExecStart</span>=<span class="string">/data/app/mysql/bin/mysqld</span> <span class="attr">--defaults-file</span>=<span class="string">/data/3310/my.cnf</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">LimitNOFILE</span> = <span class="string">5000</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">EOF</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"></span></span></span><br></pre></td></tr></table></figure>

<h2 id="2-5-修改权限，启动多实例"><a href="#2-5-修改权限，启动多实例" class="headerlink" title="2.5 修改权限，启动多实例"></a>2.5 修改权限，启动多实例</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">chown -R mysql.mysql /data/*</span><br><span class="line">systemctl start mysqld3307</span><br><span class="line">systemctl start mysqld3308</span><br><span class="line">systemctl start mysqld3309</span><br><span class="line">systemctl start mysqld3310</span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;show variables like &#x27;server<span class="emphasis">_id&#x27;&quot;</span></span><br><span class="line"><span class="emphasis">mysql -S /data/3308/mysql.sock -e &quot;show variables like &#x27;server_</span>id&#x27;&quot;</span><br><span class="line">mysql -S /data/3309/mysql.sock -e &quot;show variables like &#x27;server<span class="emphasis">_id&#x27;&quot;</span></span><br><span class="line"><span class="emphasis">mysql -S /data/3310/mysql.sock -e &quot;show variables like &#x27;server_</span>id&#x27;&quot;</span><br></pre></td></tr></table></figure>

<h2 id="2-6-节点主从规划"><a href="#2-6-节点主从规划" class="headerlink" title="2.6 节点主从规划"></a>2.6 节点主从规划</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10.0.0.52:3308 &lt;-----&gt; 10.0.0.51:3308</span><br><span class="line">10.0.0.52:3310 -----&gt; 10.0.0.52:3308</span><br><span class="line">10.0.0.51:3310 -----&gt; 10.0.0.51:3308</span><br></pre></td></tr></table></figure>

<h2 id="2-7-开始配置主从环境"><a href="#2-7-开始配置主从环境" class="headerlink" title="2.7 开始配置主从环境"></a>2.7 开始配置主从环境</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># shard1</span></span><br><span class="line"><span class="section">## 10.0.0.51:3307 &lt;-----&gt; 10.0.0.52:3307</span></span><br><span class="line"><span class="section"># db02</span></span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;create user repl@&#x27;10.0.0.%&#x27; identified</span><br><span class="line">with mysql<span class="emphasis">_native_</span>password by &#x27;123&#x27;; grant replication slave on <span class="emphasis">*.*</span> to</span><br><span class="line">repl@&#x27;10.0.0.%&#x27;;&quot;</span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;create user root@&#x27;10.0.0.%&#x27; identified</span><br><span class="line">with mysql<span class="emphasis">_native_</span>password by &#x27;123&#x27;; grant all on <span class="emphasis">*.*</span> to root@&#x27;10.0.0.%&#x27;;</span><br><span class="line">&quot;</span><br><span class="line"><span class="section"># db01</span></span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;CHANGE MASTER TO</span><br><span class="line">MASTER<span class="emphasis">_HOST=&#x27;10.0.0.52&#x27;, MASTER_</span>PORT=3307, MASTER<span class="emphasis">_AUTO_</span>POSITION=1,</span><br><span class="line">MASTER<span class="emphasis">_USER=&#x27;repl&#x27;, MASTER_</span>PASSWORD=&#x27;123&#x27;;&quot;</span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;start slave;&quot;</span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;show slave status\G&quot;|grep Running:</span><br><span class="line"><span class="section"># db02</span></span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;CHANGE MASTER TO</span><br><span class="line">MASTER<span class="emphasis">_HOST=&#x27;10.0.0.51&#x27;, MASTER_</span>PORT=3307, MASTER<span class="emphasis">_AUTO_</span>POSITION=1,</span><br><span class="line">MASTER<span class="emphasis">_USER=&#x27;repl&#x27;, MASTER_</span>PASSWORD=&#x27;123&#x27;;&quot;</span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;start slave;&quot;</span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;show slave status\G&quot;|grep Running:</span><br><span class="line"><span class="section">## 10.0.0.51:3309 ------&gt; 10.0.0.51:3307</span></span><br><span class="line"></span><br><span class="line"><span class="section"># db01</span></span><br><span class="line">mysql -S /data/3309/mysql.sock -e &quot;CHANGE MASTER TO</span><br><span class="line">MASTER<span class="emphasis">_HOST=&#x27;10.0.0.51&#x27;, MASTER_</span>PORT=3307, MASTER<span class="emphasis">_AUTO_</span>POSITION=1,</span><br><span class="line">MASTER<span class="emphasis">_USER=&#x27;repl&#x27;, MASTER_</span>PASSWORD=&#x27;123&#x27;;&quot;</span><br><span class="line">mysql -S /data/3309/mysql.sock -e &quot;start slave;&quot;</span><br><span class="line">mysql -S /data/3309/mysql.sock -e &quot;show slave status\G&quot;|grep Running:</span><br><span class="line"><span class="section">## 10.0.0.52:3309 ------&gt; 10.0.0.52:3307</span></span><br><span class="line"><span class="section"># db02</span></span><br><span class="line">mysql -S /data/3309/mysql.sock -e &quot;CHANGE MASTER TO</span><br><span class="line">MASTER<span class="emphasis">_HOST=&#x27;10.0.0.52&#x27;, MASTER_</span>PORT=3307, MASTER<span class="emphasis">_AUTO_</span>POSITION=1,</span><br><span class="line">MASTER<span class="emphasis">_USER=&#x27;repl&#x27;, MASTER_</span>PASSWORD=&#x27;123&#x27;;&quot;</span><br><span class="line">mysql -S /data/3309/mysql.sock -e &quot;start slave;&quot;</span><br><span class="line">mysql -S /data/3309/mysql.sock -e &quot;show slave status\G&quot;|grep Running:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">====================================================================</span><br><span class="line"><span class="section"># shard2</span></span><br><span class="line"><span class="section">## 10.0.0.52:3308 &lt;-----&gt; 10.0.0.51:3308</span></span><br><span class="line"><span class="section"># db01</span></span><br><span class="line">mysql -S /data/3308/mysql.sock -e &quot;create user repl@&#x27;10.0.0.%&#x27; identified</span><br><span class="line">with mysql<span class="emphasis">_native_</span>password by &#x27;123&#x27;; grant replication slave on <span class="emphasis">*.*</span> to</span><br><span class="line">repl@&#x27;10.0.0.%&#x27;;&quot;</span><br><span class="line">mysql -S /data/3308/mysql.sock -e &quot;create user root@&#x27;10.0.0.%&#x27; identified</span><br><span class="line">with mysql<span class="emphasis">_native_</span>password by &#x27;123&#x27;; grant all on <span class="emphasis">*.*</span> to root@&#x27;10.0.0.%&#x27;;</span><br><span class="line">&quot;</span><br><span class="line"><span class="section"># db02</span></span><br><span class="line">mysql -S /data/3308/mysql.sock -e &quot;CHANGE MASTER TO</span><br><span class="line">MASTER<span class="emphasis">_HOST=&#x27;10.0.0.51&#x27;, MASTER_</span>PORT=3308, MASTER<span class="emphasis">_AUTO_</span>POSITION=1,</span><br><span class="line">MASTER<span class="emphasis">_USER=&#x27;repl&#x27;, MASTER_</span>PASSWORD=&#x27;123&#x27;;&quot;</span><br><span class="line">mysql -S /data/3308/mysql.sock -e &quot;start slave;&quot;</span><br><span class="line">mysql -S /data/3308/mysql.sock -e &quot;show slave status\G&quot;|grep Running:</span><br><span class="line"><span class="section"># db01</span></span><br><span class="line">mysql -S /data/3308/mysql.sock -e &quot;CHANGE MASTER TO</span><br><span class="line">MASTER<span class="emphasis">_HOST=&#x27;10.0.0.52&#x27;, MASTER_</span>PORT=3308, MASTER<span class="emphasis">_AUTO_</span>POSITION=1,</span><br><span class="line">MASTER<span class="emphasis">_USER=&#x27;repl&#x27;, MASTER_</span>PASSWORD=&#x27;123&#x27;;&quot;</span><br><span class="line">mysql -S /data/3308/mysql.sock -e &quot;start slave;&quot;</span><br><span class="line">mysql -S /data/3308/mysql.sock -e &quot;show slave status\G&quot;|grep Running:</span><br><span class="line"><span class="section">## 10.0.0.52:3310 -----&gt; 10.0.0.52:3308</span></span><br><span class="line"><span class="section"># db02</span></span><br><span class="line">mysql -S /data/3310/mysql.sock -e &quot;CHANGE MASTER TO</span><br><span class="line">MASTER<span class="emphasis">_HOST=&#x27;10.0.0.52&#x27;, MASTER_</span>PORT=3308, MASTER<span class="emphasis">_AUTO_</span>POSITION=1,</span><br><span class="line">MASTER<span class="emphasis">_USER=&#x27;repl&#x27;, MASTER_</span>PASSWORD=&#x27;123&#x27;;&quot;</span><br><span class="line">mysql -S /data/3310/mysql.sock -e &quot;start slave;&quot;</span><br><span class="line">mysql -S /data/3310/mysql.sock -e &quot;show slave status\G&quot;|grep Running:</span><br><span class="line"><span class="section">##10.0.0.51:3310 -----&gt; 10.0.0.51:3308</span></span><br><span class="line"></span><br><span class="line"><span class="section"># db01</span></span><br><span class="line">mysql -S /data/3310/mysql.sock -e &quot;CHANGE MASTER TO</span><br><span class="line">MASTER<span class="emphasis">_HOST=&#x27;10.0.0.51&#x27;, MASTER_</span>PORT=3308, MASTER<span class="emphasis">_AUTO_</span>POSITION=1,</span><br><span class="line">MASTER<span class="emphasis">_USER=&#x27;repl&#x27;, MASTER_</span>PASSWORD=&#x27;123&#x27;;&quot;</span><br><span class="line">mysql -S /data/3310/mysql.sock -e &quot;start slave;&quot;</span><br><span class="line">mysql -S /data/3310/mysql.sock -e &quot;show slave status\G&quot;|grep Running:</span><br><span class="line">2.9 检测主从状态</span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;show slave status\G&quot;|grep Yes</span><br><span class="line">mysql -S /data/3308/mysql.sock -e &quot;show slave status\G&quot;|grep Yes</span><br><span class="line">mysql -S /data/3309/mysql.sock -e &quot;show slave status\G&quot;|grep Yes</span><br><span class="line">mysql -S /data/3310/mysql.sock -e &quot;show slave status\G&quot;|grep Yes</span><br><span class="line">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line">注：如果中间出现错误，在每个节点进行执行以下命令，从2.8从头执行</span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;stop slave; reset slave all;&quot;</span><br><span class="line">mysql -S /data/3308/mysql.sock -e &quot;stop slave; reset slave all;&quot;</span><br><span class="line">mysql -S /data/3309/mysql.sock -e &quot;stop slave; reset slave all;&quot;</span><br><span class="line">mysql -S /data/3310/mysql.sock -e &quot;stop slave; reset slave all;&quot;</span><br></pre></td></tr></table></figure>

<h1 id="3-MyCAT安装"><a href="#3-MyCAT安装" class="headerlink" title="3.MyCAT安装"></a>3.MyCAT安装</h1><h2 id="3-1-预先安装Java运行环境"><a href="#3-1-预先安装Java运行环境" class="headerlink" title="3.1 预先安装Java运行环境"></a>3.1 预先安装Java运行环境</h2><p><code>yum install -y java </code></p>
<h2 id="3-2下载"><a href="#3-2下载" class="headerlink" title="3.2下载"></a>3.2下载</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Mycat-server-xxxxx.linux.tar.gz</span><br><span class="line">http://dl.mycat.org.cn/</span><br></pre></td></tr></table></figure>

<h2 id="3-3-解压文件"><a href="#3-3-解压文件" class="headerlink" title="3.3 解压文件"></a>3.3 解压文件</h2><p> <code>tar xf Mycat-server-*  </code></p>
<h2 id="3-4-软件目录结构"><a href="#3-4-软件目录结构" class="headerlink" title="3.4 软件目录结构"></a>3.4 软件目录结构</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls</span><br><span class="line">bin catlet conf lib logs version.txt</span><br></pre></td></tr></table></figure>

<h2 id="3-5-启动和连接"><a href="#3-5-启动和连接" class="headerlink" title="3.5 启动和连接"></a>3.5 启动和连接</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line">export PATH=/data/app/mycat/bin:$PATH</span><br><span class="line">source /etc/profile</span><br><span class="line">mycat start</span><br><span class="line">mysql -uroot -p123456 -h 127.0.0.1 -P8066</span><br><span class="line">注： Mycat中使用的是MySQL 5.1版本驱动，连接8.0时将会失败。</span><br><span class="line"></span><br><span class="line"><span class="section"># 解决方案：</span></span><br><span class="line"><span class="bullet">1.</span> 下载更新客户端程序</span><br><span class="line">https://downloads.mysql.com/archives/c-j/</span><br><span class="line"><span class="bullet">2.</span> 连接时添加auth=mysql<span class="emphasis">_native_</span>password参数</span><br><span class="line">mysql -uroot -p123456 -h10.0.0.51 -P8066 --defaultauth=mysql<span class="emphasis">_native_</span>password</span><br><span class="line"><span class="bullet">3.</span> 更新MySQL客户端命令为8.0之前版本</span><br></pre></td></tr></table></figure>

<h1 id="4-配置文件介绍"><a href="#4-配置文件介绍" class="headerlink" title="4.配置文件介绍"></a>4.配置文件介绍</h1><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">4.1 bin 目录</span><br><span class="line">程序目录</span><br><span class="line">4.2 conf</span><br><span class="line">配置文件目录</span><br><span class="line">4.2.1 schema.xml</span><br><span class="line">主配置文件：节点信息、读写分离、高可用设置、调用分片策略..</span><br><span class="line">4.2.2 rule.xml</span><br><span class="line">分片策略的定义、功能、使用用方法</span><br><span class="line">4.2.3 server.xml</span><br><span class="line">mycat服务有关配置： 用户、网络、权限、策略、资源...</span><br><span class="line">4.2.4 xx.txt文件</span><br><span class="line">分片参数定义文件</span><br><span class="line">4.2.5 log4j2.xml</span><br><span class="line">Mycat 相关日志记录配置</span><br><span class="line">4.3 logs</span><br><span class="line">wrapper.log : 启动日志</span><br><span class="line">mycat.log ：工作日志</span><br></pre></td></tr></table></figure>

<h1 id="5-schema-xml配置文件基本结构"><a href="#5-schema-xml配置文件基本结构" class="headerlink" title="5.schema.xml配置文件基本结构"></a>5.schema.xml配置文件基本结构</h1><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@db01 conf]# cd /data/mycat/conf/</span><br><span class="line">mv schema.xml schema.xml.bak</span><br><span class="line">vim schema.xml</span><br><span class="line"><span class="section"># 逻辑库：</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;TESTDB&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">dataNode</span>=<span class="string">&quot;dn1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span></span><br><span class="line"><span class="section"># DN数据节点（逻辑分片）：数据节点（逻辑分片）：</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">database</span>= <span class="string">&quot;world&quot;</span> /&gt;</span></span></span><br><span class="line">作用：</span><br><span class="line">垂直和水平查分。</span><br><span class="line"><span class="section"># DH 数据主机</span></span><br><span class="line">作用： 高可用和读写分离</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;1&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span></span>select user()<span class="language-xml"><span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;db1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.51:3307&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;db2&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.51:3309&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">password</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span></span><br><span class="line"><span class="section"><span class="language-xml"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></span></span></span><br><span class="line"><span class="section">====================================</span></span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-配置文件简单试水-读写分离"><a href="#5-2-配置文件简单试水-读写分离" class="headerlink" title="5.2 配置文件简单试水-读写分离"></a>5.2 配置文件简单试水-读写分离</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">#配置文件模板-读写分离</span></span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mycat:schema SYSTEM &quot;schema.dtd&quot;&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;TESTDB&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">dataNode</span>=<span class="string">&quot;dn1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">database</span>= <span class="string">&quot;world&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;1&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span></span>select user()<span class="language-xml"><span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;db1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.51:3307&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;db2&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.51:3309&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">password</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></span></span><br><span class="line"><span class="section"># 测试环境准备</span></span><br><span class="line">db01:</span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;grant all on <span class="emphasis">*.*</span> to root@&#x27;10.0.0.%&#x27;</span><br><span class="line">identified by &#x27;123&#x27;;&quot;</span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;source /root/world.sql&quot;</span><br><span class="line">mysql -S /data/3308/mysql.sock -e &quot;grant all on <span class="emphasis">*.*</span> to root@&#x27;10.0.0.%&#x27;</span><br><span class="line">identified by &#x27;123&#x27;;&quot;</span><br><span class="line">mysql -S /data/3308/mysql.sock -e &quot;source /root/world.sql&quot;</span><br><span class="line"><span class="section"># 重启mycat</span></span><br><span class="line">mycat restart</span><br><span class="line">读写分离测试</span><br><span class="line"><span class="section"># 连接mycat 服务</span></span><br><span class="line">[root@db01 ~]# mysql -uroot -p123456 -h 10.0.0.51 -P8066</span><br><span class="line"><span class="section"># 测试读</span></span><br><span class="line">mysql&gt; select @@server<span class="emphasis">_id;</span></span><br><span class="line"><span class="emphasis"># 测试写</span></span><br><span class="line"><span class="emphasis">mysql&gt; begin ; select @@server_</span>id;commit;</span><br></pre></td></tr></table></figure>

<h2 id="5-3-配置读写分离及高可用"><a href="#5-3-配置读写分离及高可用" class="headerlink" title="5.3 配置读写分离及高可用"></a>5.3 配置读写分离及高可用</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">[root@db01 conf]# mv schema.xml schema.xml.rw</span><br><span class="line">[root@db01 conf]# vim schema.xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mycat:schema SYSTEM &quot;schema.dtd&quot;&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;TESTDB&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">dataNode</span>=<span class="string">&quot;sh1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;sh1&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;oldguo1&quot;</span> <span class="attr">database</span>= <span class="string">&quot;world&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;oldguo1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;1&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span></span>select user()<span class="language-xml"><span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;db1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.51:3307&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;db2&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.51:3309&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">password</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;db3&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.52:3307&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;db4&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.52:3309&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">password</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></span></span><br><span class="line">primary writehost ：负责写操作的writehost</span><br><span class="line">standby writeHost ：和readhost一样，只提供读服务</span><br><span class="line">当写节点宕机后，后面跟的readhost也不提供服务，这时候standby的writehost就提供写服务，</span><br><span class="line">后面跟的readhost提供读服务</span><br><span class="line">测试读写分离：</span><br><span class="line">mycat restart</span><br><span class="line">mysql -uroot -p123456 -h 10.0.0.51 -P 8066</span><br><span class="line">mysql&gt; select @@server<span class="emphasis">_id;</span></span><br><span class="line"><span class="emphasis">mysql&gt; begin;select @@server_</span>id;commit;</span><br><span class="line">测试高可用：</span><br><span class="line">[root@db01 conf]# systemctl stop mysqld3307</span><br><span class="line">mysql -uroot -p123456 -h 10.0.0.51 -P 8066</span><br><span class="line">mysql&gt; select @@server<span class="emphasis">_id;</span></span><br><span class="line"><span class="emphasis">mysql&gt; begin;select @@server_</span>id;commit;</span><br><span class="line">[root@db01 conf]# systemctl start mysqld3307</span><br><span class="line">mysql -uroot -p123456 -h 10.0.0.51 -P 8066</span><br><span class="line">mysql&gt; select @@server<span class="emphasis">_id;</span></span><br><span class="line"><span class="emphasis">mysql&gt; begin;select @@server_</span>id;commit;</span><br><span class="line"></span><br><span class="line"><span class="section"># 说明：</span></span><br><span class="line"><span class="bullet">1.</span> MHA + Mycat+ 3分片</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;mha1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;1&quot;</span> <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span></span>show slave status<span class="language-xml"><span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;db1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.55:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;db2&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.52:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">password</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;db3&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.53:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">password</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;mha2&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;1&quot;</span> <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span></span>show slave status<span class="language-xml"><span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;db1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.56:3307&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;db2&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.51:3307&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;db2&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.53:3307&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;mha3&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;1&quot;</span> <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span></span>show slave status<span class="language-xml"><span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;db1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.57:3308&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;db2&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.51:3308&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;db2&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.52:3308&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> PXC+Mycat+3分片</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;pxc1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;1&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span></span>show status like &#x27;wsrep%&#x27;<span class="language-xml"><span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;db1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.51:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;db2&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.52:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">password</span>=<span class="string">&quot;123&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;db3&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.53:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">password</span>=<span class="string">&quot;123&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span></span><br><span class="line">...此处省略...</span><br><span class="line">   </span><br><span class="line"><span class="bullet">4.</span> 调研： MGR+Mycat+3分片</span><br><span class="line">  </span><br><span class="line"><span class="bullet">6.</span> 调研： DBLE</span><br></pre></td></tr></table></figure>

<h2 id="5-4-Schema-xml核心参数介绍"><a href="#5-4-Schema-xml核心参数介绍" class="headerlink" title="5.4 Schema.xml核心参数介绍"></a>5.4 Schema.xml核心参数介绍</h2><h3 id="5-4-1-balance属性"><a href="#5-4-1-balance属性" class="headerlink" title="5.4.1 balance属性"></a>5.4.1 balance属性</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">读操作负载均衡类型，目前的取值有3种：</span><br><span class="line"><span class="bullet">1.</span> balance=&quot;0&quot;, 不开启读写分离机制，所有读操作都发送到当前可用的writeHost上。</span><br><span class="line"><span class="bullet">2.</span> balance=&quot;1&quot;，全部的readHost与standby writeHost参与select语句的负载均衡，简单的</span><br><span class="line">说，</span><br><span class="line">当双主双从模式(M1-&gt;S1，M2-&gt;S2，并且M1与 M2互为主备)，正常情况下，M2,S1,S2都参与select</span><br><span class="line">语句的负载均衡。</span><br><span class="line"><span class="bullet">3.</span> balance=&quot;2&quot;，所有读操作都随机的在writeHost、readhost上分发。</span><br></pre></td></tr></table></figure>

<h3 id="5-4-2-writeType属性"><a href="#5-4-2-writeType属性" class="headerlink" title="5.4.2 writeType属性"></a>5.4.2 writeType属性</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">写操作负载均衡，目前的取值有2种：</span><br><span class="line"><span class="bullet">1.</span> writeType=&quot;0&quot;, 所有写操作发送到配置的第一个writeHost，</span><br><span class="line">第一个挂了切到还生存的第二个writeHost，重新启动后已切换后的为主，切换记录在配置文件</span><br><span class="line">中:dnindex.properties .</span><br><span class="line"><span class="bullet">2.</span> writeType=“1”，所有写操作都随机的发送到配置的writeHost，但不推荐使用</span><br></pre></td></tr></table></figure>

<h3 id="5-4-3-switchType属性"><a href="#5-4-3-switchType属性" class="headerlink" title="5.4.3 switchType属性"></a>5.4.3 switchType属性</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-1: 表示不自动切换</span><br><span class="line">1 : 默认值，自动切换</span><br><span class="line">2 : 基于MySQL主从同步的状态决定是否切换 ，心跳语句为 show slave status (注意超时参数，</span><br><span class="line">参考orch)</span><br><span class="line">3 : 基于Galary Cluster（PXC,MGC） 切换机制，心跳语句为：show status like &#x27;wsrep%&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-4-连接有关"><a href="#5-4-4-连接有关" class="headerlink" title="5.4.4 连接有关"></a>5.4.4 连接有关</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">maxCon=&quot;1000&quot;：最大的并发连接数</span><br><span class="line">minCon=&quot;10&quot; ：mycat在启动之后，会在后端节点上自动开启的连接线程</span><br></pre></td></tr></table></figure>

<h3 id="5-4-5-tempReadHostAvailable-x3D-”1”"><a href="#5-4-5-tempReadHostAvailable-x3D-”1”" class="headerlink" title="5.4.5 tempReadHostAvailable&#x3D;”1”"></a>5.4.5 tempReadHostAvailable&#x3D;”1”</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">这个一主一从时（1个writehost，1个readhost时），可以开启这个参数，如果2个writehost，2个</span><br><span class="line">readhost时</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span></span>select user()<span class="language-xml"><span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span> 监测心跳</span><br></pre></td></tr></table></figure>

<h3 id="5-4-6-checkSQLschema-x3D-”false”"><a href="#5-4-6-checkSQLschema-x3D-”false”" class="headerlink" title="5.4.6 checkSQLschema&#x3D;”false”"></a>5.4.6 checkSQLschema&#x3D;”false”</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">是否检查，在select时的库名字。</span><br><span class="line">例如，执行 select * from TESTDB.t1;</span><br><span class="line">参数开启为true，会自动架构TESTDB去掉。否则会使得后端节点执行报错。</span><br><span class="line">当然如果，TESTDB写成了一个不存在的逻辑库名字，也会报错。</span><br><span class="line">结论： 一般我们可以先use，后select的方式进行查询数据即可避免此类问题。</span><br></pre></td></tr></table></figure>

<h1 id="6-Mycat-分布式架构–垂直分表"><a href="#6-Mycat-分布式架构–垂直分表" class="headerlink" title="6.Mycat 分布式架构–垂直分表"></a>6.Mycat 分布式架构–垂直分表</h1><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">taobao user （sh1），order<span class="emphasis">_t(sh2) ,others(sh3)</span></span><br><span class="line"><span class="emphasis">cd /data/app/mycat/conf</span></span><br><span class="line"><span class="emphasis">mv schema.xml schema.xml.ha</span></span><br><span class="line"><span class="emphasis">vim schema.xml</span></span><br><span class="line"><span class="emphasis">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="emphasis">&lt;!DOCTYPE mycat:schema SYSTEM &quot;schema.dtd&quot;&gt;</span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;TESTDB&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span></span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="emphasis"><span class="attr">dataNode</span>=<span class="string">&quot;sh1&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;sh1&quot;</span>/&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;order_t&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;sh2&quot;</span>/&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;sh1&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;oldguo1&quot;</span> <span class="attr">database</span>= <span class="string">&quot;taobao&quot;</span> /&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;sh2&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;oldguo2&quot;</span> <span class="attr">database</span>= <span class="string">&quot;taobao&quot;</span> /&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;oldguo1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;1&quot;</span></span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="emphasis"><span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span></span>select user()<span class="language-xml"><span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;db1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.51:3307&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;db2&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.51:3309&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="emphasis"><span class="attr">password</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;db3&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.52:3307&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;db4&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.52:3309&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="emphasis"><span class="attr">password</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;oldguo2&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;1&quot;</span></span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="emphasis"><span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span></span>select user()<span class="language-xml"><span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;db1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.51:3308&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;db2&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.51:3310&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="emphasis"><span class="attr">password</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;db3&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.52:3308&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;db4&quot;</span> <span class="attr">url</span>=<span class="string">&quot;10.0.0.52:3310&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="emphasis"><span class="attr">password</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis">创建测试库和表:</span></span><br><span class="line"><span class="emphasis">mysql -S /data/3307/mysql.sock -e &quot;create database taobao charset utf8;&quot;</span></span><br><span class="line"><span class="emphasis">mysql -S /data/3308/mysql.sock -e &quot;create database taobao charset utf8;&quot;</span></span><br><span class="line"><span class="emphasis">mysql -S /data/3307/mysql.sock -e &quot;use taobao;create table user(id int,name</span></span><br><span class="line"><span class="emphasis">varchar(20))&quot;;</span></span><br><span class="line"><span class="emphasis">mysql -S /data/3308/mysql.sock -e &quot;use taobao;create table order_</span>t(id</span><br><span class="line">int,name varchar(20))&quot;</span><br><span class="line"><span class="section"># 重启mycat</span></span><br><span class="line">mycat restart</span><br><span class="line"><span class="section"># mycat中对user 和 order 数据插入</span></span><br><span class="line">mysql -uroot -p123456 -h10.0.0.51 -P8066 --defaultauth=mysql<span class="emphasis">_native_</span>password</span><br><span class="line">insert into user values(1,&#x27;a&#x27;);</span><br><span class="line">insert into user values(2,&#x27;b&#x27;);</span><br><span class="line">insert into user values(3,&#x27;c&#x27;);</span><br><span class="line">commit;</span><br><span class="line">insert into order<span class="emphasis">_t values(1,&#x27;x&#x27;),(2,&#x27;y&#x27;);</span></span><br><span class="line"><span class="emphasis">commit;</span></span><br><span class="line"><span class="emphasis">[root@db01 conf]# mysql -S /data/3307/mysql.sock -e &quot;show tables from</span></span><br><span class="line"><span class="emphasis">taobao&quot;</span></span><br><span class="line"><span class="emphasis">+------------------+</span></span><br><span class="line"><span class="emphasis">| Tables_</span>in<span class="emphasis">_taobao |</span></span><br><span class="line"><span class="emphasis">+------------------+</span></span><br><span class="line"><span class="emphasis">| user 						 |</span></span><br><span class="line"><span class="emphasis">+------------------+</span></span><br><span class="line"><span class="emphasis">[root@db01 conf]# mysql -S /data/3308/mysql.sock -e &quot;show tables from</span></span><br><span class="line"><span class="emphasis">taobao&quot;</span></span><br><span class="line"><span class="emphasis">+------------------+</span></span><br><span class="line"><span class="emphasis">| Tables_</span>in<span class="emphasis">_taobao |</span></span><br><span class="line"><span class="emphasis">+------------------+</span></span><br><span class="line"><span class="emphasis">| order_</span>t          |</span><br><span class="line">+------------------+</span><br><span class="line">[root@db01 conf]# mysql -S /data/3307/mysql.sock -e &quot;select * from</span><br><span class="line">taobao.user&quot;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | name |</span><br><span class="line">+------+------+</span><br><span class="line">| 1    | a    |</span><br><span class="line">| 2    | b    | </span><br><span class="line">| 3    | c    |</span><br><span class="line">+------+------+</span><br><span class="line">[root@db01 conf]# mysql -S /data/3308/mysql.sock -e &quot;select * from</span><br><span class="line">taobao.order<span class="emphasis">_t&quot;</span></span><br><span class="line"><span class="emphasis">+------+------+</span></span><br><span class="line"><span class="emphasis">| id   | name |</span></span><br><span class="line"><span class="emphasis">+------+------+</span></span><br><span class="line"><span class="emphasis">| 1    | x    |</span></span><br><span class="line"><span class="emphasis">| 2    | y    |</span></span><br><span class="line"><span class="emphasis">+------+------+</span></span><br><span class="line"><span class="emphasis">[root@db01 conf]#</span></span><br></pre></td></tr></table></figure>

<h1 id="7-Mycat-分布式架构–水平拆分"><a href="#7-Mycat-分布式架构–水平拆分" class="headerlink" title="7. Mycat 分布式架构–水平拆分"></a>7. Mycat 分布式架构–水平拆分</h1><h2 id="7-0-重要概念"><a href="#7-0-重要概念" class="headerlink" title="7.0 重要概念"></a>7.0 重要概念</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">分片策略 ：几乎融合经典业务中大部分的分片策略。Mycat已经开发了相应算法，非常方便调用。</span><br><span class="line">范围分片</span><br><span class="line">取模</span><br><span class="line">枚举</span><br><span class="line">日期</span><br><span class="line">HASH</span><br><span class="line">等。</span><br><span class="line">分片键： 作为分片条件的列。</span><br></pre></td></tr></table></figure>

<h2 id="7-1-范围分片"><a href="#7-1-范围分片" class="headerlink" title="7.1 范围分片"></a>7.1 范围分片</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">比如说t3表</span><br><span class="line">(1)行数非常多，2000w（1-1000w:sh1 1000w01-2000w:sh2）</span><br><span class="line">(2)访问非常频繁，用户访问较离散</span><br><span class="line"><span class="section"># 1. 修改schema.xml文件，定制分片策略</span></span><br><span class="line">cp schema.xml schema.xml.1</span><br><span class="line">vim schema.xml</span><br><span class="line">添加：</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;t3&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;sh1,sh2&quot;</span> <span class="attr">rule</span>=<span class="string">&quot;auto-sharding-long&quot;</span> /&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="section"># 2. 定义和使用分片策略</span></span><br><span class="line">vim rule.xml</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">tableRule</span> <span class="attr">name</span>=<span class="string">&quot;auto-sharding-long&quot;</span>&gt;</span></span></span><br><span class="line">   <span class="language-xml"><span class="tag">&lt;<span class="name">rule</span>&gt;</span></span></span><br><span class="line">   			<span class="language-xml"><span class="tag">&lt;<span class="name">columns</span>&gt;</span></span>id<span class="language-xml"><span class="tag">&lt;/<span class="name">columns</span>&gt;</span></span></span><br><span class="line">   			<span class="language-xml"><span class="tag">&lt;<span class="name">algorithm</span>&gt;</span></span>rang-long<span class="language-xml"><span class="tag">&lt;/<span class="name">algorithm</span>&gt;</span></span></span><br><span class="line">   <span class="language-xml"><span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span></span><br><span class="line">   </span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">&quot;rang-long&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">	<span class="attr">class</span>=<span class="string">&quot;io.mycat.route.function.AutoPartitionByLong&quot;</span>&gt;</span></span></span><br><span class="line"><span class="code">	&lt;property name=&quot;mapFile&quot;&gt;autopartition-long.txt&lt;/property&gt;</span></span><br><span class="line"><span class="code">&lt;/function&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># 3. 定义范围</span></span><br><span class="line">vim autopartition-long.txt</span><br><span class="line">0-10=0</span><br><span class="line">10-20=1</span><br><span class="line"></span><br><span class="line"><span class="section"># 4. 创建测试表：</span></span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;use taobao;create table t3 (id int not</span><br><span class="line">null primary key auto<span class="emphasis">_increment,name varchar(20) not null);&quot;</span></span><br><span class="line"><span class="emphasis">mysql -S /data/3308/mysql.sock -e &quot;use taobao;create table t3 (id int not</span></span><br><span class="line"><span class="emphasis">null primary key auto_</span>increment,name varchar(20) not null);&quot;</span><br><span class="line"></span><br><span class="line"><span class="section"># 5. 测试：</span></span><br><span class="line">重启mycat</span><br><span class="line">mycat restart</span><br><span class="line">mysql -uroot -p123456 -h 10.0.0.51 -P 8066</span><br><span class="line">insert into t3(id,name) values(1,&#x27;a&#x27;);</span><br><span class="line">insert into t3(id,name) values(2,&#x27;b&#x27;);</span><br><span class="line">insert into t3(id,name) values(3,&#x27;c&#x27;);</span><br><span class="line">insert into t3(id,name) values(4,&#x27;d&#x27;);</span><br><span class="line">insert into t3(id,name) values(11,&#x27;aa&#x27;);</span><br><span class="line">insert into t3(id,name) values(12,&#x27;bb&#x27;);</span><br><span class="line">insert into t3(id,name) values(13,&#x27;cc&#x27;);</span><br><span class="line">insert into t3(id,name) values(14,&#x27;dd&#x27;);</span><br><span class="line">[root@db01 conf]# mysql -S /data/3308/mysql.sock -e &quot;select * from</span><br><span class="line">taobao.t3&quot;</span><br><span class="line">[root@db01 conf]# mysql -S /data/3307/mysql.sock -e &quot;select * from</span><br><span class="line">taobao.t3&quot;</span><br></pre></td></tr></table></figure>

<h2 id="7-2-取模分片"><a href="#7-2-取模分片" class="headerlink" title="7.2 取模分片"></a>7.2 取模分片</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">1%3 1</span><br><span class="line">2%3 2</span><br><span class="line">3%3 0</span><br><span class="line">4%3 1</span><br><span class="line">任何正整数数字和N（正整数）取模，得的值永远都是 0~N-1</span><br><span class="line">id % 分片数量取模</span><br><span class="line">N % 5 = 0-4 idx</span><br><span class="line">取余分片方式：分片键（一个列）与节点数量进行取余，得到余数，将数据写入对应节点</span><br><span class="line"><span class="section"># 1. 修改配置文件</span></span><br><span class="line">vim schema.xml</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;t4&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;sh1,sh2&quot;</span> <span class="attr">rule</span>=<span class="string">&quot;mod-long&quot;</span> /&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="section"># 2. 查看和定义分片使用</span></span><br><span class="line">vim rule.xml</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;count&quot;</span>&gt;</span></span>2<span class="language-xml"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="section"># 3. 准备测试环境</span></span><br><span class="line">创建测试表：</span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;use taobao;create table t4 (id int not</span><br><span class="line">null primary key auto<span class="emphasis">_increment,name varchar(20) not null);&quot;</span></span><br><span class="line"><span class="emphasis">mysql -S /data/3308/mysql.sock -e &quot;use taobao;create table t4 (id int not</span></span><br><span class="line"><span class="emphasis">null primary key auto_</span>increment,name varchar(20) not null);&quot;</span><br><span class="line">重启mycat</span><br><span class="line">mycat restart</span><br><span class="line"></span><br><span class="line"><span class="section"># 4. 测试：</span></span><br><span class="line">mysql -uroot -p123456 -h10.0.0.51 -P8066</span><br><span class="line">use TESTDB</span><br><span class="line">insert into t4(id,name) values(1,&#x27;a&#x27;);</span><br><span class="line">insert into t4(id,name) values(2,&#x27;b&#x27;);</span><br><span class="line">insert into t4(id,name) values(3,&#x27;c&#x27;);</span><br><span class="line">insert into t4(id,name) values(4,&#x27;d&#x27;);</span><br><span class="line">insert into t4(id,name) values(6,&#x27;x&#x27;),(8,&#x27;y&#x27;),(10,&#x27;z&#x27;);</span><br><span class="line">分别登录后端节点查询数据</span><br><span class="line">mysql -S /data/3308/mysql.sock -e &quot;select * from taobao.t4&quot;</span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;select * from taobao.t4&quot;</span><br></pre></td></tr></table></figure>

<h2 id="7-3-月份分片"><a href="#7-3-月份分片" class="headerlink" title="7.3 月份分片"></a>7.3 月份分片</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">假设，tm (id int not null primary key,create<span class="emphasis">_time datetime)</span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">tableRule</span> <span class="attr">name</span>=<span class="string">&quot;sharding-by-month&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis">   <span class="language-xml"><span class="tag">&lt;<span class="name">rule</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis">  	 	<span class="language-xml"><span class="tag">&lt;<span class="name">columns</span>&gt;</span></span>create_</span>time<span class="language-xml"><span class="tag">&lt;/<span class="name">columns</span>&gt;</span></span></span><br><span class="line">  		 <span class="language-xml"><span class="tag">&lt;<span class="name">algorithm</span>&gt;</span></span>partbymonth<span class="language-xml"><span class="tag">&lt;/<span class="name">algorithm</span>&gt;</span></span></span><br><span class="line">   <span class="language-xml"><span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">tableRule</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">&quot;partbymonth&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">		<span class="attr">class</span>=<span class="string">&quot;io.mycat.route.function.PartitionByMonth&quot;</span>&gt;</span></span></span><br><span class="line"><span class="code">		&lt;property name=&quot;dateFormat&quot;&gt;yyyy-MM-dd&lt;/property&gt;</span></span><br><span class="line"><span class="code">		&lt;property name=&quot;sBeginDate&quot;&gt;2020-01-01&lt;/property&gt;</span></span><br><span class="line"><span class="code">&lt;/function</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;use taobao;create table tm (id int not</span><br><span class="line">null primary key auto<span class="emphasis">_increment,create_</span>time datetime not null);&quot;</span><br><span class="line">mysql -S /data/3308/mysql.sock -e &quot;use taobao;create table tm (id int not</span><br><span class="line">null primary key auto<span class="emphasis">_increment,create_</span>time datetime not null);&quot;</span><br><span class="line">测试例子：</span><br></pre></td></tr></table></figure>

<h2 id="7-4-枚举分片"><a href="#7-4-枚举分片" class="headerlink" title="7.4 枚举分片"></a>7.4 枚举分片</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">t5 表</span><br><span class="line">id name telnum</span><br><span class="line">1 bj 1212</span><br><span class="line">2 sh 22222</span><br><span class="line">3 bj 3333</span><br><span class="line">4 sh 44444</span><br><span class="line">5 bj 5555</span><br><span class="line"></span><br><span class="line">sharding-by-intfile</span><br><span class="line"></span><br><span class="line"><span class="section"># 1. 设计分片策略</span></span><br><span class="line">vim schema.xml</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;t5&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;sh1,sh2&quot;</span> <span class="attr">rule</span>=<span class="string">&quot;sharding-by-intfile&quot;</span> /&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="section"># 2. 应用分片策略</span></span><br><span class="line">vim rule.xml</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">tableRule</span> <span class="attr">name</span>=<span class="string">&quot;sharding-by-intfile&quot;</span>&gt;</span></span></span><br><span class="line"><span class="code">	&lt;rule&gt;</span></span><br><span class="line"><span class="code">		&lt;columns&gt;name&lt;/columns&gt;</span></span><br><span class="line"><span class="code">		&lt;algorithm&gt;hash-int&lt;/algorithm&gt;</span></span><br><span class="line"><span class="code">	&lt;/rule&gt;</span></span><br><span class="line"><span class="code">&lt;/tableRule&gt;</span></span><br><span class="line"><span class="code">&lt;function name=&quot;hash-int&quot;</span></span><br><span class="line"><span class="code">class=&quot;org.opencloudb.route.function.PartitionByFileMap&quot;&gt;</span></span><br><span class="line"><span class="code">&lt;property name=&quot;mapFile&quot;&gt;partition-hash-int.txt&lt;/property&gt;</span></span><br><span class="line"><span class="code">	&lt;property name=&quot;type&quot;&gt;1&lt;/property&gt;</span></span><br><span class="line"><span class="code">&lt;/function&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">vim partition-hash-int.txt 配置：</span><br><span class="line">bj=0</span><br><span class="line">sh=1</span><br><span class="line">DEFAULT<span class="emphasis">_NODE=1</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"># 3. 准备测试环境</span></span><br><span class="line"><span class="emphasis">mysql -S /data/3307/mysql.sock -e &quot;use taobao;create table t5 (id int not</span></span><br><span class="line"><span class="emphasis">null primary key auto_</span>increment,name varchar(20) not null);&quot;</span><br><span class="line">mysql -S /data/3308/mysql.sock -e &quot;use taobao;create table t5 (id int not</span><br><span class="line">null primary key auto<span class="emphasis">_increment,name varchar(20) not null);&quot;</span></span><br><span class="line"><span class="emphasis">重启mycat</span></span><br><span class="line"><span class="emphasis">mycat restart</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"># 4. 插入测试数据：</span></span><br><span class="line"><span class="emphasis">mysql -uroot -p123456 -h10.0.0.51 -P8066</span></span><br><span class="line"><span class="emphasis">use TESTDB</span></span><br><span class="line"><span class="emphasis">insert into t5(id,name) values(1,&#x27;bj&#x27;);</span></span><br><span class="line"><span class="emphasis">insert into t5(id,name) values(2,&#x27;sh&#x27;);</span></span><br><span class="line"><span class="emphasis">insert into t5(id,name) values(3,&#x27;bj&#x27;);</span></span><br><span class="line"><span class="emphasis">insert into t5(id,name) values(4,&#x27;sh&#x27;);</span></span><br><span class="line"><span class="emphasis">insert into t5(id,name) values(5,&#x27;tj&#x27;);</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">mysql -S /data/3308/mysql.sock -e &quot;select * from taobao.t5&quot;</span></span><br><span class="line"><span class="emphasis">mysql -S /data/3307/mysql.sock -e &quot;select * from taobao.t5&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="7-5-Mycat全局表"><a href="#7-5-Mycat全局表" class="headerlink" title="7.5 Mycat全局表"></a>7.5 Mycat全局表</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">a b c d .....</span><br><span class="line">join</span><br><span class="line">t</span><br><span class="line"></span><br><span class="line">a</span><br><span class="line">id name age</span><br><span class="line"></span><br><span class="line">1 zs 18 sh1</span><br><span class="line">id addr aid</span><br><span class="line">1001 bj 1</span><br><span class="line">1002 sh 2</span><br><span class="line"></span><br><span class="line">2 ls 19 sh2</span><br><span class="line">id addr aid</span><br><span class="line">1001 bj 1</span><br><span class="line">1002 sh 2</span><br><span class="line"></span><br><span class="line">t</span><br><span class="line">id addr aid</span><br><span class="line">1001 bj 1</span><br><span class="line">1002 sh 2</span><br><span class="line"></span><br><span class="line">使用场景：</span><br><span class="line">如果你的业务中有些数据类似于数据字典，比如配置文件的配置，</span><br><span class="line">常用业务的配置或者数据量不大很少变动的表，这些表往往不是特别大，</span><br><span class="line">而且大部分的业务场景都会用到，那么这种表适合于Mycat全局表，无须对数据进行切分，</span><br><span class="line">要在所有的分片上保存一份数据即可，Mycat 在Join操作中，业务表与全局表进行Join聚合会优先选</span><br><span class="line">择相同分片内的全局表join，</span><br><span class="line">避免跨库Join，在进行数据插入操作时，mycat将把数据分发到全局表对应的所有分片执行，在进行数</span><br><span class="line">据读取时候将会随机获取一个节点读取数据。</span><br><span class="line"></span><br><span class="line"><span class="section"># 1. 设置全局表策略</span></span><br><span class="line">vim schema.xml</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;t_area&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span> <span class="attr">type</span>=<span class="string">&quot;global&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;sh1,sh2&quot;</span> /&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="section"># 2. 后端数据准备</span></span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;use taobao;create table t<span class="emphasis">_area (id int</span></span><br><span class="line"><span class="emphasis">not null primary key auto_</span>increment,name varchar(20) not null);&quot;</span><br><span class="line">mysql -S /data/3308/mysql.sock -e &quot;use taobao;create table t<span class="emphasis">_area (id int</span></span><br><span class="line"><span class="emphasis">not null primary key auto_</span>increment,name varchar(20) not null);&quot;</span><br><span class="line">重启mycat</span><br><span class="line">mycat restart</span><br><span class="line"></span><br><span class="line"><span class="section"># 3. 测试：</span></span><br><span class="line">mysql -uroot -p123456 -h10.0.0.51 -P8066</span><br><span class="line">  use TESTDB</span><br><span class="line"><span class="code">     insert into t_area(id,name) values(1,&#x27;a&#x27;);</span></span><br><span class="line"><span class="code">     insert into t_area(id,name) values(2,&#x27;b&#x27;);</span></span><br><span class="line"><span class="code">     insert into t_area(id,name) values(3,&#x27;c&#x27;);</span></span><br><span class="line"><span class="code">     insert into t_area(id,name) values(4,&#x27;d&#x27;);</span></span><br><span class="line"><span class="code">     </span></span><br><span class="line"><span class="code">mysql -S /data/3308/mysql.sock -e &quot;select * from taobao.t_area&quot;</span></span><br><span class="line"><span class="code">mysql -S /data/3307/mysql.sock -e &quot;select * from taobao.t_area&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="7-6-E-R-分片"><a href="#7-6-E-R-分片" class="headerlink" title="7.6 E-R  分片"></a>7.6 E-R  分片</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">a</span><br><span class="line">join</span><br><span class="line">b</span><br><span class="line">on a.xx =b.yy</span><br><span class="line"></span><br><span class="line">a</span><br><span class="line">id name</span><br><span class="line">1 a sh1</span><br><span class="line">3 c</span><br><span class="line"></span><br><span class="line">2 b sh2</span><br><span class="line">4 d</span><br><span class="line"></span><br><span class="line">b</span><br><span class="line">id addr aid</span><br><span class="line">1001 bj 1</span><br><span class="line">1002 sh 2</span><br><span class="line"></span><br><span class="line">1003 tj 3 sh2</span><br><span class="line">1004 wh 4</span><br><span class="line"></span><br><span class="line">为了防止跨分片join，可以使用E-R模式</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;a&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;sh1,sh2&quot;</span> <span class="attr">rule</span>=<span class="string">&quot;mod-long&quot;</span>&gt;</span></span></span><br><span class="line"><span class="code">		&lt;childTable name=&quot;b&quot; joinKey=&quot;aid&quot; parentKey=&quot;id&quot; /&gt;</span></span><br><span class="line"><span class="code">&lt;/table&gt;</span></span><br><span class="line"><span class="code">      </span></span><br><span class="line"><span class="code">select * from a join b on a.id = b.aid where a.name=d</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">例子：</span><br><span class="line"><span class="bullet">1.</span> 修改配置文件</span><br><span class="line">vim schema.xml</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;a&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;sh1,sh2&quot;</span> <span class="attr">rule</span>=<span class="string">&quot;mod-long_oldguo&quot;</span>&gt;</span></span></span><br><span class="line"><span class="code">			&lt;childTable name=&quot;b&quot; joinKey=&quot;aid&quot; parentKey=&quot;id&quot; /&gt;</span></span><br><span class="line"><span class="code">&lt;/table&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">2.</span> 修改rule.xml mod-log分片策略:</span><br><span class="line">vim rule.xml</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">tableRule</span> <span class="attr">name</span>=<span class="string">&quot;mod-long_oldguo&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">rule</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">columns</span>&gt;</span></span>id<span class="language-xml"><span class="tag">&lt;/<span class="name">columns</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">algorithm</span>&gt;</span></span>mod-long<span class="emphasis">_oldguo<span class="language-xml"><span class="tag">&lt;/<span class="name">algorithm</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;/<span class="name">tableRule</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">&quot;mod-long_oldguo&quot;</span></span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="emphasis"><span class="attr">class</span>=<span class="string">&quot;io.mycat.route.function.PartitionByMod&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis">&lt;!-- how many data nodes --&gt;</span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;count&quot;</span>&gt;</span></span>2<span class="language-xml"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;/<span class="name">function</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">3. 创建测试表</span></span><br><span class="line"><span class="emphasis">mysql -S /data/3307/mysql.sock -e &quot;use taobao;create table a (id int not</span></span><br><span class="line"><span class="emphasis">null primary key auto_</span>increment,name varchar(20) not null);&quot;</span><br><span class="line">mysql -S /data/3307/mysql.sock -e &quot;use taobao;create table b (id int not</span><br><span class="line">null primary key auto<span class="emphasis">_increment,addr varchar(20) not null ,aid int );&quot;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">mysql -S /data/3308/mysql.sock -e &quot;use taobao;create table a (id int not</span></span><br><span class="line"><span class="emphasis">null primary key auto_</span>increment,name varchar(20) not null);&quot;</span><br><span class="line">mysql -S /data/3308/mysql.sock -e &quot;use taobao;create table b (id int not</span><br><span class="line">null primary key auto<span class="emphasis">_increment,addr varchar(20) not null ,aid int );&quot;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">4. 重启mycat 测试</span></span><br><span class="line"><span class="emphasis">mycat restart</span></span><br><span class="line"><span class="emphasis">mysql -uroot -p123456 -h10.0.0.51 -P8066</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">use TESTDB</span></span><br><span class="line"><span class="emphasis">insert into a(id,name) values(1,&#x27;a&#x27;); 1 3308</span></span><br><span class="line"><span class="emphasis">insert into a(id,name) values(2,&#x27;b&#x27;); 0 3307</span></span><br><span class="line"><span class="emphasis">insert into a(id,name) values(3,&#x27;c&#x27;); 1 3308</span></span><br><span class="line"><span class="emphasis">insert into a(id,name) values(4,&#x27;d&#x27;); 0 3307</span></span><br><span class="line"><span class="emphasis">insert into a(id,name) values(5,&#x27;e&#x27;); 1 3308</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">insert into b(id,addr,aid) values(1001,&#x27;bj&#x27;,1); 1 3308</span></span><br><span class="line"><span class="emphasis">insert into b(id,addr,aid) values(1002,&#x27;sj&#x27;,3); 1 3308</span></span><br><span class="line"><span class="emphasis">insert into b(id,addr,aid) values(1003,&#x27;sd&#x27;,4); 0 3307</span></span><br><span class="line"><span class="emphasis">insert into b(id,addr,aid) values(1004,&#x27;we&#x27;,2); 0 3307</span></span><br><span class="line"><span class="emphasis">insert into b(id,addr,aid) values(1005,&#x27;er&#x27;,5); 0 3307</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">========================================================</span></span><br><span class="line"><span class="emphasis">后端数据节点数据分布：</span></span><br><span class="line"><span class="emphasis">mysql -S /data/3307/mysql.sock -e &quot;select * from taobao.a&quot;</span></span><br><span class="line"><span class="emphasis">mysql -S /data/3307/mysql.sock -e &quot;select * from taobao.b&quot;</span></span><br><span class="line"><span class="emphasis">mysql -S /data/3308/mysql.sock -e &quot;select * from taobao.a&quot;</span></span><br><span class="line"><span class="emphasis">mysql -S /data/3308/mysql.sock -e &quot;select * from taobao.b&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="8-管理类操作"><a href="#8-管理类操作" class="headerlink" title="8. 管理类操作"></a>8. 管理类操作</h1><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@db01 conf]# mysql -uroot -p123456 -h10.0.0.51 -P9066</span><br><span class="line"><span class="section"># 查看帮助</span></span><br><span class="line">show @@help;</span><br><span class="line"><span class="section"># 重新加载配置信息</span></span><br><span class="line">reload @@config ： schema.xml</span><br><span class="line">reload @@config<span class="emphasis">_all : 所有配置重新加载</span></span><br><span class="line"><span class="emphasis">rollback @@config | Rollback all config from memory</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"># sql监控分析功能，建议在做压测的时候关闭。</span></span><br><span class="line"><span class="emphasis">reload @@sqlstat=open | Open real-time sql stat analyzer</span></span><br><span class="line"><span class="emphasis">reload @@sqlstat=close | Close real-time sql stat analyzer</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"># 查看Mycat 服务情况</span></span><br><span class="line"><span class="emphasis">show @@server ;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"># 查看分片DN节点信息</span></span><br><span class="line"><span class="emphasis">mysql&gt; show @@datanode;</span></span><br><span class="line"><span class="emphasis">mysql&gt; show @@datanode where schema = ?;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"># 查看数据源</span></span><br><span class="line"><span class="emphasis">show @@datasource</span></span><br><span class="line"><span class="emphasis">show @@datasource where datanode=sh1;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"># 报告心跳信息</span></span><br><span class="line"><span class="emphasis">show @@heartbeat</span></span><br><span class="line"><span class="emphasis">show @@heartbeat.detail where name=?</span></span><br><span class="line"><span class="emphasis">RS_</span>CODE :</span><br><span class="line">-1：连接失败</span><br><span class="line">1 ：连接正常</span><br><span class="line">-2：连接超时</span><br><span class="line">0 ：初始化状态</span><br><span class="line">如果节点故障，会有5次检测，失败后则状态为-1。</span><br><span class="line"><span class="section"># 查看连接信息</span></span><br><span class="line">show @@connection</span><br><span class="line"><span class="section"># 关闭连接</span></span><br><span class="line">kill @@connection id1,id2,...</span><br><span class="line"><span class="section"># 查看后端连接</span></span><br><span class="line">show @@backend</span><br><span class="line"><span class="section"># 查看缓存应用情况</span></span><br><span class="line">show @@cache;</span><br><span class="line"><span class="section"># 查看sql统计</span></span><br><span class="line">mysql&gt; show @@sql;</span><br><span class="line">mysql&gt; show @@sql<span class="emphasis">_slow;</span></span><br><span class="line"><span class="emphasis">mysql&gt; show @@sql.sum;</span></span><br></pre></td></tr></table></figure>

<h1 id="9-其他管理"><a href="#9-其他管理" class="headerlink" title="9.其他管理"></a>9.其他管理</h1><h2 id="9-1-配置Mycat的日志管理"><a href="#9-1-配置Mycat的日志管理" class="headerlink" title="9.1 配置Mycat的日志管理"></a>9.1 配置Mycat的日志管理</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">asyncRoot</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span> <span class="attr">includeLocation</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span></span><br><span class="line">级别：All &lt; Trace &lt; Debug &lt; Info &lt; Warn &lt; Error &lt; Fatal &lt; OFF</span><br><span class="line"><span class="code">                                                       </span></span><br><span class="line"><span class="code">调试建议使用 Debug 级别，生产上一般使用 Info级别 </span></span><br></pre></td></tr></table></figure>

<h2 id="9-2-配置Mycat的服务器参数"><a href="#9-2-配置Mycat的服务器参数" class="headerlink" title="9.2 配置Mycat的服务器参数"></a>9.2 配置Mycat的服务器参数</h2><h3 id="charset-属性"><a href="#charset-属性" class="headerlink" title="charset 属性"></a>charset 属性</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">该属性用于字符集设置。</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">system</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;charset&quot;</span>&gt;</span></span>utf8<span class="language-xml"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">system</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="processors-属性"><a href="#processors-属性" class="headerlink" title="processors 属性"></a>processors 属性</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   该属性主要用于指定系统可用的线程数，默认值为机器 CPU 核心线程数。主要影响</span><br><span class="line">processorBufferPool、 processorBufferLocalPercent、 processorExecutor 属性。</span><br><span class="line">NIOProcessor 的个数也是由这个属性定义的，所以调优的时候可以适当的调高这个属性。</span><br></pre></td></tr></table></figure>

<h3 id="processorBufferChunk-属性"><a href="#processorBufferChunk-属性" class="headerlink" title="processorBufferChunk 属性"></a>processorBufferChunk 属性</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  该属性指定每次分配 Socket Direct Buffer 的大小，默认是 4096 个字节。这个属性也影响</span><br><span class="line">buffer pool 的长度。如果一次性获取的数过大 buffer 不够用会经常出现警告，此时可以适当调</span><br><span class="line">大。</span><br></pre></td></tr></table></figure>

<h3 id="processorBufferPool-属性"><a href="#processorBufferPool-属性" class="headerlink" title="processorBufferPool 属性"></a>processorBufferPool 属性</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">该属性指定 bufferPool 计算比例值。由于每次执行 NIO 读、写操作都需要使用到 buffer，</span><br><span class="line">系统初始化的时候会建立一定长度的 buffer 池来加快读、写的效率，减少建立 buffer 的时间。</span><br><span class="line">Mycat 中有两个主要的 buffer 池：</span><br><span class="line"></span><br><span class="line">BufferPool：BufferPool 由 ThreadLocalPool 组合而成，每次从 BufferPool 中获</span><br><span class="line">取 buffer 都会优先获取ThreadLocalPool 中的 buffer，未命中之后才会去获取 BufferPool</span><br><span class="line">中的 buffer。也就是说 ThreadLocalPool 是作为 BufferPool 的二级缓存，每个线程内部</span><br><span class="line">自己使用的。BufferPool 上的 buffer 则是每个 NIOProcessor 都共享的。这个属性的默认值</span><br><span class="line">为：</span><br><span class="line"><span class="code">	默认bufferChunkSize(4096) * processors属性 * 1000</span></span><br><span class="line"><span class="code">	BufferPool 的总长度 = bufferPool / bufferChunk。</span></span><br><span class="line"><span class="code">	若 bufferPool 不是 bufferChunk 的整数倍，则总长度为前面计算得出的商 + 1</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">假设系统线程数为 4，其他都为属性的默认值，则：</span><br><span class="line">bufferPool ＝ 4096 * 4 * 1000</span><br><span class="line">BufferPool 的总长度 : 4000 = 16384000 / 4096</span><br></pre></td></tr></table></figure>

<h3 id="processorBufferLocalPercent-属性"><a href="#processorBufferLocalPercent-属性" class="headerlink" title="processorBufferLocalPercent 属性:"></a>processorBufferLocalPercent 属性:</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">前面提到了 ThreadLocalPool。这个属性就是用来控制分配这个 pool 的大小用的，这个属性</span><br><span class="line">默认值为 100。</span><br><span class="line"></span><br><span class="line"><span class="code">	线程缓存百分比 = bufferLocalPercent / processors 属性。</span></span><br><span class="line"><span class="code">	例如，系统可以同时运行 4 个线程，使用默认值，则根据公式每个线程的百分比为 25。最后根据</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">这个百分比来计算出具体的 ThreadLocalPool 的长度公式如下：</span><br><span class="line"><span class="code">	ThreadLocalPool 的长度 = 线程缓存百分比 * BufferPool 长度 / 100</span></span><br><span class="line"><span class="code">	假设 BufferPool 的长度为 4000，其他保持默认值。</span></span><br><span class="line"><span class="code">	那么最后每个线程建立上的 ThreadLocalPool 的长度为： 1000 = 25 * 4000 / 100</span></span><br></pre></td></tr></table></figure>

<h3 id="心跳属性"><a href="#心跳属性" class="headerlink" title="心跳属性"></a>心跳属性</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mycat 中有几个周期性的任务来异步的处理一些我需要的工作。这些属性就在系统调优的过程中也是比</span><br><span class="line">不可少的。</span><br><span class="line"></span><br><span class="line">processorCheckPeriod :</span><br><span class="line">清理 NIOProcessor 上前后端空闲、超时和关闭连接的间隔时间。默认是 1 秒，单位毫秒。</span><br><span class="line"></span><br><span class="line">dataNodeIdleCheckPeriod :</span><br><span class="line">对后端连接进行空闲、超时检查的时间间隔，默认是 300 秒，单位毫秒。</span><br><span class="line"></span><br><span class="line">dataNodeHeartbeatPeriod :</span><br><span class="line">对后端所有读、写库发起心跳的间隔时间，默认是 10 秒，单位毫秒。</span><br></pre></td></tr></table></figure>

<h3 id="服务相关属性"><a href="#服务相关属性" class="headerlink" title="服务相关属性"></a>服务相关属性</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bindIp :</span><br><span class="line">mycat 服务监听的 IP 地址，默认值为 0.0.0.0。</span><br><span class="line"></span><br><span class="line">serverPort :</span><br><span class="line">定义 mycat 的使用端口，默认值为 8066。</span><br><span class="line"></span><br><span class="line">managerPort :</span><br><span class="line">定义 mycat 的管理端口，默认值为 9066。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Mysql-连接相关属性"><a href="#Mysql-连接相关属性" class="headerlink" title="Mysql 连接相关属性"></a>Mysql 连接相关属性</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">packetHeaderSize :</span><br><span class="line"><span class="code">	指定 Mysql 协议中的报文头长度。默认 4。</span></span><br><span class="line"><span class="code">maxPacketSize :</span></span><br><span class="line"><span class="code">	指定 Mysql 协议可以携带的数据最大长度。默认 16M。</span></span><br><span class="line"><span class="code">idleTimeout :</span></span><br><span class="line"><span class="code">	指定连接的空闲超时时间。某连接在发起空闲检查下，发现距离上次使用超过了空闲时间，那么这</span></span><br><span class="line"><span class="code">个连接会被回收，就是被直接的关闭掉。默认 30 分钟，单位毫秒。</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">charset :</span><br><span class="line"><span class="code">	连接的初始化字符集。默认为 utf8。</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">txIsolation :</span><br><span class="line"><span class="code">	前端连接的初始化事务隔离级别，只在初始化的时候使用，后续会根据客户端传递过来的属性对后</span></span><br><span class="line"><span class="code">端数据库连接进行同步。默认为 REPEATED_READ，设置值为数字默认 3。</span></span><br><span class="line"><span class="code">READ_UNCOMMITTED = 1;</span></span><br><span class="line"><span class="code">READ_COMMITTED = 2;</span></span><br><span class="line"><span class="code">REPEATED_READ = 3;</span></span><br><span class="line"><span class="code">SERIALIZABLE = 4;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">sqlExecuteTimeout :</span><br><span class="line"><span class="code">	SQL 执行超时的时间，Mycat 会检查连接上最后一次执行 SQL 的时间，若超过这个时间则会直</span></span><br><span class="line"><span class="code">接关闭这连接。默认时间为 300 秒，单位秒。</span></span><br></pre></td></tr></table></figure>

<h1 id="10-逻辑库配置"><a href="#10-逻辑库配置" class="headerlink" title="10.逻辑库配置"></a>10.逻辑库配置</h1><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 总配置文件</span></span><br><span class="line">schema.xml</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;oldboy&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">dataNode</span>=<span class="string">&quot;sh1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="code">	sh3</span></span><br><span class="line"><span class="code">	sh4</span></span><br><span class="line"><span class="code">&lt;/schema&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># mycat 服务配置</span></span><br><span class="line">server.xml</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;root&quot;</span> <span class="attr">defaultAccount</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span></span><br><span class="line"><span class="code">      &lt;property name=&quot;password&quot;&gt;123456&lt;/property&gt;</span></span><br><span class="line"><span class="code">      &lt;property name=&quot;schemas&quot;&gt;oldboy&lt;/property&gt;</span></span><br><span class="line"><span class="code">      &lt;property name=&quot;defaultSchema&quot;&gt;oldboy&lt;/property&gt;</span></span><br><span class="line"><span class="code">			&lt;!--No MyCAT Database selected 错误前会尝试使用该schema作为</span></span><br><span class="line"><span class="code">   </span></span><br><span class="line"><span class="code">schema，不设置则为null,报错 --&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">	&lt;!-- 表级 DML 权限设置 --&gt;</span></span><br><span class="line"><span class="code">	&lt;!--</span></span><br><span class="line"><span class="code">	&lt;privileges check=&quot;false&quot;&gt;</span></span><br><span class="line"><span class="code">			&lt;schema name=&quot;TESTDB&quot; dml=&quot;0110&quot; &gt;</span></span><br><span class="line"><span class="code">					&lt;table name=&quot;tb01&quot; dml=&quot;0000&quot;&gt;&lt;/table&gt;</span></span><br><span class="line"><span class="code">					&lt;table name=&quot;tb02&quot; dml=&quot;1111&quot;&gt;&lt;/table&gt;</span></span><br><span class="line"><span class="code">			&lt;/schema&gt;</span></span><br><span class="line"><span class="code">	&lt;/privileges&gt;</span></span><br><span class="line"><span class="code">  --&gt;</span></span><br><span class="line"><span class="code">&lt;/user&gt;</span></span><br><span class="line"><span class="code">		&lt;user name=&quot;user&quot;&gt;</span></span><br><span class="line"><span class="code">				&lt;property name=&quot;password&quot;&gt;user&lt;/property&gt;</span></span><br><span class="line"><span class="code">				&lt;property name=&quot;schemas&quot;&gt;oldboy&lt;/property&gt;</span></span><br><span class="line"><span class="code">				&lt;property name=&quot;readOnly&quot;&gt;true&lt;/property&gt;</span></span><br><span class="line"><span class="code">				&lt;property name=&quot;defaultSchema&quot;&gt;oldboy&lt;/property&gt;</span></span><br><span class="line"><span class="code">		&lt;/user&gt;</span></span><br><span class="line"><span class="code">reload @@config_all : 所有配置重新加载</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">2.</span> 添加一个逻辑库</span><br><span class="line"><span class="code">	schema.xml</span></span><br><span class="line"><span class="code">		&lt;schema name=&quot;oldboy&quot; checkSQLschema=&quot;false&quot; sqlMaxLimit=&quot;100&quot;</span></span><br><span class="line"><span class="code">dataNode=&quot;sh1&quot;&gt;</span></span><br><span class="line"><span class="code">		&lt;/schema&gt;</span></span><br><span class="line"><span class="code">  </span></span><br><span class="line"><span class="code">server.xml</span></span><br><span class="line"><span class="code">	&lt;property name=&quot;schemas&quot;&gt;oldboy,oldguo&lt;/property&gt;</span></span><br><span class="line"><span class="code"> </span></span><br><span class="line"><span class="code">reload @@config_all : 所有配置重新加载</span></span><br></pre></td></tr></table></figure>

<h1 id="11-sequence分布式全局序列"><a href="#11-sequence分布式全局序列" class="headerlink" title="11.sequence分布式全局序列"></a>11.sequence分布式全局序列</h1><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">	在实现分库分表的情况下，数据库自增主键已经无法保证在集群中是全局唯一的主键了，因此</span></span><br><span class="line"><span class="code">mycat提供了全局的sequence.</span></span><br></pre></td></tr></table></figure>

<h2 id="11-1-本地方式"><a href="#11-1-本地方式" class="headerlink" title="11.1 本地方式"></a>11.1 本地方式</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">采用该方式，mycat将sequence配置到classpath目录的sequence<span class="emphasis">_conf.properties文件中，</span></span><br><span class="line"><span class="emphasis">在sequence_</span>conf.properties文件做如下配置</span><br><span class="line"></span><br><span class="line">GLOBAL<span class="emphasis">_SEQ.HISIDS=</span></span><br><span class="line"><span class="emphasis">GLOBAL_</span>SEQ.MINID=1001</span><br><span class="line">GLOBAL<span class="emphasis">_SEQ.MAXID=100000000</span></span><br><span class="line"><span class="emphasis">GLOBAL_</span>SEQ.CURID=1000</span><br><span class="line"></span><br><span class="line">其中HISIDS表示历史分段（一般无特殊需要则可以不配置），MINID表示最新的ID值，MAXID表示最</span><br><span class="line">大的ID值，CURID表示当前的ID值。</span><br><span class="line"></span><br><span class="line"><span class="bullet">0.</span> 打开本地seq功能。</span><br><span class="line">需要启用这种方式，则首先需要在server.xml中配置如下参数：</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">system</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sequnceHandlerType&quot;</span>&gt;</span></span>0<span class="language-xml"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">system</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">配置测试：</span><br><span class="line"><span class="bullet">1.</span> 修改sequence<span class="emphasis">_conf.properties</span></span><br><span class="line"><span class="emphasis">vim sequence_</span>conf.properties</span><br><span class="line"><span class="section">#全局seq</span></span><br><span class="line">GLOBAL<span class="emphasis">_SEQ.HISIDS=</span></span><br><span class="line"><span class="emphasis">GLOBAL_</span>SEQ.MINID=1001</span><br><span class="line">GLOBAL<span class="emphasis">_SEQ.MAXID=10000000</span></span><br><span class="line"><span class="emphasis">GLOBAL_</span>SEQ.CURID=1000</span><br><span class="line">或者：自己定制</span><br><span class="line"><span class="section"># self define sequence</span></span><br><span class="line">OLDGUO.HISIDS=</span><br><span class="line">OLDGUO.MINID=2001</span><br><span class="line">OLDGUO.MAXID=20000000</span><br><span class="line">OLDGUO.CURID=2000</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> 设置server.xml</span><br><span class="line">&lt;!--lang:java--&gt;</span><br><span class="line">public static final int SEQUENCEHANDLER<span class="emphasis">_LOCALFILE = 0;</span></span><br><span class="line"><span class="emphasis">public static final int SEQUENCEHANDLER_</span>MYSQLDB = 1;</span><br><span class="line">public static final int SEQUENCEHANDLER<span class="emphasis">_LOCAL_</span>TIME = 2;</span><br><span class="line">private int sequnceHandlerType = SEQUENCEHANDLER<span class="emphasis">_LOCALFILE;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">3.建表，插入数据测试</span></span><br><span class="line"><span class="emphasis">mysql&gt; create table test(id int not null primary key ,name varchar(20));</span></span><br><span class="line"><span class="emphasis">Query OK, 0 rows affected (0.04 sec)</span></span><br><span class="line"><span class="emphasis">mysql&gt; insert into test(id,name) values(next value for</span></span><br><span class="line"><span class="emphasis">MYCATSEQ_</span>OLDGUO,@@hostname);</span><br><span class="line">Query OK, 1 row affected (0.07 sec)</span><br><span class="line">mysql&gt;</span><br><span class="line">mysql&gt;</span><br><span class="line">mysql&gt; select * from test;</span><br><span class="line">+-------+------+</span><br><span class="line">| id | name    |</span><br><span class="line">+-------+------+</span><br><span class="line">| 10001 | db02 |</span><br><span class="line">+-------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test(id,name) values(next value for</span><br><span class="line">MYCATSEQ<span class="emphasis">_GLOBAL,@@hostname);</span></span><br><span class="line"><span class="emphasis">Query OK, 1 row affected (0.01 sec)</span></span><br><span class="line"><span class="emphasis">mysql&gt; select * from test;</span></span><br><span class="line"><span class="emphasis">+-------+------+</span></span><br><span class="line"><span class="emphasis">| id | name    |</span></span><br><span class="line"><span class="emphasis">+-------+------+</span></span><br><span class="line"><span class="emphasis">| 10001 | db02 |</span></span><br><span class="line"><span class="emphasis">| 10002 | db02 |</span></span><br><span class="line"><span class="emphasis">+-------+------+</span></span><br><span class="line"><span class="emphasis">2 rows in set (0.00 sec)</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">mysql&gt; select * from test;</span></span><br><span class="line"><span class="emphasis">+-------+------+</span></span><br><span class="line"><span class="emphasis">| id | name    |</span></span><br><span class="line"><span class="emphasis">+-------+------+</span></span><br><span class="line"><span class="emphasis">| 10001 | db02 |</span></span><br><span class="line"><span class="emphasis">| 10002 | db02 |</span></span><br><span class="line"><span class="emphasis">+-------+------+</span></span><br><span class="line"><span class="emphasis">2 rows in set (0.01 sec)</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">mysql&gt; insert into test(id,name) values(next value for</span></span><br><span class="line"><span class="emphasis">MYCATSEQ_</span>GLOBAL,@@hostname);</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line">mysql&gt; select * from test;</span><br><span class="line">+-------+------+</span><br><span class="line">| id | name 	 |</span><br><span class="line">+-------+------+</span><br><span class="line">| 10001 | db02 |</span><br><span class="line">| 10002 | db02 |</span><br><span class="line">| 10003 | db02 |</span><br><span class="line">+-------+------+</span><br></pre></td></tr></table></figure>

<h2 id="11-2-数据库方式"><a href="#11-2-数据库方式" class="headerlink" title="11.2 数据库方式"></a>11.2 数据库方式</h2><h3 id="11-2-1-原理"><a href="#11-2-1-原理" class="headerlink" title="11.2.1 原理"></a>11.2.1 原理</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">	在数据库中建立一张表，存放 sequence 名称(name)，sequence 当前值(current_value)，步长</span></span><br><span class="line"><span class="code">(increment int 类型每次读取多少个 sequence，假设为 K)等信息；</span></span><br></pre></td></tr></table></figure>

<h3 id="11-2-2-获取步骤"><a href="#11-2-2-获取步骤" class="headerlink" title="11.2.2 获取步骤"></a>11.2.2 获取步骤</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">当初次使用该 sequence 时，根据传入的 sequence 名称，从数据库这张表中读取</span><br><span class="line">current<span class="emphasis">_value，和 increment 到 MyCat 中，并将数据库中的 current_</span>value 设置为原</span><br><span class="line">current<span class="emphasis">_value 值+increment 值；</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">MyCat 将读取到 current_</span>value+increment 作为本次要使用的 sequence 值，下次使用时，自</span><br><span class="line">动加 1，当 使用 increment 次后，执行步骤 1)相同的操作. MyCat 负责维护这张表，用到哪些</span><br><span class="line">sequence，只需要在这张表中插入一条记录即可。若某次读取的 sequence 没有用完，系统就停掉</span><br><span class="line">了，则这次读取的 sequence 剩余值不会再使用。</span><br></pre></td></tr></table></figure>

<h3 id="11-2-3-配置细节"><a href="#11-2-3-配置细节" class="headerlink" title="11.2.3 配置细节"></a>11.2.3 配置细节</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 修改Mycat配置文件server.xml</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sequnceHandlerType&quot;</span>&gt;</span></span>1<span class="language-xml"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="section"># 修改Mycat配置文件schema.xml</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;t&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span> <span class="attr">autoIncrement</span>=<span class="string">&quot;true&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;sh1,sh2&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">rule</span>=<span class="string">&quot;mod-long&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;MYCAT_SEQUENCE&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;name&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;sh2&quot;</span>/&gt;</span></span></span><br><span class="line">  </span><br><span class="line"><span class="section"># 修改Mycat 配置文件 sequence<span class="emphasis">_db_</span>conf.properties，</span></span><br><span class="line">GLOBAL=sh2 ---&gt;修改</span><br><span class="line">COMPANY=dn1</span><br><span class="line">CUSTOMER=dn1</span><br><span class="line">ORDERS=dn1</span><br><span class="line"></span><br><span class="line"><span class="section"># 在sh2节点的 主 数据库中添加 MYCAT<span class="emphasis">_SEQUENCE表</span></span></span><br><span class="line"><span class="emphasis"><span class="section">DROP TABLE IF EXISTS MYCAT_</span>SEQUENCE;</span></span><br><span class="line">CREATE TABLE MYCAT<span class="emphasis">_SEQUENCE (name VARCHAR(50) NOT NULL,current_</span>value INT</span><br><span class="line">NOT NULL,increment INT NOT NULL DEFAULT 100, PRIMARY KEY(name))</span><br><span class="line">ENGINE=InnoDB;</span><br><span class="line"><span class="section"># 在dn2节点的 主库数据库中的 MYCAT<span class="emphasis">_SEQUENCE 表插入sequence初始记录</span></span></span><br><span class="line"><span class="emphasis"><span class="section">insert into MYCAT_</span>SEQUENCE(name,current<span class="emphasis">_value,increment)</span></span></span><br><span class="line"><span class="emphasis"><span class="section">VALUES(&#x27;GLOBAL&#x27;,10000,100);</span></span></span><br><span class="line"><span class="emphasis"><span class="section"># 在dn2节点的 主数据库中创建存储过程</span></span></span><br><span class="line"><span class="emphasis"><span class="section">## 获取当前sequence的值：</span></span></span><br><span class="line"><span class="emphasis"><span class="section">DROP FUNCTION IF EXISTS mycat_</span>seq<span class="emphasis">_currval;</span></span></span><br><span class="line"><span class="emphasis"><span class="section">DELIMITER $</span></span></span><br><span class="line"><span class="emphasis"><span class="section">CREATE FUNCTION mycat_</span>seq<span class="emphasis">_currval(seq_</span>name VARCHAR(50)) RETURNS varchar(64)</span></span><br><span class="line">CHARSET utf8</span><br><span class="line">DETERMINISTIC</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE retval VARCHAR(64);</span><br><span class="line">SET retval=&quot;-999999999,null&quot;;</span><br><span class="line">SELECT concat(CAST(current<span class="emphasis">_value AS CHAR),&quot;,&quot;,CAST(increment AS CHAR)) INTO</span></span><br><span class="line"><span class="emphasis">retval FROM MYCAT_</span>SEQUENCE WHERE name = seq<span class="emphasis">_name;</span></span><br><span class="line"><span class="emphasis">RETURN retval;</span></span><br><span class="line"><span class="emphasis">END $</span></span><br><span class="line"><span class="emphasis">DELIMITER ;</span></span><br><span class="line"><span class="emphasis">## 设置sequence值：</span></span><br><span class="line"><span class="emphasis">DROP FUNCTION IF EXISTS mycat_</span>seq<span class="emphasis">_setval;</span></span><br><span class="line"><span class="emphasis">DELIMITER $</span></span><br><span class="line"><span class="emphasis">CREATE FUNCTION mycat_</span>seq<span class="emphasis">_setval(seq_</span>name VARCHAR(50),value INTEGER)</span><br><span class="line">RETURNS varchar(64) CHARSET utf8</span><br><span class="line">DETERMINISTIC</span><br><span class="line">BEGIN</span><br><span class="line">UPDATE MYCAT<span class="emphasis">_SEQUENCE</span></span><br><span class="line"><span class="emphasis">SET current_</span>value = value</span><br><span class="line">WHERE name = seq<span class="emphasis">_name;</span></span><br><span class="line"><span class="emphasis">RETURN mycat_</span>seq<span class="emphasis">_currval(seq_</span>name);</span><br><span class="line">END $</span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="section">## 获取下一个sequence值：</span></span><br><span class="line">DROP FUNCTION IF EXISTS mycat<span class="emphasis">_seq_</span>nextval;</span><br><span class="line">DELIMITER $</span><br><span class="line">CREATE FUNCTION mycat<span class="emphasis">_seq_</span>nextval(seq<span class="emphasis">_name VARCHAR(50)) RETURNS varchar(64)</span></span><br><span class="line"><span class="emphasis">CHARSET utf8</span></span><br><span class="line"><span class="emphasis">DETERMINISTIC</span></span><br><span class="line"><span class="emphasis">BEGIN</span></span><br><span class="line"><span class="emphasis">UPDATE MYCAT_</span>SEQUENCE</span><br><span class="line">SET current<span class="emphasis">_value = current_</span>value + increment WHERE name = seq<span class="emphasis">_name;</span></span><br><span class="line"><span class="emphasis">RETURN mycat_</span>seq<span class="emphasis">_currval(seq_</span>name);</span><br><span class="line">END $</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="section"># 测试获取全局自增ID</span></span><br><span class="line">mysql&gt; insert into t4(id,name) values(NEXT VALUE FOR MYCATSEQ<span class="emphasis">_GLOBAL,&#x27;zy&#x27;)</span></span><br><span class="line"><span class="emphasis">;</span></span><br></pre></td></tr></table></figure>

<h2 id="11-3-时间戳方式"><a href="#11-3-时间戳方式" class="headerlink" title="11.3 时间戳方式"></a>11.3 时间戳方式</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ID= 64 位二进制 (42(毫秒)+5(机器 ID)+5(业务编码)+12(重复累加)</span><br><span class="line">server.xml：</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">system</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sequnceHandlerType&quot;</span>&gt;</span></span>2<span class="language-xml"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">system</span>&gt;</span></span></span><br><span class="line">sequence<span class="emphasis">_time_</span>conf.properties：</span><br><span class="line">WORKID=0-31 任意整数</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/mysql/" rel="tag"><i class="fa fa-tag"></i> mysql</a>
              <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"><i class="fa fa-tag"></i> 分布式</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/07/15/%E9%AB%98%E5%8F%AF%E7%94%A8%E6%8A%80%E6%9C%AF/" rel="prev" title="高可用技术">
      <i class="fa fa-chevron-left"></i> 高可用技术
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/07/15/%E4%B8%BB%E5%A4%87%E5%A4%8D%E5%88%B6/" rel="next" title="主备复制">
      主备复制 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84-%E6%BC%94%E5%8F%98"><span class="nav-number">1.</span> <span class="nav-text">1、分布式架构-演变</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2%E3%80%81%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.</span> <span class="nav-text">2、基础架构介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%EF%BC%9A"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 环境准备：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E5%88%A0%E9%99%A4%E5%8E%86%E5%8F%B2%E7%8E%AF%E5%A2%83%EF%BC%9A"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 删除历史环境：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-%E5%88%9B%E5%BB%BA%E7%9B%B8%E5%85%B3%E7%9B%AE%E5%BD%95%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 创建相关目录初始化数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-%E5%87%86%E5%A4%87%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%92%8C%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC"><span class="nav-number">2.4.</span> <span class="nav-text">2.4 准备配置文件和启动脚本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-%E4%BF%AE%E6%94%B9%E6%9D%83%E9%99%90%EF%BC%8C%E5%90%AF%E5%8A%A8%E5%A4%9A%E5%AE%9E%E4%BE%8B"><span class="nav-number">2.5.</span> <span class="nav-text">2.5 修改权限，启动多实例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-%E8%8A%82%E7%82%B9%E4%B8%BB%E4%BB%8E%E8%A7%84%E5%88%92"><span class="nav-number">2.6.</span> <span class="nav-text">2.6 节点主从规划</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-7-%E5%BC%80%E5%A7%8B%E9%85%8D%E7%BD%AE%E4%B8%BB%E4%BB%8E%E7%8E%AF%E5%A2%83"><span class="nav-number">2.7.</span> <span class="nav-text">2.7 开始配置主从环境</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-MyCAT%E5%AE%89%E8%A3%85"><span class="nav-number">3.</span> <span class="nav-text">3.MyCAT安装</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-%E9%A2%84%E5%85%88%E5%AE%89%E8%A3%85Java%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 预先安装Java运行环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2%E4%B8%8B%E8%BD%BD"><span class="nav-number">3.2.</span> <span class="nav-text">3.2下载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 解压文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-%E8%BD%AF%E4%BB%B6%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 软件目录结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-5-%E5%90%AF%E5%8A%A8%E5%92%8C%E8%BF%9E%E6%8E%A5"><span class="nav-number">3.5.</span> <span class="nav-text">3.5 启动和连接</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="nav-number">4.</span> <span class="nav-text">4.配置文件介绍</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-schema-xml%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="nav-number">5.</span> <span class="nav-text">5.schema.xml配置文件基本结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%AE%80%E5%8D%95%E8%AF%95%E6%B0%B4-%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="nav-number">5.1.</span> <span class="nav-text">5.2 配置文件简单试水-读写分离</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-%E9%85%8D%E7%BD%AE%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E5%8F%8A%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="nav-number">5.2.</span> <span class="nav-text">5.3 配置读写分离及高可用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-Schema-xml%E6%A0%B8%E5%BF%83%E5%8F%82%E6%95%B0%E4%BB%8B%E7%BB%8D"><span class="nav-number">5.3.</span> <span class="nav-text">5.4 Schema.xml核心参数介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-1-balance%E5%B1%9E%E6%80%A7"><span class="nav-number">5.3.1.</span> <span class="nav-text">5.4.1 balance属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-2-writeType%E5%B1%9E%E6%80%A7"><span class="nav-number">5.3.2.</span> <span class="nav-text">5.4.2 writeType属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-3-switchType%E5%B1%9E%E6%80%A7"><span class="nav-number">5.3.3.</span> <span class="nav-text">5.4.3 switchType属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-4-%E8%BF%9E%E6%8E%A5%E6%9C%89%E5%85%B3"><span class="nav-number">5.3.4.</span> <span class="nav-text">5.4.4 连接有关</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-5-tempReadHostAvailable-x3D-%E2%80%9D1%E2%80%9D"><span class="nav-number">5.3.5.</span> <span class="nav-text">5.4.5 tempReadHostAvailable&#x3D;”1”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-6-checkSQLschema-x3D-%E2%80%9Dfalse%E2%80%9D"><span class="nav-number">5.3.6.</span> <span class="nav-text">5.4.6 checkSQLschema&#x3D;”false”</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-Mycat-%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%E2%80%93%E5%9E%82%E7%9B%B4%E5%88%86%E8%A1%A8"><span class="nav-number">6.</span> <span class="nav-text">6.Mycat 分布式架构–垂直分表</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-Mycat-%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%E2%80%93%E6%B0%B4%E5%B9%B3%E6%8B%86%E5%88%86"><span class="nav-number">7.</span> <span class="nav-text">7. Mycat 分布式架构–水平拆分</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-0-%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5"><span class="nav-number">7.1.</span> <span class="nav-text">7.0 重要概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-%E8%8C%83%E5%9B%B4%E5%88%86%E7%89%87"><span class="nav-number">7.2.</span> <span class="nav-text">7.1 范围分片</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-%E5%8F%96%E6%A8%A1%E5%88%86%E7%89%87"><span class="nav-number">7.3.</span> <span class="nav-text">7.2 取模分片</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-3-%E6%9C%88%E4%BB%BD%E5%88%86%E7%89%87"><span class="nav-number">7.4.</span> <span class="nav-text">7.3 月份分片</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-4-%E6%9E%9A%E4%B8%BE%E5%88%86%E7%89%87"><span class="nav-number">7.5.</span> <span class="nav-text">7.4 枚举分片</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-5-Mycat%E5%85%A8%E5%B1%80%E8%A1%A8"><span class="nav-number">7.6.</span> <span class="nav-text">7.5 Mycat全局表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-6-E-R-%E5%88%86%E7%89%87"><span class="nav-number">7.7.</span> <span class="nav-text">7.6 E-R  分片</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-%E7%AE%A1%E7%90%86%E7%B1%BB%E6%93%8D%E4%BD%9C"><span class="nav-number">8.</span> <span class="nav-text">8. 管理类操作</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-%E5%85%B6%E4%BB%96%E7%AE%A1%E7%90%86"><span class="nav-number">9.</span> <span class="nav-text">9.其他管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-1-%E9%85%8D%E7%BD%AEMycat%E7%9A%84%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86"><span class="nav-number">9.1.</span> <span class="nav-text">9.1 配置Mycat的日志管理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-2-%E9%85%8D%E7%BD%AEMycat%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%82%E6%95%B0"><span class="nav-number">9.2.</span> <span class="nav-text">9.2 配置Mycat的服务器参数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#charset-%E5%B1%9E%E6%80%A7"><span class="nav-number">9.2.1.</span> <span class="nav-text">charset 属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#processors-%E5%B1%9E%E6%80%A7"><span class="nav-number">9.2.2.</span> <span class="nav-text">processors 属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#processorBufferChunk-%E5%B1%9E%E6%80%A7"><span class="nav-number">9.2.3.</span> <span class="nav-text">processorBufferChunk 属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#processorBufferPool-%E5%B1%9E%E6%80%A7"><span class="nav-number">9.2.4.</span> <span class="nav-text">processorBufferPool 属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#processorBufferLocalPercent-%E5%B1%9E%E6%80%A7"><span class="nav-number">9.2.5.</span> <span class="nav-text">processorBufferLocalPercent 属性:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BF%83%E8%B7%B3%E5%B1%9E%E6%80%A7"><span class="nav-number">9.2.6.</span> <span class="nav-text">心跳属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3%E5%B1%9E%E6%80%A7"><span class="nav-number">9.2.7.</span> <span class="nav-text">服务相关属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mysql-%E8%BF%9E%E6%8E%A5%E7%9B%B8%E5%85%B3%E5%B1%9E%E6%80%A7"><span class="nav-number">9.2.8.</span> <span class="nav-text">Mysql 连接相关属性</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-%E9%80%BB%E8%BE%91%E5%BA%93%E9%85%8D%E7%BD%AE"><span class="nav-number">10.</span> <span class="nav-text">10.逻辑库配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#11-sequence%E5%88%86%E5%B8%83%E5%BC%8F%E5%85%A8%E5%B1%80%E5%BA%8F%E5%88%97"><span class="nav-number">11.</span> <span class="nav-text">11.sequence分布式全局序列</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#11-1-%E6%9C%AC%E5%9C%B0%E6%96%B9%E5%BC%8F"><span class="nav-number">11.1.</span> <span class="nav-text">11.1 本地方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-2-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%B9%E5%BC%8F"><span class="nav-number">11.2.</span> <span class="nav-text">11.2 数据库方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2-1-%E5%8E%9F%E7%90%86"><span class="nav-number">11.2.1.</span> <span class="nav-text">11.2.1 原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2-2-%E8%8E%B7%E5%8F%96%E6%AD%A5%E9%AA%A4"><span class="nav-number">11.2.2.</span> <span class="nav-text">11.2.2 获取步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2-3-%E9%85%8D%E7%BD%AE%E7%BB%86%E8%8A%82"><span class="nav-number">11.2.3.</span> <span class="nav-text">11.2.3 配置细节</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-3-%E6%97%B6%E9%97%B4%E6%88%B3%E6%96%B9%E5%BC%8F"><span class="nav-number">11.3.</span> <span class="nav-text">11.3 时间戳方式</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="139"
      src="/images/custom/avatar.jpg">
  <p class="site-author-name" itemprop="name">139</p>
  <div class="site-description" itemprop="description">一个普通的JAVA开发的博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">54</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">浙ICP备2023004484号-1 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">139</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
