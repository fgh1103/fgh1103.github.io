<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="0. ä¼˜åŒ–æ€è·¯12345678ç¡¬ä»¶       : DELL R730 40C 128G 10å° SAS(8å—:4å—raid10 2å—çƒ­å¤‡)+SSD 512Gæ—¥å¿—  ç½‘å¡ 4å—ç½‘å¡ bonding 1æ“ä½œç³»ç»Ÿ   : C7.6,numa  THP å…³é—­ , XFS  ,Swap ,sysctl.conf ,limits.conf nofile , é˜²ç«å¢™ selinux å…³é—­,deadline,N">
<meta property="og:type" content="article">
<meta property="og:title" content="å…¨é¢ä¼˜åŒ–">
<meta property="og:url" content="http://example.com/2024/07/15/%E5%85%A8%E9%9D%A2%E4%BC%98%E5%8C%96/index.html">
<meta property="og:site_name" content="è¿›å­¦é˜">
<meta property="og:description" content="0. ä¼˜åŒ–æ€è·¯12345678ç¡¬ä»¶       : DELL R730 40C 128G 10å° SAS(8å—:4å—raid10 2å—çƒ­å¤‡)+SSD 512Gæ—¥å¿—  ç½‘å¡ 4å—ç½‘å¡ bonding 1æ“ä½œç³»ç»Ÿ   : C7.6,numa  THP å…³é—­ , XFS  ,Swap ,sysctl.conf ,limits.conf nofile , é˜²ç«å¢™ selinux å…³é—­,deadline,N">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.fbbizyy.com/yuque/0/2021/png/1581532/1609894264877-dd346846-597a-4930-82b4-bd3df8bc2515.png">
<meta property="og:image" content="https://cdn.fbbizyy.com/yuque/0/2021/png/1581532/1609981686723-1be82e57-b85f-4699-bb26-532048d8c476.png">
<meta property="article:published_time" content="2024-07-14T16:00:00.000Z">
<meta property="article:modified_time" content="2025-03-06T09:55:08.767Z">
<meta property="article:author" content="139">
<meta property="article:tag" content="mysql">
<meta property="article:tag" content="ä¼˜åŒ–">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.fbbizyy.com/yuque/0/2021/png/1581532/1609894264877-dd346846-597a-4930-82b4-bd3df8bc2515.png">

<link rel="canonical" href="http://example.com/2024/07/15/%E5%85%A8%E9%9D%A2%E4%BC%98%E5%8C%96/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>å…¨é¢ä¼˜åŒ– | è¿›å­¦é˜</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">è¿›å­¦é˜</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">ä¸šç²¾äºå‹¤è’äºå¬‰ï¼Œè¡Œæˆäºæ€æ¯äºéš</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾<span class="badge">38</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»<span class="badge">8</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£<span class="badge">54</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/07/15/%E5%85%A8%E9%9D%A2%E4%BC%98%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/custom/avatar.jpg">
      <meta itemprop="name" content="139">
      <meta itemprop="description" content="ä¸€ä¸ªæ™®é€šçš„JAVAå¼€å‘çš„åšå®¢">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è¿›å­¦é˜">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          å…¨é¢ä¼˜åŒ–
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2024-07-15 00:00:00" itemprop="dateCreated datePublished" datetime="2024-07-15T00:00:00+08:00">2024-07-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-03-06 17:55:08" itemprop="dateModified" datetime="2025-03-06T17:55:08+08:00">2025-03-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="0-ä¼˜åŒ–æ€è·¯"><a href="#0-ä¼˜åŒ–æ€è·¯" class="headerlink" title="0. ä¼˜åŒ–æ€è·¯"></a>0. ä¼˜åŒ–æ€è·¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ç¡¬ä»¶       : DELL R730 40C 128G 10å° SAS(8å—:4å—raid10 2å—çƒ­å¤‡)+SSD 512Gæ—¥å¿—  ç½‘å¡ 4å—ç½‘å¡ bonding 1</span><br><span class="line">æ“ä½œç³»ç»Ÿ   : C7.6,numa  THP å…³é—­ , XFS  ,Swap ,sysctl.conf ,limits.conf nofile , é˜²ç«å¢™ selinux å…³é—­,deadline,No LVM</span><br><span class="line">æ•°æ®åº“å®ä¾‹ ï¼š</span><br><span class="line">SQLè§„èŒƒ    ï¼š</span><br><span class="line">ç´¢å¼•       ï¼š</span><br><span class="line">äº‹åŠ¡å’Œé”   ï¼š</span><br><span class="line">æ¶æ„      ï¼š</span><br><span class="line">å®‰å…¨      ï¼š </span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.fbbizyy.com/yuque/0/2021/png/1581532/1609894264877-dd346846-597a-4930-82b4-bd3df8bc2515.png"></p>
<span id="more"></span>

<hr>
<h2 id="1-ç¡¬ä»¶å±‚é¢ä¼˜åŒ–"><a href="#1-ç¡¬ä»¶å±‚é¢ä¼˜åŒ–" class="headerlink" title="1.ç¡¬ä»¶å±‚é¢ä¼˜åŒ–"></a>1.ç¡¬ä»¶å±‚é¢ä¼˜åŒ–</h2><p>1.0 ç¡¬ä»¶é€‰é…Â </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.0</span> ç¡¬ä»¶é€‰é…</span><br><span class="line">DELLã€HPã€IBMã€åä¸ºã€æµªæ½®ã€‚</span><br><span class="line">CPUï¼šIã€E</span><br><span class="line"></span><br><span class="line">å†…å­˜ï¼šECC </span><br><span class="line">IO : SAS ã€ pci<span class="operator">-</span>e SSD ã€ Nvme flash</span><br><span class="line">raidå¡ï¼šRaid10</span><br><span class="line"></span><br><span class="line">ç½‘å¡ï¼š å•å¡å•å£  bonding  <span class="operator">+</span> äº¤æ¢æœºå †å </span><br><span class="line">äº‘æœåŠ¡å™¨ï¼š ECS ã€RDS ã€TDSQLã€PolarxDB</span><br></pre></td></tr></table></figure>



<p>1.1 å…³é—­NUMAÂ </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.1</span> å…³é—­NUMA</span><br><span class="line">SMP   NUMA</span><br><span class="line"></span><br><span class="line">a. biosçº§åˆ«:</span><br><span class="line">åœ¨bioså±‚é¢numaå…³é—­æ—¶ï¼Œæ— è®ºoså±‚é¢çš„numaæ˜¯å¦æ‰“å¼€ï¼Œéƒ½ä¸ä¼šå½±å“æ€§èƒ½ã€‚ </span><br><span class="line"></span><br><span class="line"># numactl <span class="comment">--hardware</span></span><br><span class="line">available: <span class="number">1</span> nodes (<span class="number">0</span>)       #å¦‚æœæ˜¯<span class="number">2</span>æˆ–å¤šä¸ªnodeså°±è¯´æ˜numaæ²¡å…³æ‰</span><br><span class="line"></span><br><span class="line">b. OS grubçº§åˆ«:</span><br><span class="line">vi <span class="operator">/</span>boot<span class="operator">/</span>grub2<span class="operator">/</span>grub.cfg</span><br><span class="line">#<span class="comment">/* Copyright 2010, Oracle. All rights reserved. */</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">default</span><span class="operator">=</span><span class="number">0</span></span><br><span class="line">timeout<span class="operator">=</span><span class="number">5</span></span><br><span class="line">hiddenmenu</span><br><span class="line">foreground<span class="operator">=</span><span class="number">000000</span></span><br><span class="line">background<span class="operator">=</span>ffffff</span><br><span class="line">splashimage<span class="operator">=</span>(hd0,<span class="number">0</span>)<span class="operator">/</span>boot<span class="operator">/</span>grub<span class="operator">/</span>oracle.xpm.gz</span><br><span class="line"> </span><br><span class="line">title Trying_C0D0_as_HD0</span><br><span class="line">root (hd0,<span class="number">0</span>)</span><br><span class="line">kernel <span class="operator">/</span>boot<span class="operator">/</span>vmlinuz<span class="number">-2.6</span><span class="number">.18</span><span class="number">-128.1</span><span class="number">.16</span><span class="number">.0</span><span class="number">.1</span>.el5 root<span class="operator">=</span>LABEL<span class="operator">=</span>DBSYS ro bootarea<span class="operator">=</span>dbsys rhgb quiet console<span class="operator">=</span>ttyS0,<span class="number">115200</span>n8 console<span class="operator">=</span>tty1 crashkernel<span class="operator">=</span><span class="number">128</span>M<span class="variable">@16M</span> numa<span class="operator">=</span>off</span><br><span class="line">initrd <span class="operator">/</span>boot<span class="operator">/</span>initrd<span class="number">-2.6</span><span class="number">.18</span><span class="number">-128.1</span><span class="number">.16</span><span class="number">.0</span><span class="number">.1</span>.el5.img</span><br><span class="line"></span><br><span class="line">åœ¨oså±‚numaå…³é—­æ—¶,æ‰“å¼€bioså±‚çš„numaä¼šå½±å“æ€§èƒ½ï¼ŒQPSä¼šä¸‹é™<span class="number">15</span><span class="number">-30</span><span class="operator">%</span>;</span><br><span class="line"></span><br><span class="line">c. æ•°æ®åº“çº§åˆ«:</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%numa%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name          <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> innodb_numa_interleave <span class="operator">|</span> OFF   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------+-------+</span></span><br><span class="line"></span><br><span class="line">æˆ–è€…ï¼š </span><br><span class="line">vi <span class="operator">/</span>etc<span class="operator">/</span>init.d<span class="operator">/</span>mysqld</span><br><span class="line">æ‰¾åˆ°å¦‚ä¸‹è¡Œ</span><br><span class="line"># Give extra arguments <span class="keyword">to</span> mysqld <span class="keyword">with</span> the my.cnf file. This script</span><br><span class="line"># may be overwritten <span class="keyword">at</span> next upgrade.</span><br><span class="line">$bindir<span class="operator">/</span>mysqld_safe <span class="comment">--datadir=&quot;$datadir&quot; --pid-file=&quot;$mysqld_pid_file_path&quot; $other_args &gt;/dev/null &amp;</span></span><br><span class="line"></span><br><span class="line">wait_for_pid created &quot;$!&quot; &quot;$mysqld_pid_file_path&quot;; return_value<span class="operator">=</span>$?</span><br><span class="line">å°†$bindir<span class="operator">/</span>mysqld_safe <span class="comment">--datadir=&quot;$datadir&quot;è¿™ä¸€è¡Œä¿®æ”¹ä¸ºï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="operator">/</span>usr<span class="operator">/</span>bin<span class="operator">/</span>numactl <span class="comment">--interleave all $bindir/mysqld_safe --datadir=&quot;$datadir&quot; --pid-file=&quot;$mysqld_pid_file_path&quot; $other_args &gt;/dev/null &amp;</span></span><br><span class="line">wait_for_pid created &quot;$!&quot; &quot;$mysqld_pid_file_path&quot;; return_value<span class="operator">=</span>$?</span><br></pre></td></tr></table></figure>



<p>1.2 é˜µåˆ—å¡é…ç½®å»ºè®®Â </p>
<p>1.3 å…³é—­THPÂ </p>
<p>1.4 ç½‘å¡ç»‘å®šÂ </p>
<p>1.5 å¤šè·¯å¾„å‚¨å­˜Â </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.2</span> é˜µåˆ—å¡é…ç½®å»ºè®®</span><br><span class="line">raid10(æ¨è)</span><br><span class="line">SSDæˆ–è€…PCI<span class="operator">-</span>Eæˆ–è€…Flash</span><br><span class="line">å¼ºåˆ¶å›å†™ï¼ˆForce WriteBackï¼‰</span><br><span class="line">BBU ç”µæ±  ï¼š å¦‚æœæ²¡ç”µä¼šæœ‰è¾ƒå¤§æ€§èƒ½å½±å“ã€å®šæœŸå……æ”¾ç”µï¼Œå¦‚æœUPSã€å¤šè·¯ç”µæºã€å‘ç”µæœºã€‚å¯ä»¥å…³é—­ã€‚</span><br><span class="line">å…³é—­é¢„è¯»</span><br><span class="line">æœ‰å¯èƒ½çš„è¯å¼€å¯Cache(å¦‚æœUPSã€å¤šè·¯ç”µæºã€å‘ç”µæœºã€‚)</span><br><span class="line"></span><br><span class="line"> <span class="number">1.3</span> å…³é—­THP</span><br><span class="line">vi <span class="operator">/</span>etc<span class="operator">/</span>rc.local</span><br><span class="line">åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ å¦‚ä¸‹æŒ‡ä»¤ï¼š</span><br><span class="line">if test <span class="operator">-</span>f <span class="operator">/</span>sys<span class="operator">/</span>kernel<span class="operator">/</span>mm<span class="operator">/</span>transparent_hugepage<span class="operator">/</span>enabled; <span class="keyword">then</span></span><br><span class="line">echo never <span class="operator">&gt;</span> <span class="operator">/</span>sys<span class="operator">/</span>kernel<span class="operator">/</span>mm<span class="operator">/</span>transparent_hugepage<span class="operator">/</span>enabled</span><br><span class="line">fi</span><br><span class="line">if test <span class="operator">-</span>f <span class="operator">/</span>sys<span class="operator">/</span>kernel<span class="operator">/</span>mm<span class="operator">/</span>transparent_hugepage<span class="operator">/</span>defrag; <span class="keyword">then</span></span><br><span class="line">echo never <span class="operator">&gt;</span> <span class="operator">/</span>sys<span class="operator">/</span>kernel<span class="operator">/</span>mm<span class="operator">/</span>transparent_hugepage<span class="operator">/</span>defrag</span><br><span class="line">fi</span><br><span class="line">[root<span class="variable">@master</span>  <span class="operator">~</span>]# cat <span class="operator">/</span>sys<span class="operator">/</span>kernel<span class="operator">/</span>mm<span class="operator">/</span>transparent_hugepage<span class="operator">/</span>enabled </span><br><span class="line">always madvise [never]</span><br><span class="line">[root<span class="variable">@master</span>  <span class="operator">~</span>]# cat  <span class="operator">/</span>sys<span class="operator">/</span>kernel<span class="operator">/</span>mm<span class="operator">/</span>transparent_hugepage<span class="operator">/</span>defrag </span><br><span class="line">always madvise [never]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1.4</span> ç½‘å¡ç»‘å®š</span><br><span class="line">bondingæŠ€æœ¯ï¼Œä¸šåŠ¡æ•°æ®åº“æœåŠ¡å™¨éƒ½è¦é…ç½®bondingç»§ç»­ã€‚å»ºè®®æ˜¯ä¸»å¤‡æ¨¡å¼ã€‚</span><br><span class="line">äº¤æ¢æœºä¸€å®šè¦å †å ã€‚</span><br><span class="line"></span><br><span class="line"><span class="number">1.5</span> å­˜å‚¨å¤šè·¯å¾„</span><br><span class="line">ä½¿ç”¨ç‹¬ç«‹å­˜å‚¨è®¾å¤‡çš„è¯ï¼Œéœ€è¦é…ç½®å¤šè·¯å¾„ã€‚</span><br><span class="line">linux è‡ªå¸¦ : multipath</span><br><span class="line">å‚å•†æä¾›    :</span><br></pre></td></tr></table></figure>



<h2 id="2-ç³»ç»Ÿå±‚é¢ä¼˜åŒ–"><a href="#2-ç³»ç»Ÿå±‚é¢ä¼˜åŒ–" class="headerlink" title="2.ç³»ç»Ÿå±‚é¢ä¼˜åŒ–"></a>2.ç³»ç»Ÿå±‚é¢ä¼˜åŒ–</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">a. æ›´æ”¹æ–‡ä»¶å¥æŸ„å’Œè¿›ç¨‹æ•°</span><br><span class="line">å†…æ ¸ä¼˜åŒ– <span class="operator">/</span>etc<span class="operator">/</span>sysctl.conf</span><br><span class="line">vm.swappiness <span class="operator">=</span> <span class="number">5</span></span><br><span class="line">vm.dirty_ratio <span class="operator">=</span> <span class="number">20</span></span><br><span class="line">vm.dirty_background_ratio <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">net.ipv4.tcp_max_syn_backlog <span class="operator">=</span> <span class="number">819200</span></span><br><span class="line">net.core.netdev_max_backlog <span class="operator">=</span> <span class="number">400000</span></span><br><span class="line">net.core.somaxconn <span class="operator">=</span> <span class="number">4096</span></span><br><span class="line">net.ipv4.tcp_tw_reuse<span class="operator">=</span><span class="number">1</span></span><br><span class="line">net.ipv4.tcp_tw_recycle<span class="operator">=</span><span class="number">0</span></span><br><span class="line"></span><br><span class="line">limits.conf </span><br><span class="line">nofile <span class="number">63000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b. é˜²ç«å¢™</span><br><span class="line">ç¦ç”¨selinux ï¼š <span class="operator">/</span>etc<span class="operator">/</span>sysconfig<span class="operator">/</span>selinux æ›´æ”¹SELINUX<span class="operator">=</span>disabled.</span><br><span class="line">iptableså¦‚æœä¸ä½¿ç”¨å¯ä»¥å…³é—­ã€‚å¯æ˜¯éœ€è¦æ‰“å¼€MySQLéœ€è¦çš„ç«¯å£å·</span><br><span class="line"></span><br><span class="line">c. æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ–</span><br><span class="line">æ¨èä½¿ç”¨XFSæ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">MySQLæ•°æ®åˆ†åŒºç‹¬ç«‹ ï¼Œä¾‹å¦‚æŒ‚è½½ç‚¹ä¸º: <span class="operator">/</span>data</span><br><span class="line">mountå‚æ•° defaults, noatime, nodiratime, nobarrier å¦‚<span class="operator">/</span>etc<span class="operator">/</span>fstabï¼š</span><br><span class="line"><span class="operator">/</span>dev<span class="operator">/</span>sdb <span class="operator">/</span>data                   xfs     defaults,noatime,nodiratime,nobarrier        <span class="number">1</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line">d. ä¸ä½¿ç”¨LVM </span><br><span class="line"></span><br><span class="line">e. ioè°ƒåº¦</span><br><span class="line">SAS ï¼š      deadline</span><br><span class="line">SSD<span class="operator">&amp;</span>PCI<span class="operator">-</span>Eï¼š noop</span><br><span class="line"></span><br><span class="line">centos <span class="number">7</span> é»˜è®¤æ˜¯deadline</span><br><span class="line">cat   <span class="operator">/</span>sys<span class="operator">/</span>block<span class="operator">/</span>sda<span class="operator">/</span>queue<span class="operator">/</span>scheduler</span><br><span class="line"></span><br><span class="line">#ä¸´æ—¶ä¿®æ”¹ä¸ºdeadline(centos6)</span><br><span class="line">echo deadline <span class="operator">&gt;</span><span class="operator">/</span>sys<span class="operator">/</span>block<span class="operator">/</span>sda<span class="operator">/</span>queue<span class="operator">/</span>scheduler </span><br><span class="line">vi <span class="operator">/</span>boot<span class="operator">/</span>grub<span class="operator">/</span>grub.conf</span><br><span class="line">æ›´æ”¹åˆ°å¦‚ä¸‹å†…å®¹:</span><br><span class="line">kernel <span class="operator">/</span>boot<span class="operator">/</span>vmlinuz<span class="number">-2.6</span><span class="number">.18</span><span class="number">-8.</span>el5 ro root<span class="operator">=</span>LABEL<span class="operator">=</span><span class="operator">/</span> elevator<span class="operator">=</span>deadline rhgb quiet</span><br></pre></td></tr></table></figure>



<h2 id="3-æ•°æ®åº“ç‰ˆæœ¬é€‰æ‹©"><a href="#3-æ•°æ®åº“ç‰ˆæœ¬é€‰æ‹©" class="headerlink" title="3. æ•°æ®åº“ç‰ˆæœ¬é€‰æ‹©"></a>3. æ•°æ®åº“ç‰ˆæœ¬é€‰æ‹©</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>ã€ç¨³å®šç‰ˆï¼šé€‰æ‹©å¼€æºçš„ç¤¾åŒºç‰ˆçš„ç¨³å®šç‰ˆ<span class="variable constant_">GA</span>ç‰ˆæœ¬ã€‚</span><br><span class="line"><span class="number">2</span>ã€é€‰æ‹©mysqlæ•°æ®åº“<span class="variable constant_">GA</span>ç‰ˆæœ¬å‘å¸ƒå<span class="number">6</span>ä¸ªæœˆ-<span class="number">12</span>ä¸ªæœˆçš„<span class="variable constant_">GA</span>åŒæ•°ç‰ˆæœ¬ï¼Œå¤§çº¦åœ¨<span class="number">15</span>-<span class="number">20</span>ä¸ªå°ç‰ˆæœ¬å·¦å³ã€‚</span><br><span class="line"><span class="number">3</span>ã€è¦é€‰æ‹©å‰åå‡ ä¸ªæœˆæ²¡æœ‰å¤§çš„<span class="variable constant_">BUG</span>ä¿®å¤çš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯å¤§é‡ä¿®å¤<span class="variable constant_">BUG</span>çš„é›†ä¸­ç‰ˆæœ¬ã€‚</span><br><span class="line"><span class="number">4</span>ã€è¦è€ƒè™‘å¼€å‘äººå‘˜å¼€å‘ç¨‹åºä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯å¦å…¼å®¹ä½ é€‰çš„ç‰ˆæœ¬ã€‚</span><br><span class="line"><span class="number">5</span>ã€ä½œä¸ºå†…éƒ¨å¼€å‘æµ‹è¯•æ•°æ®åº“ç¯å¢ƒï¼Œè·‘å¤§æ¦‚<span class="number">3</span>-<span class="number">6</span>ä¸ªæœˆçš„æ—¶é—´ã€‚</span><br><span class="line"><span class="number">6</span>ã€ä¼˜å…ˆä¼ä¸šéæ ¸å¿ƒä¸šåŠ¡é‡‡ç”¨æ–°ç‰ˆæœ¬çš„æ•°æ®åº“<span class="variable constant_">GA</span>ç‰ˆæœ¬è½¯ä»¶ã€‚</span><br><span class="line"><span class="number">7</span>ã€å‘<span class="variable constant_">DBA</span>é«˜æ‰‹è¯·æ•™ï¼Œæˆ–è€…åœ¨æŠ€æœ¯æ°›å›´å¥½çš„ç¾¤é‡Œå’Œå¤§å®¶ä¸€èµ·äº¤æµï¼Œä½¿ç”¨çœŸæ­£çš„é«˜æ‰‹ä»¬ç”¨è¿‡çš„å¥½ç”¨çš„<span class="variable constant_">GA</span>ç‰ˆæœ¬äº§å“ã€‚</span><br><span class="line"></span><br><span class="line">æœ€ç»ˆå»ºè®®ï¼š <span class="number">8.0</span><span class="number">.20</span>æ˜¯ä¸€ä¸ªä¸é”™çš„ç‰ˆæœ¬é€‰æ‹©ã€‚å‘åå¯ä»¥é€‰æ‹©åŒæ•°ç‰ˆã€‚  </span><br></pre></td></tr></table></figure>



<h2 id="4-ğŸ’–æ•°æ®åº“ä¸‰å±‚ç»“æ„åŠæ ¸å¿ƒå‚æ•°ä¼˜åŒ–"><a href="#4-ğŸ’–æ•°æ®åº“ä¸‰å±‚ç»“æ„åŠæ ¸å¿ƒå‚æ•°ä¼˜åŒ–" class="headerlink" title="4.ğŸ’–æ•°æ®åº“ä¸‰å±‚ç»“æ„åŠæ ¸å¿ƒå‚æ•°ä¼˜åŒ–"></a>4.ğŸ’–æ•°æ®åº“ä¸‰å±‚ç»“æ„åŠæ ¸å¿ƒå‚æ•°ä¼˜åŒ–</h2><h3 id="4-1-è¿æ¥å±‚"><a href="#4-1-è¿æ¥å±‚" class="headerlink" title="4.1 è¿æ¥å±‚"></a>4.1 è¿æ¥å±‚</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">max_connections=<span class="number">1000</span>         #*****       æœ€å¤§è¿æ¥æ•°</span><br><span class="line">max_connect_errors=<span class="number">999999</span>                 æ•°æ®åº“å¼€å¯ä»¥æ¥å¤±è´¥è¿æ¥æ¬¡æ•°</span><br><span class="line">wait_timeout=<span class="number">600</span>             #*****       è¿æ¥è¶…æ—¶æ—¶é—´</span><br><span class="line">interactive_wait_timeout=<span class="number">3600</span>             äº¤äº’å¼è¿æ¥è¶…æ—¶æ—¶é—´</span><br><span class="line">net_read_timeout  = <span class="number">120</span>                   ç½‘ç»œè¯»è¶…æ—¶æ—¶é—´</span><br><span class="line">net_write_timeout = <span class="number">120</span>                   ç½‘ç»œå†™è¶…æ—¶æ—¶é—´</span><br><span class="line">max_allowed_packet= 32M      #*****       å…è®¸çš„æ•°æ®åŒ…å¤§å°</span><br></pre></td></tr></table></figure>

<h3 id="4-2-Serverå±‚"><a href="#4-2-Serverå±‚" class="headerlink" title="4.2 Serverå±‚"></a>4.2 Serverå±‚</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">sql_safe_updates                =<span class="number">1</span>                 # *****             update <span class="keyword">delete</span>è¯­å¥å¿…é¡»æœ‰whereæ¡ä»¶ æœ‰ç´¢å¼•</span><br><span class="line">slow_query_log                  =<span class="variable constant_">ON</span>                                    æ˜¯å¦å¼€å¯æ…¢æ—¥å¿—</span><br><span class="line">slow_query_log_file             =<span class="regexp">/data/</span><span class="number">3307</span>/slow.<span class="property">log</span>   # *****         æ…¢æ—¥å¿—å­˜æ”¾ä½ç½®</span><br><span class="line">long_query_time                 =<span class="number">1</span>                  # *****            å¤šä¹…æ‰ç®—æ…¢æ—¥å¿—</span><br><span class="line">log_queries_not_using_indexes   =<span class="variable constant_">ON</span>                 # *****            æ²¡èµ°ç´¢å¼•çš„</span><br><span class="line">log_throttle_queries_not_using_indexes = <span class="number">10</span>         # *****            æ²¡èµ°ç´¢å¼•çš„  ç›¸åŒè¯­å¥æœ€å¤šè®°å½•æ¬¡æ•°</span><br><span class="line">sort_buffer 					= 1M</span><br><span class="line">join_buffer 					= 1M</span><br><span class="line">read_buffer						= 1M</span><br><span class="line">read_rnd_buffer                 = 1M</span><br><span class="line">tmp_table  						= 16M</span><br><span class="line">heap_table 						= 16M</span><br><span class="line">max_execution_time              = <span class="number">28800</span>                                <span class="variable constant_">SQL</span>æœ€å¤§æ‰§è¡Œæ—¶é—´</span><br><span class="line">lock_wait_timeout               = <span class="number">60</span>                 # *****           <span class="variable constant_">MDL</span>é”ç­‰å¾…æ—¶é—´</span><br><span class="line">lower_case_table_names          =<span class="number">1</span>                   # *****           å»ºåº“å»ºè¡¨æ—¶å¼ºåˆ¶è½¬æ¢å°å†™</span><br><span class="line">thread_cache_size               =<span class="number">64</span>                  </span><br><span class="line">log_timestamps                  =<span class="variable constant_">SYSTEM</span>              # *****           æ—¥å¿—æ—¶é—´ä¸ç³»ç»Ÿæ—¶é—´ä¸€è‡´</span><br><span class="line">init_connect                    =<span class="string">&quot;set names utf8&quot;</span>    # *****           å®¢æˆ·ç«¯å­—ç¬¦é›†è®¾ç½®æˆ<span class="string">&#x27;utf8&#x27;</span></span><br><span class="line">event_scheduler                 =<span class="variable constant_">OFF</span>                                   è®¡åˆ’ä»»åŠ¡</span><br><span class="line">secure-file-priv                =/tmp                # *****           å¯¼æ•°æ®ä¼ åˆ°æŒ‡å®šç›®å½•</span><br><span class="line">binlog_expire_logs_seconds      =<span class="number">2592000</span>             # *****           äºŒè¿›åˆ¶æ—¥å¿—è¿‡æœŸæ—¶é—´</span><br><span class="line">sync_binlog                     =<span class="number">1</span>                   # *****           äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶æ¯æ¬¡å†™çš„æ—¶å€™åŒæ­¥åˆ°ç£ç›˜</span><br><span class="line">log-bin                         =<span class="regexp">/data/</span><span class="number">3307</span>/mysql-bin</span><br><span class="line">log-bin-index                   =<span class="regexp">/data/</span><span class="number">3307</span>/mysql-bin.<span class="property">index</span></span><br><span class="line">max_binlog_size                 =500M</span><br><span class="line">binlog_format                   =<span class="variable constant_">ROW</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-å­˜å‚¨å¼•æ“å±‚"><a href="#4-3-å­˜å‚¨å¼•æ“å±‚" class="headerlink" title="4.3 å­˜å‚¨å¼•æ“å±‚"></a>4.3 å­˜å‚¨å¼•æ“å±‚</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">transaction-isolation               =<span class="string">&quot;READ-COMMITTED&quot;</span>    # *****       éš”ç¦»çº§åˆ«</span><br><span class="line">innodb_data_home_dir                =/xxx                              ibdataä½ç½®ç‚¹</span><br><span class="line">innodb_log_group_home_dir           =/xxx                              redologä½ç½®ç‚¹</span><br><span class="line">innodb_log_file_size                =2048M                             redologå¤§å° ï¼ˆ512M-4G)</span><br><span class="line">innodb_log_files_in_group           =<span class="number">3</span>                                 redologç»„</span><br><span class="line">innodb_flush_log_at_trx_commit      =<span class="number">2</span>                   # *****       äº‹åŠ¡æäº¤redologç«‹å³åˆ·æ–°åˆ°ç£ç›˜</span><br><span class="line">innodb_flush_method                 =<span class="variable constant_">O_DIRECT</span>            # *****       åˆ·æ–°ç­–ç•¥</span><br><span class="line">innodb_io_capacity                  =<span class="number">1000</span>                # *****       iopsåˆ·æ–°å¤šå°‘æ•°æ®é¡µ</span><br><span class="line">innodb_io_capacity_max              =<span class="number">4000</span>         </span><br><span class="line">innodb_buffer_pool_size             =64G                 # *****       <span class="number">50</span>%-<span class="number">75</span>%ç‰©ç†å†…å­˜</span><br><span class="line">innodb_buffer_pool_instances        =<span class="number">4</span>                   # *****</span><br><span class="line">innodb_log_buffer_size              =64M                 # *****       redo bufferå¤§å° (512M-4G)</span><br><span class="line">innodb_max_dirty_pages_pct          =<span class="number">85</span>                  # *****       è„é¡µå æ¯”  è¶…è¿‡å‡ºå‘ckptåˆ·æ–°åˆ°ç£ç›˜</span><br><span class="line">innodb_lock_wait_timeout            =<span class="number">10</span>                  # *****       è¡Œé”è¶…æ—¶æ—¶é—´</span><br><span class="line">innodb_open_files                   =<span class="number">63000</span>               # *****       æ–‡ä»¶å¥æŸ„</span><br><span class="line">innodb_page_cleaners                =<span class="number">4</span>                                 åˆ·å†™æ•°æ®é¡µçº¿ç¨‹æ•°é‡</span><br><span class="line">innodb_sort_buffer_size             =64M                               æ’åºç¼“å†²åŒº</span><br><span class="line">innodb_print_all_deadlocks          =<span class="number">1</span>                   #             ç›‘æ§æ­»é”ä¿¡æ¯ è‡ªåŠ¨æ‰“å°åˆ°æ—¥å¿—</span><br><span class="line">innodb_rollback_on_timeout          =<span class="variable constant_">ON</span>                                äº‹åŠ¡è¶…æ—¶æ˜¯å¦è‡ªåŠ¨å›æ»š</span><br><span class="line">innodb_deadlock_detect              =<span class="variable constant_">ON</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-å¤åˆ¶"><a href="#4-4-å¤åˆ¶" class="headerlink" title="4.4 å¤åˆ¶"></a>4.4 å¤åˆ¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">relay_log                       =<span class="regexp">/opt/</span>log/mysql/blog/relay</span><br><span class="line">relay_log_index                 =<span class="regexp">/opt/</span>log/mysql/blog/relay.<span class="property">index</span></span><br><span class="line">max_relay_log_size              =500M</span><br><span class="line">relay_log_recovery              =<span class="variable constant_">ON</span></span><br><span class="line"></span><br><span class="line">rpl_semi_sync_master_enabled                =<span class="variable constant_">ON</span></span><br><span class="line">rpl_semi_sync_master_timeout                =<span class="number">1000</span></span><br><span class="line">rpl_semi_sync_master_trace_level            =<span class="number">32</span></span><br><span class="line">rpl_semi_sync_master_wait_for_slave_count   =<span class="number">1</span></span><br><span class="line">rpl_semi_sync_master_wait_no_slave          =<span class="variable constant_">ON</span></span><br><span class="line">rpl_semi_sync_master_wait_point             =<span class="variable constant_">AFTER_SYNC</span></span><br><span class="line">rpl_semi_sync_slave_enabled                 =<span class="variable constant_">ON</span></span><br><span class="line">rpl_semi_sync_slave_trace_level             =<span class="number">32</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">binlog_group_commit_sync_delay              =<span class="number">1</span></span><br><span class="line">binlog_group_commit_sync_no_delay_count     =<span class="number">1000</span></span><br><span class="line"></span><br><span class="line">gtid_mode                       =<span class="variable constant_">ON</span></span><br><span class="line">enforce_gtid_consistency        =<span class="variable constant_">ON</span></span><br><span class="line"></span><br><span class="line">skip-slave-start                =<span class="number">1</span></span><br><span class="line">#read_only                      =<span class="variable constant_">ON</span></span><br><span class="line">#super_read_only                =<span class="variable constant_">ON</span></span><br><span class="line">log_slave_updates               =<span class="variable constant_">ON</span></span><br><span class="line">server_id                       =<span class="number">2330602</span></span><br><span class="line">report_host                     =xxxx</span><br><span class="line">report_port                     =<span class="number">3306</span></span><br><span class="line">slave_parallel_type                         =<span class="variable constant_">LOGICAL_CLOCK</span></span><br><span class="line">slave_parallel_workers                      =<span class="number">4</span></span><br><span class="line">master_info_repository                      =<span class="variable constant_">TABLE</span></span><br><span class="line">relay_log_info_repository                   =<span class="variable constant_">TABLE</span></span><br></pre></td></tr></table></figure>

<h3 id="4-5-å…¶å®ƒ"><a href="#4-5-å…¶å®ƒ" class="headerlink" title="4.5 å…¶å®ƒ"></a>4.5 å…¶å®ƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å®¢æˆ·ç«¯é…ç½®ï¼š </span><br><span class="line">[mysql]</span><br><span class="line">no-auto-rehash</span><br></pre></td></tr></table></figure>



<h2 id="5-å¼€å‘è§„èŒƒ"><a href="#5-å¼€å‘è§„èŒƒ" class="headerlink" title="5.å¼€å‘è§„èŒƒ"></a>5.å¼€å‘è§„èŒƒ</h2><h3 id="5-1-å­—æ®µè§„èŒƒ"><a href="#5-1-å­—æ®µè§„èŒƒ" class="headerlink" title="5.1 å­—æ®µè§„èŒƒ"></a>5.1 å­—æ®µè§„èŒƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1. æ¯ä¸ªè¡¨å»ºè®®åœ¨30ä¸ªå­—æ®µä»¥å†…(äº†è§£ä¸‰å¤§èŒƒå¼)ã€‚</span><br><span class="line">2. éœ€è¦å­˜å‚¨emojiå­—ç¬¦çš„ï¼Œåˆ™é€‰æ‹©utf8mb4å­—ç¬¦é›†ã€‚</span><br><span class="line">3. æœºå¯†æ•°æ®ï¼ŒåŠ å¯†åå­˜å‚¨ã€‚</span><br><span class="line">4. æ•´å‹æ•°æ®ï¼Œé»˜è®¤åŠ ä¸ŠUNSIGNEDã€‚</span><br><span class="line">5. å­˜å‚¨IPV4åœ°å€å»ºè®®ç”¨bigINT UNSIGNEï¼ŒæŸ¥è¯¢æ—¶å†åˆ©ç”¨INET_ATON()ã€INET_NTOA()å‡½æ•°è½¬æ¢ã€‚</span><br><span class="line">6. å¦‚æœé‡åˆ°BLOBã€TEXTå¤§å­—æ®µå•ç‹¬å­˜å‚¨è¡¨æˆ–è€…é™„ä»¶å½¢å¼å­˜å‚¨ã€‚</span><br><span class="line">7. é€‰æ‹©å°½å¯èƒ½å°çš„æ•°æ®ç±»å‹ï¼Œç”¨äºèŠ‚çœç£ç›˜å’Œå†…å­˜ç©ºé—´ã€‚</span><br><span class="line">8. å­˜å‚¨æµ®ç‚¹æ•°ï¼Œå¯ä»¥æ”¾å¤§å€æ•°å­˜å‚¨ã€‚</span><br><span class="line">9. æ¯ä¸ªè¡¨å¿…é¡»æœ‰ä¸»é”®ï¼ŒINT/BIGINTå¹¶ä¸”è‡ªå¢åšä¸ºä¸»é”®ï¼Œåˆ†å¸ƒå¼æ¶æ„ä½¿ç”¨sequenceåºåˆ—ç”Ÿæˆå™¨ä¿å­˜ã€‚</span><br><span class="line">10. æ¯ä¸ªåˆ—ä½¿ç”¨not nullï¼Œæˆ–å¢åŠ é»˜è®¤å€¼ã€‚</span><br></pre></td></tr></table></figure>



<h3 id="5-2-SQLè¯­å¥è§„èŒƒ"><a href="#5-2-SQLè¯­å¥è§„èŒƒ" class="headerlink" title="5.2 SQLè¯­å¥è§„èŒƒ"></a>5.2 SQLè¯­å¥è§„èŒƒ</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">### <span class="number">1.</span> å»æ‰ä¸å¿…è¦çš„æ‹¬å·</span><br><span class="line">å¦‚ï¼š      ((a <span class="variable constant_">AND</span> b) <span class="variable constant_">AND</span> c <span class="variable constant_">OR</span> (((a <span class="variable constant_">AND</span> b) <span class="variable constant_">AND</span> (c <span class="variable constant_">AND</span> d)))) </span><br><span class="line">ä¿®æ”¹æˆ    (a <span class="variable constant_">AND</span> b <span class="variable constant_">AND</span> c) <span class="variable constant_">OR</span> (a <span class="variable constant_">AND</span> b <span class="variable constant_">AND</span> c <span class="variable constant_">AND</span> d)</span><br><span class="line">### <span class="number">2.</span>  å»æ‰é‡å æ¡ä»¶</span><br><span class="line">å¦‚ï¼š      (a&lt;b <span class="variable constant_">AND</span> b=c) <span class="variable constant_">AND</span> a=<span class="number">5</span></span><br><span class="line">ä¿®æ”¹æˆ    b&gt;<span class="number">5</span> <span class="variable constant_">AND</span> b=c <span class="variable constant_">AND</span> a=<span class="number">5</span></span><br><span class="line">å¦‚ï¼š      (B&gt;=<span class="number">5</span> <span class="variable constant_">AND</span> B=<span class="number">5</span>) <span class="variable constant_">OR</span> (B=<span class="number">6</span> <span class="variable constant_">AND</span> <span class="number">5</span>=<span class="number">5</span>) <span class="variable constant_">OR</span> (B=<span class="number">7</span> <span class="variable constant_">AND</span> <span class="number">5</span>=<span class="number">6</span>)</span><br><span class="line">ä¿®æ”¹æˆ    B=<span class="number">5</span> <span class="variable constant_">OR</span> B=<span class="number">6</span></span><br><span class="line"></span><br><span class="line">### <span class="number">3.</span> é¿å…ä½¿ç”¨not <span class="keyword">in</span>ã€not exists ã€&lt;&gt;ã€like %%</span><br><span class="line">### <span class="number">4.</span> å¤šè¡¨è¿æ¥ï¼Œå°è¡¨é©±åŠ¨å¤§è¡¨</span><br><span class="line">### <span class="number">5.</span> å‡å°‘ä¸´æ—¶è¡¨åº”ç”¨ï¼Œä¼˜åŒ–order by ã€group byã€unionã€distinctã€joinç­‰</span><br><span class="line">### <span class="number">6.</span> å‡å°‘è¯­å¥æŸ¥è¯¢èŒƒå›´ï¼Œç²¾ç¡®æŸ¥è¯¢æ¡ä»¶</span><br><span class="line">### <span class="number">7.</span> å¤šæ¡ä»¶ï¼Œç¬¦åˆè”åˆç´¢å¼•æœ€å·¦åŸåˆ™</span><br><span class="line">### <span class="number">8.</span> æŸ¥è¯¢æ¡ä»¶å‡å°‘ä½¿ç”¨å‡½æ•°ã€æ‹¼æ¥å­—ç¬¦ç­‰æ¡ä»¶ã€æ¡ä»¶éšå¼è½¬æ¢</span><br><span class="line">### <span class="number">9.</span> union all æ›¿ä»£ union</span><br><span class="line">### <span class="number">10.</span>å‡å°‘havingå­å¥ä½¿ç”¨</span><br><span class="line">### <span class="number">11.</span>å¦‚éå¿…é¡»ä¸ä½¿ç”¨ <span class="keyword">for</span> updateè¯­å¥ </span><br><span class="line">### <span class="number">12.</span>updateå’Œ<span class="keyword">delete</span>ï¼Œå¼€å¯å®‰å…¨æ›´æ–°å‚æ•°</span><br><span class="line">### <span class="number">13.</span>å‡å°‘inset  ... selectè¯­å¥åº”ç”¨</span><br><span class="line">### <span class="number">14.</span>ä½¿ç”¨load æ›¿ä»£insertå½•å…¥å¤§æ•°æ®</span><br><span class="line">### <span class="number">15.</span>å¯¼å…¥å¤§é‡æ•°æ®æ—¶ï¼Œå¯ä»¥ç¦ç”¨ç´¢å¼•ã€å¢å¤§ç¼“å†²åŒºã€å¢å¤§redoæ–‡ä»¶å’Œbufferã€å…³é—­autocommitã€<span class="variable constant_">RC</span>çº§åˆ«å¯ä»¥æé«˜æ•ˆç‡ </span><br><span class="line">### <span class="number">16.</span>ä¼˜åŒ–limitï¼Œæœ€å¥½ä¸šåŠ¡é€»è¾‘ä¸­å…ˆè·å–ä¸»é”®<span class="variable constant_">ID</span>ï¼Œå†åŸºäº<span class="variable constant_">ID</span>è¿›è¡ŒæŸ¥è¯¢ </span><br><span class="line">	limit <span class="number">5000000</span>,<span class="number">10</span>     limit <span class="number">10</span> , <span class="number">200</span></span><br><span class="line">### <span class="number">17.</span> <span class="variable constant_">DDL</span>æ‰§è¡Œå‰è¦å®¡æ ¸</span><br><span class="line">### <span class="number">18.</span> å¤šè¡¨è¿æ¥è¯­å¥æ‰§è¡Œå‰è¦çœ‹æ‰§è¡Œè®¡åˆ’</span><br></pre></td></tr></table></figure>



<h2 id="6-ç´¢å¼•ä¼˜åŒ–"><a href="#6-ç´¢å¼•ä¼˜åŒ–" class="headerlink" title="6. ç´¢å¼•ä¼˜åŒ–"></a>6. ç´¢å¼•ä¼˜åŒ–</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">1. éå”¯ä¸€ç´¢å¼•æŒ‰ç…§â€œi_å­—æ®µåç§°_å­—æ®µåç§°[_å­—æ®µå]â€è¿›è¡Œå‘½åã€‚</span><br><span class="line">2. å”¯ä¸€ç´¢å¼•æŒ‰ç…§â€œu_å­—æ®µåç§°_å­—æ®µåç§°[_å­—æ®µå]â€è¿›è¡Œå‘½åã€‚</span><br><span class="line">3. ç´¢å¼•åç§°ä½¿ç”¨å°å†™ã€‚</span><br><span class="line">4. ç´¢å¼•ä¸­çš„å­—æ®µæ•°ä¸è¶…è¿‡5ä¸ªã€‚</span><br><span class="line">5. å”¯ä¸€é”®ç”±3ä¸ªä»¥ä¸‹å­—æ®µç»„æˆï¼Œå¹¶ä¸”å­—æ®µéƒ½æ˜¯æ•´å½¢æ—¶ï¼Œä½¿ç”¨å”¯ä¸€é”®ä½œä¸ºä¸»é”®ã€‚</span><br><span class="line">6. æ²¡æœ‰å”¯ä¸€é”®æˆ–è€…å”¯ä¸€é”®ä¸ç¬¦åˆ5ä¸­çš„æ¡ä»¶æ—¶ï¼Œä½¿ç”¨è‡ªå¢<span class="built_in">id</span>ä½œä¸ºä¸»é”®ã€‚</span><br><span class="line">7. å”¯ä¸€é”®ä¸å’Œä¸»é”®é‡å¤ã€‚</span><br><span class="line">8. ç´¢å¼•é€‰æ‹©åº¦é«˜çš„åˆ—ä½œä¸ºè”åˆç´¢å¼•æœ€å·¦æ¡ä»¶</span><br><span class="line">9. ORDER BYï¼ŒGROUP BYï¼ŒDISTINCTçš„å­—æ®µéœ€è¦æ·»åŠ åœ¨ç´¢å¼•çš„åé¢ã€‚</span><br><span class="line">10. å•å¼ è¡¨çš„ç´¢å¼•æ•°é‡æ§åˆ¶åœ¨5ä¸ªä»¥å†…ï¼Œè‹¥å•å¼ è¡¨å¤šä¸ªå­—æ®µåœ¨æŸ¥è¯¢éœ€æ±‚ä¸Šéƒ½è¦å•ç‹¬ç”¨åˆ°ç´¢å¼•ï¼Œéœ€è¦ç»è¿‡DBAè¯„ä¼°ã€‚</span><br><span class="line">    æŸ¥è¯¢æ€§èƒ½é—®é¢˜æ— æ³•è§£å†³çš„ï¼Œåº”ä»äº§å“è®¾è®¡ä¸Šè¿›è¡Œé‡æ„ã€‚</span><br><span class="line">	</span><br><span class="line">11. ä½¿ç”¨EXPLAINåˆ¤æ–­SQLè¯­å¥æ˜¯å¦åˆç†ä½¿ç”¨ç´¢å¼•ï¼Œå°½é‡é¿å…extraåˆ—å‡ºç°ï¼šUsing File Sortï¼ŒUsing Temporaryã€‚</span><br><span class="line"></span><br><span class="line">12. UPDATEã€DELETEè¯­å¥éœ€è¦æ ¹æ®WHEREæ¡ä»¶æ·»åŠ ç´¢å¼•ã€‚</span><br><span class="line"></span><br><span class="line">13. å¯¹é•¿åº¦å¤§äº50çš„VARCHARå­—æ®µå»ºç«‹ç´¢å¼•æ—¶ï¼ŒæŒ‰éœ€æ±‚æ°å½“çš„ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œæˆ–ä½¿ç”¨å…¶ä»–æ–¹æ³•ã€‚</span><br><span class="line"></span><br><span class="line">14. ä¸‹é¢çš„è¡¨å¢åŠ ä¸€åˆ—url_crc32ï¼Œç„¶åå¯¹url_crc32å»ºç«‹ç´¢å¼•ï¼Œå‡å°‘ç´¢å¼•å­—æ®µçš„é•¿åº¦ï¼Œæé«˜æ•ˆç‡ã€‚</span><br><span class="line"></span><br><span class="line">CREATE TABLE all_url(ID INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">url VARCHAR(255) NOT NULL DEFAULT 0,      </span><br><span class="line">url_crc32 INT UNSIGNED NOT NULL DEFAULT 0,</span><br><span class="line">index idx_url(url_crc32));</span><br><span class="line"></span><br><span class="line">15. åˆç†åˆ›å»ºè”åˆç´¢å¼•ï¼ˆé¿å…å†—ä½™ï¼‰ï¼Œ(a,b,c) ç›¸å½“äº (a) ã€(a,b) ã€(a,b,c)ã€‚</span><br><span class="line"></span><br><span class="line">16. åˆç†åˆ©ç”¨è¦†ç›–ç´¢å¼•ï¼Œå‡å°‘å›è¡¨ã€‚</span><br><span class="line"></span><br><span class="line">17. å‡å°‘å†—ä½™ç´¢å¼•å’Œä½¿ç”¨ç‡è¾ƒä½çš„ç´¢å¼•</span><br><span class="line">mysql&gt; select * from sys.schema_unused_indexes;</span><br><span class="line">mysql&gt; select * from sys.schema_redundant_indexes\G</span><br></pre></td></tr></table></figure>



<h2 id="7-é”ä¼˜åŒ–âœ¨âœ¨âœ¨"><a href="#7-é”ä¼˜åŒ–âœ¨âœ¨âœ¨" class="headerlink" title="7.é”ä¼˜åŒ–âœ¨âœ¨âœ¨"></a>7.é”ä¼˜åŒ–âœ¨âœ¨âœ¨</h2><h3 id="7-1-å…¨å±€é”-Global-Read-lock"><a href="#7-1-å…¨å±€é”-Global-Read-lock" class="headerlink" title="7.1 å…¨å±€é” Global Read lock"></a>7.1 å…¨å±€é” Global Read lock</h3><h4 id="a-ä»‹ç»"><a href="#a-ä»‹ç»" class="headerlink" title="a. ä»‹ç»"></a>a. ä»‹ç»</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">å…¨å±€è¯»é”ã€‚</span><br><span class="line">åŠ é”æ–¹æ³•ï¼š <span class="variable constant_">FTWRL</span>ï¼Œflush tables <span class="keyword">with</span> read lock.</span><br><span class="line">è§£é”æ–¹æ³•ï¼š unlock tables;</span><br><span class="line"></span><br><span class="line">å‡ºç°åœºæ™¯ï¼š </span><br><span class="line">	mysqldump  --master-data  </span><br><span class="line">	xtrabackupï¼ˆ<span class="number">8.0</span>ä¹‹å‰æ—©æœŸç‰ˆæœ¬ï¼‰ç­‰å¤‡ä»½æ—¶ã€‚</span><br><span class="line">å±äºç±»å‹ï¼š <span class="variable constant_">MDL</span>ï¼ˆmatedatalockï¼‰å±‚é¢é”</span><br><span class="line">å½±å“æƒ…å†µï¼š åŠ é”æœŸé—´ï¼Œé˜»å¡æ‰€æœ‰äº‹åŠ¡å†™å…¥ï¼Œé˜»å¡æ‰€æœ‰å·²æœ‰äº‹åŠ¡commitã€‚</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">MDL</span>ï¼Œç­‰å¾…æ—¶é—´å— lock_wait_timeout=<span class="number">31536000</span></span><br></pre></td></tr></table></figure>



<h4 id="b-æ£€æµ‹æ–¹æ³•ğŸ•µï¸â€â™‚ï¸"><a href="#b-æ£€æµ‹æ–¹æ³•ğŸ•µï¸â€â™‚ï¸" class="headerlink" title="b. æ£€æµ‹æ–¹æ³•ğŸ•µï¸â€â™‚ï¸"></a>b. æ£€æµ‹æ–¹æ³•ğŸ•µï¸â€â™‚ï¸</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">## <span class="number">8.0</span>ä¹‹å‰éœ€è¦æ‰‹å·¥é…ç½®å¼€å¯.</span><br><span class="line"><span class="keyword">UPDATE</span> performance_schema.setup_instruments</span><br><span class="line"><span class="keyword">SET</span> ENABLED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span>, TIMED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> NAME <span class="operator">=</span> <span class="string">&#x27;wait/lock/metadata/sql/mdl&#x27;</span>;</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> performance_schema.metadata_locks\G</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> OBJECT_SCHEMA ,OBJECT_NAME ,LOCK_TYPE,LOCK_DURATION,LOCK_STATUS ,OWNER_THREAD_ID,OWNER_EVENT_ID <span class="keyword">from</span> performance_schema.metadata_locks;</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> processlist;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sys.schema_table_lock_waits;</span><br><span class="line"></span><br><span class="line">åœºæ™¯:  ä¸šåŠ¡åé¦ˆæ‰€æœ‰å†™å…¥åšä¸äº†.</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> processlist;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> performance_schema.metadata_locks\G</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sys.schema_table_lock_waits;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ²Ÿé€šåå†³å®šæ€ä¹ˆå¤„ç†?</span><br><span class="line">kill ?</span><br></pre></td></tr></table></figure>



<h4 id="ç»å…¸æ•…éšœæ¡ˆä¾‹1ï¼š5-7-xtrabackup-x2F-mysqldumpå¤‡ä»½æ—¶æ•°æ®åº“å‡ºç°hangçŠ¶æ€ï¼Œæ‰€æœ‰ä¿®æ”¹æŸ¥è¯¢éƒ½ä¸èƒ½è¿›è¡Œ"><a href="#ç»å…¸æ•…éšœæ¡ˆä¾‹1ï¼š5-7-xtrabackup-x2F-mysqldumpå¤‡ä»½æ—¶æ•°æ®åº“å‡ºç°hangçŠ¶æ€ï¼Œæ‰€æœ‰ä¿®æ”¹æŸ¥è¯¢éƒ½ä¸èƒ½è¿›è¡Œ" class="headerlink" title="ç»å…¸æ•…éšœæ¡ˆä¾‹1ï¼š5.7 xtrabackup&#x2F;mysqldumpå¤‡ä»½æ—¶æ•°æ®åº“å‡ºç°hangçŠ¶æ€ï¼Œæ‰€æœ‰ä¿®æ”¹æŸ¥è¯¢éƒ½ä¸èƒ½è¿›è¡Œ"></a>ç»å…¸æ•…éšœæ¡ˆä¾‹1ï¼š5.7 xtrabackup&#x2F;mysqldumpå¤‡ä»½æ—¶æ•°æ®åº“å‡ºç°hangçŠ¶æ€ï¼Œæ‰€æœ‰ä¿®æ”¹æŸ¥è¯¢éƒ½ä¸èƒ½è¿›è¡Œ</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">session1: æ¨¡æ‹Ÿä¸€ä¸ªå¤§çš„æŸ¥è¯¢æˆ–äº‹åŠ¡</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> id,sleep(<span class="number">100</span>)  <span class="keyword">from</span> city <span class="keyword">where</span> id<span class="operator">&lt;</span><span class="number">100</span>  <span class="keyword">for</span> <span class="keyword">update</span> ;</span><br><span class="line"></span><br><span class="line">session2: æ¨¡æ‹Ÿå¤‡ä»½æ—¶çš„FTWRL </span><br><span class="line">mysql<span class="operator">&gt;</span> flush tables <span class="keyword">with</span> read lock;</span><br><span class="line"><span class="comment">-- æ­¤æ—¶å‘ç°å‘½ä»¤è¢«é˜»å¡</span></span><br><span class="line"></span><br><span class="line">session3: å‘èµ·æŸ¥è¯¢ï¼Œå‘ç°è¢«é˜»å¡</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> world.city <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"></span><br><span class="line">ç»“è®ºï¼š å¤‡ä»½æ—¶ï¼Œä¸€å®šè¦é€‰æ‹©ä¸šåŠ¡ä¸ç¹å¿™æœŸé—´ï¼Œå¦åˆ™æœ‰å¯èƒ½ä¼šé˜»å¡æ­£å¸¸ä¸šåŠ¡ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>Â </p>
<h4 id="æ•…éšœæ¡ˆä¾‹2ï¼š-5-7ç‰ˆæœ¬-innobackupexå¤‡ä»½å…¨åº“ï¼Œè¿›ç¨‹æ­»äº†ï¼Œmysqlé‡Œå°±æ˜¯å…¨åº“è¯»é”ï¼Œåè¾¹insert-å…¨é˜»å¡äº†"><a href="#æ•…éšœæ¡ˆä¾‹2ï¼š-5-7ç‰ˆæœ¬-innobackupexå¤‡ä»½å…¨åº“ï¼Œè¿›ç¨‹æ­»äº†ï¼Œmysqlé‡Œå°±æ˜¯å…¨åº“è¯»é”ï¼Œåè¾¹insert-å…¨é˜»å¡äº†" class="headerlink" title="æ•…éšœæ¡ˆä¾‹2ï¼š 5.7ç‰ˆæœ¬ Â innobackupexå¤‡ä»½å…¨åº“ï¼Œè¿›ç¨‹æ­»äº†ï¼Œmysqlé‡Œå°±æ˜¯å…¨åº“è¯»é”ï¼Œåè¾¹insert å…¨é˜»å¡äº†"></a>æ•…éšœæ¡ˆä¾‹2ï¼š 5.7ç‰ˆæœ¬ Â innobackupexå¤‡ä»½å…¨åº“ï¼Œè¿›ç¨‹æ­»äº†ï¼Œmysqlé‡Œå°±æ˜¯å…¨åº“è¯»é”ï¼Œåè¾¹insert å…¨é˜»å¡äº†</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#åˆ†ææ€è·¯ï¼š </span><br><span class="line">show processlist  ----&gt;  select * <span class="keyword">from</span> performance_schema.<span class="property">metadata_locks</span>;  ---&gt; pending ----&gt;granted ----&gt; <span class="attr">OWNER_THREAD_ID</span>: <span class="number">66</span></span><br><span class="line">----&gt;  select * <span class="keyword">from</span> threads  \G -----&gt;processlist_Id----&gt;  show processlist -----&gt;  kill processlist_Id</span><br><span class="line">åˆ†æè¿‡ç¨‹:</span><br><span class="line">pending 	 <span class="number">56</span>   <span class="number">54</span>  <span class="number">57</span></span><br><span class="line">events_statements_history</span><br><span class="line"><span class="number">56</span>: 	</span><br><span class="line"><span class="attr">SQL_TEXT</span>: select * <span class="keyword">from</span> city where id=<span class="number">500</span> <span class="keyword">for</span> update</span><br><span class="line"><span class="number">54</span>:</span><br><span class="line"><span class="attr">SQL_TEXT</span>: flush tables <span class="keyword">with</span> read lock</span><br><span class="line"><span class="number">57</span>:</span><br><span class="line"><span class="attr">SQL_TEXT</span>: select * <span class="keyword">from</span> user where id=<span class="number">1</span> <span class="keyword">for</span> update</span><br><span class="line">granted      <span class="number">55</span> 	</span><br><span class="line"><span class="attr">SQL_TEXT</span>: select id,<span class="title function_">sleep</span>(<span class="number">100</span>)  <span class="keyword">from</span> city where id&lt;<span class="number">100</span>  <span class="keyword">for</span> update</span><br><span class="line"><span class="number">55</span>  ---&gt; <span class="number">54</span> ----&gt; <span class="number">56</span> ,<span class="number">57</span></span><br><span class="line"><span class="number">55</span>?  ----&gt;</span><br><span class="line"></span><br><span class="line">#æ•…éšœæ¨¡æ‹Ÿï¼š </span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="7-2-row-lock-wait-é”ç­‰å¾…"><a href="#7-2-row-lock-wait-é”ç­‰å¾…" class="headerlink" title="7.2 row lock wait é”ç­‰å¾…"></a>7.2 row lock wait é”ç­‰å¾…</h3><h4 id="a-ä»‹ç»-1"><a href="#a-ä»‹ç»-1" class="headerlink" title="a.ä»‹ç»"></a>a.ä»‹ç»</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">record lock ã€gapã€next lock</span><br><span class="line">éƒ½æ˜¯åŸºäºç´¢å¼•åŠ é”,ä¸äº‹åŠ¡éš”ç¦»çº§åˆ«æœ‰å…³ã€‚</span><br></pre></td></tr></table></figure>



<h4 id="b-è¡Œé”ç›‘æ§åŠåˆ†æğŸ•µï¸â€â™‚ï¸"><a href="#b-è¡Œé”ç›‘æ§åŠåˆ†æğŸ•µï¸â€â™‚ï¸" class="headerlink" title="b. è¡Œé”ç›‘æ§åŠåˆ†æğŸ•µï¸â€â™‚ï¸"></a>b. è¡Œé”ç›‘æ§åŠåˆ†æğŸ•µï¸â€â™‚ï¸</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># æŸ¥è¯¢é”ç­‰å¾…è¯¦ç»†ä¿¡æ¯</span><br><span class="line">select * <span class="keyword">from</span> sys.<span class="property">innodb_lock_waits</span>;   ----&gt; <span class="title function_">blocking_pid</span>(é”æºçš„è¿æ¥çº¿ç¨‹)</span><br><span class="line"></span><br><span class="line"># é€šè¿‡è¿æ¥çº¿ç¨‹æ‰¾<span class="variable constant_">SQL</span>çº¿ç¨‹</span><br><span class="line">select * <span class="keyword">from</span> performance_schema.<span class="property">threads</span>;</span><br><span class="line"></span><br><span class="line"># é€šè¿‡<span class="variable constant_">SQL</span>çº¿ç¨‹æ‰¾åˆ° <span class="variable constant_">SQL</span>è¯­å¥</span><br><span class="line">select * <span class="keyword">from</span> performance_schema.<span class="property">events_statements_history</span>;</span><br></pre></td></tr></table></figure>



<h4 id="c-ä¼˜åŒ–æ–¹å‘"><a href="#c-ä¼˜åŒ–æ–¹å‘" class="headerlink" title="c. ä¼˜åŒ–æ–¹å‘"></a>c. ä¼˜åŒ–æ–¹å‘</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> ä¼˜åŒ–ç´¢å¼•</span><br><span class="line"><span class="number">2.</span> å‡å°‘äº‹åŠ¡çš„æ›´æ–°èŒƒå›´</span><br><span class="line"><span class="number">3.</span> <span class="variable constant_">RC</span></span><br><span class="line"><span class="number">4.</span> æ‹†åˆ†è¯­å¥ï¼š </span><br><span class="line">ä¾‹å¦‚ï¼š  update t1 set num=num+<span class="number">10</span> where k1 &lt;<span class="number">100</span>;  k1 æ˜¯è¾…åŠ©ç´¢å¼•,record lock gap next</span><br><span class="line">	   æ”¹ä¸º:</span><br><span class="line">	   select id <span class="keyword">from</span> t1 where  k1 &lt;<span class="number">100</span>; ---&gt; <span class="attr">id</span>: <span class="number">20</span>,<span class="number">30</span>,<span class="number">50</span></span><br><span class="line">	   update t1 set num=num+<span class="number">10</span>   where id <span class="keyword">in</span> (<span class="number">20</span>,<span class="number">30</span>,<span class="number">50</span>);</span><br></pre></td></tr></table></figure>



<h4 id="æ•…éšœæ¡ˆä¾‹3-16C-top-CPUä½¿ç”¨æ€»é‡-1200-1300-å¹³å‡-80-MySQLæ•°æ®åº“æœåŠ¡å™¨"><a href="#æ•…éšœæ¡ˆä¾‹3-16C-top-CPUä½¿ç”¨æ€»é‡-1200-1300-å¹³å‡-80-MySQLæ•°æ®åº“æœåŠ¡å™¨" class="headerlink" title="æ•…éšœæ¡ˆä¾‹3Â : Â 16C Â  Â top Â CPUä½¿ç”¨æ€»é‡ 1200%-1300, å¹³å‡ 80%+ Â  MySQLæ•°æ®åº“æœåŠ¡å™¨"></a>æ•…éšœæ¡ˆä¾‹3Â : Â 16C Â  Â top Â CPUä½¿ç”¨æ€»é‡ 1200%-1300, å¹³å‡ 80%+ Â  MySQLæ•°æ®åº“æœåŠ¡å™¨</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#åˆ†ææ€è·¯ï¼š </span><br><span class="line">top -<span class="title class_">Hp</span>  <span class="variable constant_">MYSQLID</span>   ---&gt; os_id   ----&gt; <span class="variable constant_">P_S</span>.<span class="property">threads</span> ---&gt; processlist_id ,  thread_id</span><br><span class="line"><span class="variable constant_">IO</span>  ---&gt; top  wait</span><br><span class="line">å¯èƒ½æ˜¯ä»€ä¹ˆåŸå› ?</span><br><span class="line"><span class="variable constant_">IOPS</span>? å›è¡¨å¤ªå¤š?---&gt; ç´¢å¼•</span><br><span class="line">åå? ç´¢å¼•?</span><br><span class="line">ç¡¬ä»¶? raid <span class="variable constant_">IO</span>è°ƒåº¦  .....</span><br><span class="line">å¤§äº‹åŠ¡.</span><br><span class="line">å‚æ•°.</span><br><span class="line"><span class="variable constant_">SQL</span> :</span><br><span class="line">events_statements_history/current</span><br><span class="line">ç±»å‹:</span><br><span class="line">select  ----&gt; explain  ---&gt;ç´¢å¼•     <span class="variable constant_">SQL</span>æœ¬èº« --&gt; kill</span><br><span class="line"><span class="variable constant_">DML</span>     ----&gt; é”  å¤§äº‹åŠ¡ ---&gt; ç´¢å¼•  <span class="variable constant_">SQL</span>æœ¬èº« ---&gt; è¯„ä¼°</span><br><span class="line"><span class="variable constant_">DDL</span>     ----&gt;  <span class="variable constant_">MDL</span>     ----&gt; kill</span><br><span class="line"></span><br><span class="line">#æ•…éšœæ¨¡æ‹Ÿï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="8-æ¶æ„ä¼˜åŒ–"><a href="#8-æ¶æ„ä¼˜åŒ–" class="headerlink" title="8.æ¶æ„ä¼˜åŒ–"></a>8.æ¶æ„ä¼˜åŒ–</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#é«˜å¯ç”¨æ¶æ„ï¼š</span><br><span class="line">	<span class="variable constant_">MHA</span>+<span class="title class_">ProxySQL</span>+<span class="variable constant_">GTID</span>+å¢å¼ºåŠåŒæ­¥   <span class="number">99.99</span>%   é«˜å¯ç”¨+ è¯»å†™åˆ†ç¦»--&gt; ä¸­å°å‹ä¼ä¸š</span><br><span class="line">	<span class="variable constant_">MGR</span>\<span class="title class_">InnoDB</span> <span class="title class_">Cluster</span>            </span><br><span class="line">	<span class="variable constant_">PXC</span> </span><br><span class="line">#è¯»å†™åˆ†ç¦»ï¼š </span><br><span class="line">	<span class="title class_">ProxySQL</span>ã€<span class="title class_">MySQL</span>-router</span><br><span class="line">#åˆ†å¸ƒå¼æ¶æ„ï¼š </span><br><span class="line">	<span class="title class_">MYcat</span>  <span class="title class_">Polardb</span> <span class="variable constant_">TDSQL</span>   </span><br><span class="line"></span><br><span class="line">#<span class="title class_">NoSQL</span>: </span><br><span class="line">	<span class="title class_">Redis</span>+<span class="title function_">sentinel</span>(å“¨å…µ),<span class="title class_">Redis</span> <span class="title class_">Cluster</span></span><br><span class="line">	<span class="title class_">MongoDB</span> <span class="variable constant_">RS</span>/<span class="title class_">MongoDB</span> <span class="variable constant_">SHARDING</span> <span class="title class_">Cluster</span> </span><br><span class="line">	<span class="variable constant_">ES</span>  solr</span><br></pre></td></tr></table></figure>



<h2 id="9-å®‰å…¨ä¼˜åŒ–"><a href="#9-å®‰å…¨ä¼˜åŒ–" class="headerlink" title="9.å®‰å…¨ä¼˜åŒ–"></a>9.å®‰å…¨ä¼˜åŒ–</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>ã€ ä½¿ç”¨æ™®é€šnologinç”¨æˆ·ç®¡ç†<span class="title class_">MySQL</span></span><br><span class="line"><span class="number">2</span>ã€ åˆç†æˆæƒç”¨æˆ·ã€å¯†ç å¤æ‚åº¦åŠæœ€å°æƒé™ã€ç³»ç»Ÿè¡¨ä¿è¯åªæœ‰ç®¡ç†å‘˜ç”¨æˆ·å¯è®¿é—®ã€‚</span><br><span class="line"><span class="number">3</span>ã€ åˆ é™¤æ•°æ®åº“åŒ¿åç”¨æˆ·</span><br><span class="line"><span class="number">4</span>ã€ é”å®šéæ´»åŠ¨ç”¨æˆ·</span><br><span class="line"><span class="number">5</span>ã€ <span class="title class_">MySQL</span>å°½é‡ä¸æš´éœ²äº’è”ç½‘,éœ€è¦æš´éœ²äº’è”ç½‘ç”¨æˆ·éœ€è¦è®¾ç½®æ˜ç¡®ç™½åå•ã€æ›¿æ¢<span class="title class_">MySQL</span>é»˜è®¤ç«¯å£å·ã€ä½¿ç”¨sslè¿æ¥</span><br><span class="line"><span class="number">6</span>ã€ ä¼˜åŒ–ä¸šåŠ¡ä»£ç ï¼Œé˜²æ­¢<span class="variable constant_">SQL</span>æ³¨å…¥ã€‚</span><br></pre></td></tr></table></figure>



<h2 id="10-å¸¸ç”¨å·¥å…·ä»‹ç»"><a href="#10-å¸¸ç”¨å·¥å…·ä»‹ç»" class="headerlink" title="10.å¸¸ç”¨å·¥å…·ä»‹ç»"></a>10.å¸¸ç”¨å·¥å…·ä»‹ç»</h2><h3 id="ä¸€ã€-PTï¼ˆpercona-toolkitsï¼‰å·¥å…·çš„åº”ç”¨"><a href="#ä¸€ã€-PTï¼ˆpercona-toolkitsï¼‰å·¥å…·çš„åº”ç”¨" class="headerlink" title="ä¸€ã€ PTï¼ˆpercona-toolkitsï¼‰å·¥å…·çš„åº”ç”¨"></a>ä¸€ã€ PTï¼ˆpercona-toolkitsï¼‰å·¥å…·çš„åº”ç”¨</h3><p><em>1. ptå·¥å…·å®‰è£…</em></p>
<p>[root@master ~]# <code>&lt;font style=&quot;color:#F5222D;&quot;&gt;yum install -y Â percona-toolkit-3.1.0-2.el7.x86_64.rpm&lt;/font&gt;</code><font style="color:#F5222D;">Â </font></p>
<p><em>2. å¸¸ç”¨å·¥å…·ä½¿ç”¨ä»‹ç»</em></p>
<p><img src="https://cdn.fbbizyy.com/yuque/0/2021/png/1581532/1609981686723-1be82e57-b85f-4699-bb26-532048d8c476.png"></p>
<h4 id="2-1-pt-archiver-å½’æ¡£è¡¨"><a href="#2-1-pt-archiver-å½’æ¡£è¡¨" class="headerlink" title="2.1 pt-archiver å½’æ¡£è¡¨"></a><font style="color:#F5222D;">2.1 pt-archiver å½’æ¡£è¡¨</font></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">åœºæ™¯ï¼š </span><br><span class="line">	é¢è¯•é¢˜ï¼š äº¿çº§çš„å¤§è¡¨ï¼Œ<span class="keyword">delete</span>æ‰¹é‡åˆ é™¤100wå·¦å³æ•°æ®ã€‚ #æ‰¹é‡åˆ é™¤åŠŸèƒ½</span><br><span class="line">	é¢è¯•é¢˜ï¼š å®šæœŸæŒ‰ç…§æ—¶é—´èŒƒå›´ï¼Œè¿›è¡Œå½’æ¡£è¡¨ã€‚           #å½’æ¡£åŠŸèƒ½---å¹¶å‘å½’æ¡£</span><br><span class="line"></span><br><span class="line">#é‡è¦å‚æ•°</span><br><span class="line">--limit <span class="number">100</span>         æ¯æ¬¡å–<span class="number">100</span>è¡Œæ•°æ®ç”¨pt-archiveå¤„ç†    </span><br><span class="line">--txn-size  <span class="number">100</span>     è®¾ç½®<span class="number">100</span>è¡Œä¸ºä¸€ä¸ªäº‹åŠ¡æäº¤ä¸€æ¬¡ï¼Œ    </span><br><span class="line">--where <span class="string">&#x27;id&lt;3000&#x27;</span>   è®¾ç½®æ“ä½œæ¡ä»¶    </span><br><span class="line">--progress <span class="number">5000</span>     æ¯å¤„ç†<span class="number">5000</span>è¡Œè¾“å‡ºä¸€æ¬¡å¤„ç†ä¿¡æ¯    </span><br><span class="line">--statistics        è¾“å‡ºæ‰§è¡Œè¿‡ç¨‹åŠæœ€åçš„æ“ä½œç»Ÿè®¡ã€‚ï¼ˆåªè¦ä¸åŠ ä¸Š--quietï¼Œé»˜è®¤æƒ…å†µä¸‹pt- archiveéƒ½ä¼šè¾“å‡ºæ‰§è¡Œè¿‡ç¨‹çš„ï¼‰    </span><br><span class="line">--charset=<span class="title class_">UTF8</span>      æŒ‡å®šå­—ç¬¦é›†ä¸º<span class="title class_">UTF8</span>â€”è¿™ä¸ªæœ€ååŠ ä¸Šä¸ç„¶å¯èƒ½å‡ºç°ä¹±ç ã€‚    </span><br><span class="line">--bulk-<span class="keyword">delete</span>       æ‰¹é‡åˆ é™¤sourceä¸Šçš„æ—§æ•°æ®(ä¾‹å¦‚æ¯æ¬¡<span class="number">1000</span>è¡Œçš„æ‰¹é‡åˆ é™¤æ“ä½œ)</span><br><span class="line"></span><br><span class="line">æ³¨æ„:  éœ€è¦å½’æ¡£è¡¨ä¸­è‡³å°‘æœ‰ä¸€ä¸ªç´¢å¼•,åšå¥½æ˜¯whereæ¡ä»¶åˆ—æœ‰ç´¢å¼•</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä½¿ç”¨æ¡ˆä¾‹ï¼š</span><br><span class="line"><span class="number">1.</span>å½’æ¡£åˆ°æ•°æ®åº“      ---è¿œç¨‹å½’æ¡£å±…å¤š</span><br><span class="line">#<span class="number">1.1</span> è·å¾—å»ºè¡¨è¯­å¥</span><br><span class="line"></span><br><span class="line">#<span class="number">1.2</span> å¤‡ä»½</span><br><span class="line">db01 [test]&gt; create table test1 like t100w;</span><br><span class="line">pt-archiver --source h=<span class="number">10.0</span><span class="number">.0</span><span class="number">.51</span>,D=test,t=t100w,u=oldguo,p=<span class="number">123</span> --dest h=<span class="number">10.0</span><span class="number">.0</span><span class="number">.51</span>,D=test,t=test1,u=oldguo,p=<span class="number">123</span> --where <span class="string">&#x27;id&lt;10000&#x27;</span> --no-check-charset --no-<span class="keyword">delete</span> --limit=<span class="number">1000</span> --commit-each --progress <span class="number">1000</span> --statistics</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>åªæ¸…ç†æ•°æ®</span><br><span class="line">pt-archiver --source h=<span class="number">10.0</span><span class="number">.0</span><span class="number">.51</span>,D=test,t=t100w,u=oldguo,p=<span class="number">123</span> --where <span class="string">&#x27;id&lt;10000&#x27;</span> --purge --limit=<span class="number">1</span> --no-check-charset</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>åªæŠŠæ•°æ®å¯¼å‡ºåˆ°å¤–éƒ¨æ–‡ä»¶ï¼Œä½†æ˜¯ä¸åˆ é™¤æºè¡¨é‡Œçš„æ•°æ®</span><br><span class="line">pt-archiver --source h=<span class="number">10.0</span><span class="number">.0</span><span class="number">.51</span>,D=world,t=city,u=root,p=<span class="number">123</span> --where <span class="string">&#x27;1=1&#x27;</span> --no-check-charset --no-<span class="keyword">delete</span> --file=<span class="string">&quot;/tmp/archiver.dat&quot;</span> </span><br></pre></td></tr></table></figure>

<p><strong><font style="color:#F5222D;"></font></strong></p>
<h4 id="2-2-pt-osc-ä¿®æ”¹è¡¨ç»“æ„"><a href="#2-2-pt-osc-ä¿®æ”¹è¡¨ç»“æ„" class="headerlink" title="2.2 pt-osc ä¿®æ”¹è¡¨ç»“æ„"></a><font style="color:#F5222D;">2.2 pt-osc ä¿®æ”¹è¡¨ç»“æ„</font></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">#åœºæ™¯ï¼š  </span><br><span class="line">	  ä¿®æ”¹è¡¨ç»“æ„ã€ç´¢å¼•åˆ›å»ºåˆ é™¤</span><br><span class="line">	  ä¸èƒ½åŠ å¿«é€Ÿåº¦ï¼Œä½†èƒ½å‡å°‘ä¸šåŠ¡å½±å“ï¼ˆé”ï¼‰ã€‚</span><br><span class="line">	  </span><br><span class="line">#é¢è¯•é¢˜ ï¼š 	  	  </span><br><span class="line">pt-oscå·¥ä½œæµç¨‹ï¼š</span><br><span class="line"><span class="number">1</span>ã€æ£€æŸ¥æ›´æ”¹è¡¨æ˜¯å¦æœ‰ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ï¼Œæ˜¯å¦æœ‰è§¦å‘å™¨</span><br><span class="line"><span class="number">2</span>ã€æ£€æŸ¥ä¿®æ”¹è¡¨çš„è¡¨ç»“æ„ï¼Œåˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œåœ¨æ–°è¡¨ä¸Šæ‰§è¡Œ<span class="variable constant_">ALTER</span> <span class="variable constant_">TABLE</span>è¯­å¥</span><br><span class="line">create table  bak like t1; </span><br><span class="line">alter table bak add telnum <span class="title function_">char</span>(<span class="number">11</span>) not <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>ã€åœ¨æºè¡¨ä¸Šåˆ›å»ºä¸‰ä¸ªè§¦å‘å™¨åˆ†åˆ«å¯¹äº<span class="variable constant_">INSERT</span> <span class="variable constant_">UPDATE</span> <span class="variable constant_">DELETE</span>æ“ä½œ</span><br><span class="line">create trigger </span><br><span class="line">a </span><br><span class="line">b </span><br><span class="line">c</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>ã€ä»æºè¡¨æ‹·è´æ•°æ®åˆ°ä¸´æ—¶è¡¨ï¼Œåœ¨æ‹·è´è¿‡ç¨‹ä¸­ï¼Œå¯¹æºè¡¨çš„æ›´æ–°æ“ä½œä¼šå†™å…¥åˆ°æ–°å»ºè¡¨ä¸­</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">5</span>ã€å°†ä¸´æ—¶è¡¨å’Œæºè¡¨renameï¼ˆéœ€è¦å…ƒæ•°æ®ä¿®æ”¹é”ï¼Œéœ€è¦çŸ­æ—¶é—´é”è¡¨ï¼‰</span><br><span class="line"></span><br><span class="line"><span class="number">6</span>ã€åˆ é™¤æºè¡¨å’Œè§¦å‘å™¨ï¼Œå®Œæˆè¡¨ç»“æ„çš„ä¿®æ”¹ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pt-oscå·¥å…·é™åˆ¶</span><br><span class="line"><span class="number">1</span>ã€æºè¡¨å¿…é¡»æœ‰ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰å·¥å…·å°†åœæ­¢å·¥ä½œ</span><br><span class="line"><span class="number">2</span>ã€å¦‚æœçº¿ä¸Šçš„å¤åˆ¶ç¯å¢ƒè¿‡æ»¤å™¨æ“ä½œè¿‡äºå¤æ‚ï¼Œå·¥å…·å°†æ— æ³•å·¥ä½œ</span><br><span class="line"><span class="number">3</span>ã€å¦‚æœå¼€å¯å¤åˆ¶å»¶è¿Ÿæ£€æŸ¥ï¼Œä½†ä¸»ä»å»¶è¿Ÿæ—¶ï¼Œå·¥å…·å°†æš‚åœæ•°æ®æ‹·è´å·¥ä½œ</span><br><span class="line"><span class="number">4</span>ã€å¦‚æœå¼€å¯ä¸»æœåŠ¡å™¨è´Ÿè½½æ£€æŸ¥ï¼Œä½†ä¸»æœåŠ¡å™¨è´Ÿè½½è¾ƒé«˜æ—¶ï¼Œå·¥å…·å°†æš‚åœæ“ä½œ</span><br><span class="line"><span class="number">5</span>ã€å½“è¡¨ä½¿ç”¨å¤–é”®æ—¶ï¼Œå¦‚æœæœªä½¿ç”¨--alter-foreign-keys-methodå‚æ•°ï¼Œå·¥å…·å°†æ— æ³•æ‰§è¡Œ</span><br><span class="line"><span class="number">6</span>ã€åªæ”¯æŒ<span class="title class_">Innodb</span>å­˜å‚¨å¼•æ“è¡¨ï¼Œä¸”è¦æ±‚æœåŠ¡å™¨ä¸Šæœ‰è¯¥è¡¨<span class="number">1</span>å€ä»¥ä¸Šçš„ç©ºé—²ç©ºé—´ã€‚</span><br><span class="line"></span><br><span class="line">#pt-oscä¹‹alterè¯­å¥é™åˆ¶</span><br><span class="line"><span class="number">1</span>ã€ä¸éœ€è¦åŒ…å«alter tableå…³é”®å­—ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªä¿®æ”¹æ“ä½œï¼Œä½¿ç”¨é€—å·åˆ†å¼€ï¼Œå¦‚<span class="string">&quot;drop clolumn c1, add column c2 int&quot;</span></span><br><span class="line"><span class="number">2</span>ã€ä¸æ”¯æŒrenameè¯­å¥æ¥å¯¹è¡¨è¿›è¡Œé‡å‘½åæ“ä½œ</span><br><span class="line"><span class="number">3</span>ã€ä¸æ”¯æŒå¯¹ç´¢å¼•è¿›è¡Œé‡å‘½åæ“ä½œ</span><br><span class="line"><span class="number">4</span>ã€å¦‚æœåˆ é™¤å¤–é”®ï¼Œéœ€è¦å¯¹å¤–é”®ååŠ ä¸‹åˆ’çº¿ï¼Œå¦‚åˆ é™¤å¤–é”®fk_uid, ä¿®æ”¹è¯­å¥ä¸º<span class="string">&quot;DROP FOREIGN KEY _fk_uid&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pt-oscä¹‹å‘½ä»¤æ¨¡æ¿</span><br><span class="line">## --executeè¡¨ç¤ºæ‰§è¡Œ</span><br><span class="line">## --dry-runè¡¨ç¤ºåªè¿›è¡Œæ¨¡æ‹Ÿæµ‹è¯•</span><br><span class="line">## è¡¨ååªèƒ½ä½¿ç”¨å‚æ•°tæ¥è®¾ç½®ï¼Œæ²¡æœ‰é•¿å‚æ•°</span><br><span class="line"></span><br><span class="line">pt-online-schema-change \</span><br><span class="line">--host=<span class="string">&quot;127.0.0.1&quot;</span> \</span><br><span class="line">--port=<span class="number">3358</span> \</span><br><span class="line">--user=<span class="string">&quot;root&quot;</span> \</span><br><span class="line">--password=<span class="string">&quot;root@root&quot;</span> \</span><br><span class="line">--charset=<span class="string">&quot;utf8&quot;</span> \</span><br><span class="line">--max-lag=<span class="number">10</span> \</span><br><span class="line">--check-salve-lag=<span class="string">&#x27;xxx.xxx.xxx.xxx&#x27;</span> \</span><br><span class="line">--recursion-method=<span class="string">&quot;hosts&quot;</span> \</span><br><span class="line">--check-interval=<span class="number">2</span> \</span><br><span class="line">--database=<span class="string">&quot;testdb1&quot;</span> \</span><br><span class="line">  t=<span class="string">&quot;tb001&quot;</span> \</span><br><span class="line">--alter=<span class="string">&quot;add column c4 int&quot;</span> \</span><br><span class="line">--execute</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä¾‹å­ï¼š</span><br><span class="line">pt-online-schema-change --user=oldguo --password=<span class="number">123</span> --host=<span class="number">10.0</span><span class="number">.0</span><span class="number">.51</span> --alter <span class="string">&quot;add column state int not null default 1&quot;</span> D=test,t=t100w --print --execute</span><br><span class="line"></span><br><span class="line">pt-online-schema-change --user=oldguo --password=<span class="number">123</span> --host=<span class="number">10.0</span><span class="number">.0</span><span class="number">.51</span> --alter <span class="string">&quot;add index idx(num)&quot;</span> D=test,t=t100w --print --execute</span><br></pre></td></tr></table></figure>

<p><strong><font style="color:#F5222D;"></font></strong></p>
<h4 id="2-3-pt-table-checksum-æ ¡éªŒä¸»ä»æ•°æ®"><a href="#2-3-pt-table-checksum-æ ¡éªŒä¸»ä»æ•°æ®" class="headerlink" title="2.3 pt-table-checksum æ ¡éªŒä¸»ä»æ•°æ®"></a><font style="color:#F5222D;">2.3 pt-table-checksum æ ¡éªŒä¸»ä»æ•°æ®</font></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#åœºæ™¯ï¼š   æ ¡éªŒä¸»ä»æ•°æ®ä¸€è‡´æ€§ï¼Œç”Ÿäº§ä¸­å¯ç”¨äºå®šæ—¶ä»»åŠ¡ã€‚</span><br><span class="line"> ç¯å¢ƒå‡†å¤‡:</span><br><span class="line">	- ä¸»ä»ç¯å¢ƒ</span><br><span class="line">  - ä»åº“å¼€å¯é…ç½®</span><br><span class="line">    [mysqld]</span><br><span class="line">    report_host=<span class="number">10.0</span><span class="number">.0</span><span class="number">.52</span></span><br><span class="line">		report_port=<span class="number">3307</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2.3</span><span class="number">.1</span> åˆ›å»ºæ•°æ®åº“</span><br><span class="line"><span class="title class_">Create</span> database pt <span class="variable constant_">CHARACTER</span> <span class="variable constant_">SET</span> utf8;</span><br><span class="line"></span><br><span class="line">åˆ›å»ºç”¨æˆ·checksumå¹¶æˆæƒ</span><br><span class="line">create user  <span class="string">&#x27;checksum&#x27;</span>@<span class="string">&#x27;10.0.0.%&#x27;</span> identified <span class="keyword">with</span> mysql_native_password by <span class="string">&#x27;checksum&#x27;</span>;</span><br><span class="line"><span class="variable constant_">GRANT</span> <span class="variable constant_">ALL</span> <span class="variable constant_">ON</span> *.* <span class="variable constant_">TO</span> <span class="string">&#x27;checksum&#x27;</span>@<span class="string">&#x27;10.0.0.%&#x27;</span> ;</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line"><span class="number">2.3</span><span class="number">.2</span> å‚æ•°: </span><br><span class="line">--[no]check-replication-filtersï¼šæ˜¯å¦æ£€æŸ¥å¤åˆ¶çš„è¿‡æ»¤å™¨ï¼Œé»˜è®¤æ˜¯yesï¼Œå»ºè®®å¯ç”¨ä¸æ£€æŸ¥æ¨¡å¼ã€‚</span><br><span class="line">--databases | -dï¼šæŒ‡å®šéœ€è¦è¢«æ£€æŸ¥çš„æ•°æ®åº“ï¼Œå¤šä¸ªåº“ä¹‹é—´å¯ä»¥ç”¨é€—å·åˆ†éš”ã€‚</span><br><span class="line">--[no]check-binlog-formatï¼šæ˜¯å¦æ£€æŸ¥binlogæ–‡ä»¶çš„æ ¼å¼ï¼Œé»˜è®¤å€¼yesã€‚å»ºè®®å¼€å¯ä¸æ£€æŸ¥ã€‚å› ä¸ºåœ¨é»˜è®¤çš„rowæ ¼å¼ä¸‹ä¼šå‡ºé”™ã€‚</span><br><span class="line">--replicateï¼šæŠŠchecksumçš„ä¿¡æ¯å†™å…¥åˆ°æŒ‡å®šè¡¨ä¸­ã€‚</span><br><span class="line">--replicate-check-onlyï¼šåªæ˜¾ç¤ºä¸åŒæ­¥ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">pt-table-checksum --nocheck-replication-filters --no-check-binlog-format --replicate=pt.<span class="property">checksums</span> --create-replicate-table --databases=test --tables=t1 h=<span class="number">10.0</span><span class="number">.0</span><span class="number">.51</span>,u=checksum,p=checksum,P=<span class="number">3307</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----&gt;  å¯å°†å‘½ä»¤åŠ å…¥åˆ°å®šæ—¶ä»»åŠ¡è„šæœ¬ã€‚æ£€æŸ¥å¼‚æ­¥å¤åˆ¶ï¼Œæ˜¯å¦å‡ºç°é—®é¢˜ã€‚</span><br><span class="line">cat checksum.<span class="property">sh</span></span><br><span class="line">#!<span class="regexp">/bin/</span>bash </span><br><span class="line">date &gt;&gt; <span class="regexp">/root/</span>db/checksum.<span class="property">log</span></span><br><span class="line">pt-table-checksum --nocheck-binlog-format --nocheck-plan --nocheck-replication-filters --replicate=pt.<span class="property">checksums</span> --set-vars innodb_lock_wait_timeout=<span class="number">120</span> --databases test --tables t1 -u<span class="string">&#x27;checksum&#x27;</span> -p<span class="string">&#x27;checksum&#x27;</span> -h<span class="string">&#x27;10.0.0.51&#x27;</span> &gt;&gt; <span class="regexp">/tmp/</span>checksum.<span class="property">log</span></span><br><span class="line">date &gt;&gt; <span class="regexp">/root/</span>db/checksum.<span class="property">log</span></span><br></pre></td></tr></table></figure>



<h4 id="2-4-pt-table-sync-ä¿®å¤ä¸»ä»æ•°æ®"><a href="#2-4-pt-table-sync-ä¿®å¤ä¸»ä»æ•°æ®" class="headerlink" title="2.4 pt-table-sync ä¿®å¤ä¸»ä»æ•°æ®"></a>2.4 pt-table-sync ä¿®å¤ä¸»ä»æ•°æ®</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.4</span> pt-table-sync</span><br><span class="line">ä¸»è¦å‚æ•°ä»‹ç»</span><br><span class="line">--replicate ï¼šæŒ‡å®šé€šè¿‡pt-table-checksumå¾—åˆ°çš„è¡¨.</span><br><span class="line">--databases : æŒ‡å®šæ‰§è¡ŒåŒæ­¥çš„æ•°æ®åº“ã€‚</span><br><span class="line">--tables ï¼šæŒ‡å®šæ‰§è¡ŒåŒæ­¥çš„è¡¨ï¼Œå¤šä¸ªç”¨é€—å·éš”å¼€ã€‚</span><br><span class="line">--sync-to-master ï¼šæŒ‡å®šä¸€ä¸ª<span class="variable constant_">DSN</span>ï¼Œå³ä»çš„<span class="variable constant_">IP</span>ï¼Œä»–ä¼šé€šè¿‡show processlistæˆ–show slave status å»è‡ªåŠ¨çš„æ‰¾ä¸»ã€‚</span><br><span class="line">h= ï¼šæœåŠ¡å™¨åœ°å€ï¼Œå‘½ä»¤é‡Œæœ‰<span class="number">2</span>ä¸ªipï¼Œç¬¬ä¸€æ¬¡å‡ºç°çš„æ˜¯<span class="title class_">Master</span>çš„åœ°å€ï¼Œç¬¬<span class="number">2</span>æ¬¡æ˜¯<span class="title class_">Slave</span>çš„åœ°å€ã€‚</span><br><span class="line">u= ï¼šå¸å·ã€‚</span><br><span class="line">p= ï¼šå¯†ç ã€‚</span><br><span class="line">--print ï¼šæ‰“å°ï¼Œä½†ä¸æ‰§è¡Œå‘½ä»¤ã€‚</span><br><span class="line">--execute ï¼šæ‰§è¡Œå‘½ä»¤ã€‚</span><br><span class="line"></span><br><span class="line">pt-table-sync --replicate=pt.<span class="property">checksums</span> --databases test  --tables t1 h=<span class="number">10.0</span><span class="number">.0</span><span class="number">.51</span>,u=checksum,p=checksum,P=<span class="number">3307</span> h=<span class="number">10.0</span><span class="number">.0</span><span class="number">.51</span>,u=checksum,p=checksum,P=<span class="number">3306</span> --print</span><br><span class="line"></span><br><span class="line">pt-table-sync --replicate=pt.<span class="property">checksums</span> --databases test  --tables t1 h=<span class="number">10.0</span><span class="number">.0</span><span class="number">.51</span>,u=checksum,p=checksum,P=<span class="number">3307</span> h=<span class="number">10.0</span><span class="number">.0</span><span class="number">.51</span>,u=checksum,p=checksum,P=<span class="number">3307</span> --execute</span><br></pre></td></tr></table></figure>

<p><strong><font style="color:#F5222D;"></font></strong></p>
<h4 id="2-5-pt-show-grants-å¤‡ä»½æ•°æ®åº“ç”¨æˆ·çš„æ–¹æ³•-âœ¨"><a href="#2-5-pt-show-grants-å¤‡ä»½æ•°æ®åº“ç”¨æˆ·çš„æ–¹æ³•-âœ¨" class="headerlink" title="2.5. # pt-show-grants (å¤‡ä»½æ•°æ®åº“ç”¨æˆ·çš„æ–¹æ³•)âœ¨ "></a><font style="color:#F5222D;">2.5. # pt-show-grants (å¤‡ä»½æ•°æ®åº“ç”¨æˆ·çš„æ–¹æ³•)</font><font style="color:#F5222D;">âœ¨</font><font style="color:#F5222D;"> </font></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#ä½œç”¨:  ç”¨æˆ·å’Œæƒé™ä¿¡æ¯è¿ç§»ã€‚</span><br><span class="line">pt-show-grants -h10<span class="number">.0</span><span class="number">.0</span><span class="number">.51</span>  -<span class="variable constant_">P3307</span>  -uchecksum -pchecksum </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----------------&gt;  å¯¼å‡ºç»“æœï¼š </span><br><span class="line">-- <span class="title class_">Grants</span> dumped by pt-show-grants</span><br><span class="line">-- <span class="title class_">Dumped</span> <span class="keyword">from</span> server <span class="number">10.0</span><span class="number">.0</span><span class="number">.51</span> via <span class="variable constant_">TCP</span>/<span class="variable constant_">IP</span>, <span class="title class_">MySQL</span> <span class="number">5.7</span><span class="number">.28</span>-log at <span class="number">2020</span>-<span class="number">05</span>-<span class="number">15</span> <span class="number">17</span>:<span class="number">11</span>:<span class="number">06</span></span><br><span class="line">-- <span class="title class_">Grants</span> <span class="keyword">for</span> <span class="string">&#x27;checksum&#x27;</span>@<span class="string">&#x27;10.0.0.%&#x27;</span></span><br><span class="line"><span class="variable constant_">CREATE</span> <span class="variable constant_">USER</span> <span class="variable constant_">IF</span> <span class="variable constant_">NOT</span> <span class="variable constant_">EXISTS</span> <span class="string">&#x27;checksum&#x27;</span>@<span class="string">&#x27;10.0.0.%&#x27;</span>;</span><br><span class="line"><span class="variable constant_">ALTER</span> <span class="variable constant_">USER</span> <span class="string">&#x27;checksum&#x27;</span>@<span class="string">&#x27;10.0.0.%&#x27;</span> <span class="variable constant_">IDENTIFIED</span> <span class="variable constant_">WITH</span> <span class="string">&#x27;mysql_native_password&#x27;</span> <span class="variable constant_">AS</span> <span class="string">&#x27;*E5E390AF1BDF241B51D9C0DBBEA262CC9407A2DF&#x27;</span> <span class="variable constant_">REQUIRE</span> <span class="variable constant_">NONE</span> <span class="variable constant_">PASSWORD</span> <span class="variable constant_">EXPIRE</span> <span class="variable constant_">DEFAULT</span> <span class="variable constant_">ACCOUNT</span> <span class="variable constant_">UNLOCK</span>;</span><br><span class="line"><span class="variable constant_">GRANT</span> <span class="variable constant_">ALL</span> <span class="variable constant_">PRIVILEGES</span> <span class="variable constant_">ON</span> *.* <span class="variable constant_">TO</span> <span class="string">&#x27;checksum&#x27;</span>@<span class="string">&#x27;10.0.0.%&#x27;</span>;</span><br><span class="line">-- <span class="title class_">Grants</span> <span class="keyword">for</span> <span class="string">&#x27;mysql.session&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line"><span class="variable constant_">CREATE</span> <span class="variable constant_">USER</span> <span class="variable constant_">IF</span> <span class="variable constant_">NOT</span> <span class="variable constant_">EXISTS</span> <span class="string">&#x27;mysql.session&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="variable constant_">ALTER</span> <span class="variable constant_">USER</span> <span class="string">&#x27;mysql.session&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="variable constant_">IDENTIFIED</span> <span class="variable constant_">WITH</span> <span class="string">&#x27;mysql_native_password&#x27;</span> <span class="variable constant_">AS</span> <span class="string">&#x27;*THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE&#x27;</span> <span class="variable constant_">REQUIRE</span> <span class="variable constant_">NONE</span> <span class="variable constant_">PASSWORD</span> <span class="variable constant_">EXPIRE</span> <span class="variable constant_">DEFAULT</span> <span class="variable constant_">ACCOUNT</span> <span class="variable constant_">LOCK</span>;</span><br><span class="line"><span class="variable constant_">GRANT</span> <span class="variable constant_">SELECT</span> <span class="variable constant_">ON</span> <span class="string">`mysql`</span>.<span class="string">`user`</span> <span class="variable constant_">TO</span> <span class="string">&#x27;mysql.session&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="variable constant_">GRANT</span> <span class="variable constant_">SELECT</span> <span class="variable constant_">ON</span> <span class="string">`performance_schema`</span>.* <span class="variable constant_">TO</span> <span class="string">&#x27;mysql.session&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="variable constant_">GRANT</span> <span class="variable constant_">SUPER</span> <span class="variable constant_">ON</span> *.* <span class="variable constant_">TO</span> <span class="string">&#x27;mysql.session&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">-- <span class="title class_">Grants</span> <span class="keyword">for</span> <span class="string">&#x27;mysql.sys&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line"><span class="variable constant_">CREATE</span> <span class="variable constant_">USER</span> <span class="variable constant_">IF</span> <span class="variable constant_">NOT</span> <span class="variable constant_">EXISTS</span> <span class="string">&#x27;mysql.sys&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="variable constant_">ALTER</span> <span class="variable constant_">USER</span> <span class="string">&#x27;mysql.sys&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="variable constant_">IDENTIFIED</span> <span class="variable constant_">WITH</span> <span class="string">&#x27;mysql_native_password&#x27;</span> <span class="variable constant_">AS</span> <span class="string">&#x27;*THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE&#x27;</span> <span class="variable constant_">REQUIRE</span> <span class="variable constant_">NONE</span> <span class="variable constant_">PASSWORD</span> <span class="variable constant_">EXPIRE</span> <span class="variable constant_">DEFAULT</span> <span class="variable constant_">ACCOUNT</span> <span class="variable constant_">LOCK</span>;</span><br><span class="line"><span class="variable constant_">GRANT</span> <span class="variable constant_">SELECT</span> <span class="variable constant_">ON</span> <span class="string">`sys`</span>.<span class="string">`sys_config`</span> <span class="variable constant_">TO</span> <span class="string">&#x27;mysql.sys&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="variable constant_">GRANT</span> <span class="variable constant_">TRIGGER</span> <span class="variable constant_">ON</span> <span class="string">`sys`</span>.* <span class="variable constant_">TO</span> <span class="string">&#x27;mysql.sys&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="variable constant_">GRANT</span> <span class="variable constant_">USAGE</span> <span class="variable constant_">ON</span> *.* <span class="variable constant_">TO</span> <span class="string">&#x27;mysql.sys&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">-- <span class="title class_">Grants</span> <span class="keyword">for</span> <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;10.0.0.%&#x27;</span></span><br><span class="line"><span class="variable constant_">CREATE</span> <span class="variable constant_">USER</span> <span class="variable constant_">IF</span> <span class="variable constant_">NOT</span> <span class="variable constant_">EXISTS</span> <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;10.0.0.%&#x27;</span>;</span><br><span class="line"><span class="variable constant_">ALTER</span> <span class="variable constant_">USER</span> <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;10.0.0.%&#x27;</span> <span class="variable constant_">IDENTIFIED</span> <span class="variable constant_">WITH</span> <span class="string">&#x27;mysql_native_password&#x27;</span> <span class="variable constant_">AS</span> <span class="string">&#x27;*23AE809DDACAF96AF0FD78ED04B6A265E05AA257&#x27;</span> <span class="variable constant_">REQUIRE</span> <span class="variable constant_">NONE</span> <span class="variable constant_">PASSWORD</span> <span class="variable constant_">EXPIRE</span> <span class="variable constant_">DEFAULT</span> <span class="variable constant_">ACCOUNT</span> <span class="variable constant_">UNLOCK</span>;</span><br><span class="line"><span class="variable constant_">GRANT</span> <span class="variable constant_">REPLICATION</span> <span class="variable constant_">SLAVE</span> <span class="variable constant_">ON</span> *.* <span class="variable constant_">TO</span> <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;10.0.0.%&#x27;</span>;</span><br><span class="line">-- <span class="title class_">Grants</span> <span class="keyword">for</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;10.0.0.%&#x27;</span></span><br><span class="line"><span class="variable constant_">CREATE</span> <span class="variable constant_">USER</span> <span class="variable constant_">IF</span> <span class="variable constant_">NOT</span> <span class="variable constant_">EXISTS</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;10.0.0.%&#x27;</span>;</span><br><span class="line"><span class="variable constant_">ALTER</span> <span class="variable constant_">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;10.0.0.%&#x27;</span> <span class="variable constant_">IDENTIFIED</span> <span class="variable constant_">WITH</span> <span class="string">&#x27;mysql_native_password&#x27;</span> <span class="variable constant_">AS</span> <span class="string">&#x27;*23AE809DDACAF96AF0FD78ED04B6A265E05AA257&#x27;</span> <span class="variable constant_">REQUIRE</span> <span class="variable constant_">NONE</span> <span class="variable constant_">PASSWORD</span> <span class="variable constant_">EXPIRE</span> <span class="variable constant_">DEFAULT</span> <span class="variable constant_">ACCOUNT</span> <span class="variable constant_">UNLOCK</span>;</span><br><span class="line"><span class="variable constant_">GRANT</span> <span class="variable constant_">ALL</span> <span class="variable constant_">PRIVILEGES</span> <span class="variable constant_">ON</span> *.* <span class="variable constant_">TO</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;10.0.0.%&#x27;</span>;</span><br><span class="line">-- <span class="title class_">Grants</span> <span class="keyword">for</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line"><span class="variable constant_">CREATE</span> <span class="variable constant_">USER</span> <span class="variable constant_">IF</span> <span class="variable constant_">NOT</span> <span class="variable constant_">EXISTS</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="variable constant_">ALTER</span> <span class="variable constant_">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="variable constant_">IDENTIFIED</span> <span class="variable constant_">WITH</span> <span class="string">&#x27;mysql_native_password&#x27;</span> <span class="variable constant_">AS</span> <span class="string">&#x27;*23AE809DDACAF96AF0FD78ED04B6A265E05AA257&#x27;</span> <span class="variable constant_">REQUIRE</span> <span class="variable constant_">NONE</span> <span class="variable constant_">PASSWORD</span> <span class="variable constant_">EXPIRE</span> <span class="variable constant_">DEFAULT</span> <span class="variable constant_">ACCOUNT</span> <span class="variable constant_">UNLOCK</span>;</span><br><span class="line"><span class="variable constant_">GRANT</span> <span class="variable constant_">ALL</span> <span class="variable constant_">PRIVILEGES</span> <span class="variable constant_">ON</span> *.* <span class="variable constant_">TO</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="variable constant_">WITH</span> <span class="variable constant_">GRANT</span> <span class="variable constant_">OPTION</span>;</span><br><span class="line"><span class="variable constant_">GRANT</span> <span class="variable constant_">PROXY</span> <span class="variable constant_">ON</span> <span class="string">&#x27;&#x27;</span>@<span class="string">&#x27;&#x27;</span> <span class="variable constant_">TO</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="variable constant_">WITH</span> <span class="variable constant_">GRANT</span> <span class="variable constant_">OPTION</span>;</span><br></pre></td></tr></table></figure>



<h4 id="2-5-pt-slave-find-æ˜¾ç¤ºä¸»ä»ç»“æ„-å¯äº†è§£ä¸‹ORCH"><a href="#2-5-pt-slave-find-æ˜¾ç¤ºä¸»ä»ç»“æ„-å¯äº†è§£ä¸‹ORCH" class="headerlink" title="2.5Â Â pt-slave-findÂ Â æ˜¾ç¤ºä¸»ä»ç»“æ„ (å¯äº†è§£ä¸‹ORCH)"></a>2.5Â Â pt-slave-findÂ Â æ˜¾ç¤ºä¸»ä»ç»“æ„ (å¯äº†è§£ä¸‹ORCH)</h4><p>[root@db01 tmp]# Â  <code>pt-slave-find -h10.0.0.51 Â -P3307 -uchecksum -pchecksum</code>Â </p>
<h4 id="2-6-ç›‘æ§ä¸»ä»å»¶æ—¶"><a href="#2-6-ç›‘æ§ä¸»ä»å»¶æ—¶" class="headerlink" title="2.6Â Â ç›‘æ§ä¸»ä»å»¶æ—¶"></a>2.6Â Â ç›‘æ§ä¸»ä»å»¶æ—¶</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">2.6</span>ç›‘æ§ä¸»ä»å»¶æ—¶è‡ªå¸¦åˆ¤å®šæ–¹æ³•:</span><br><span class="line">show slave status \G</span><br><span class="line">second _behind_master===&gt; ä»åº“sQrå›æ”¾çš„<span class="title class_">Ts</span>-ä¸»ä»æ‰§è¡Œæ˜¯çš„<span class="title class_">Ts</span>-ä¸»ä»çš„æ—¶é—´å·®å¼‚(ä¸»ä»ç³»ç»Ÿæ—¶é—´å»¶æ—¶ä¼šè‡ªåŠ¨è¡¥å¿)</span><br><span class="line">exec_master_log_pos ---&gt; å¼‚æ­¥å¤åˆ¶è¾ƒå‡†ç¡®/ ä½†<span class="variable constant_">SQL</span>å¤šçº¿ç¨‹å›æ”¾ å¦‚: loigcal_colck</span><br></pre></td></tr></table></figure>




    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/mysql/" rel="tag"><i class="fa fa-tag"></i> mysql</a>
              <a href="/tags/%E4%BC%98%E5%8C%96/" rel="tag"><i class="fa fa-tag"></i> ä¼˜åŒ–</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/07/15/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/" rel="prev" title="å­˜å‚¨å¼•æ“">
      <i class="fa fa-chevron-left"></i> å­˜å‚¨å¼•æ“
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/07/15/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%20%E4%B8%8B/" rel="next" title="åˆ†å¸ƒå¼æ¶æ„ä¸‹">
      åˆ†å¸ƒå¼æ¶æ„ä¸‹ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0-%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF"><span class="nav-number">1.</span> <span class="nav-text">0. ä¼˜åŒ–æ€è·¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E7%A1%AC%E4%BB%B6%E5%B1%82%E9%9D%A2%E4%BC%98%E5%8C%96"><span class="nav-number">2.</span> <span class="nav-text">1.ç¡¬ä»¶å±‚é¢ä¼˜åŒ–</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E7%B3%BB%E7%BB%9F%E5%B1%82%E9%9D%A2%E4%BC%98%E5%8C%96"><span class="nav-number">3.</span> <span class="nav-text">2.ç³»ç»Ÿå±‚é¢ä¼˜åŒ–</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC%E9%80%89%E6%8B%A9"><span class="nav-number">4.</span> <span class="nav-text">3. æ•°æ®åº“ç‰ˆæœ¬é€‰æ‹©</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%F0%9F%92%96%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%89%E5%B1%82%E7%BB%93%E6%9E%84%E5%8F%8A%E6%A0%B8%E5%BF%83%E5%8F%82%E6%95%B0%E4%BC%98%E5%8C%96"><span class="nav-number">5.</span> <span class="nav-text">4.ğŸ’–æ•°æ®åº“ä¸‰å±‚ç»“æ„åŠæ ¸å¿ƒå‚æ•°ä¼˜åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E8%BF%9E%E6%8E%A5%E5%B1%82"><span class="nav-number">5.1.</span> <span class="nav-text">4.1 è¿æ¥å±‚</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-Server%E5%B1%82"><span class="nav-number">5.2.</span> <span class="nav-text">4.2 Serverå±‚</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E5%B1%82"><span class="nav-number">5.3.</span> <span class="nav-text">4.3 å­˜å‚¨å¼•æ“å±‚</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-%E5%A4%8D%E5%88%B6"><span class="nav-number">5.4.</span> <span class="nav-text">4.4 å¤åˆ¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-%E5%85%B6%E5%AE%83"><span class="nav-number">5.5.</span> <span class="nav-text">4.5 å…¶å®ƒ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83"><span class="nav-number">6.</span> <span class="nav-text">5.å¼€å‘è§„èŒƒ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E5%AD%97%E6%AE%B5%E8%A7%84%E8%8C%83"><span class="nav-number">6.1.</span> <span class="nav-text">5.1 å­—æ®µè§„èŒƒ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-SQL%E8%AF%AD%E5%8F%A5%E8%A7%84%E8%8C%83"><span class="nav-number">6.2.</span> <span class="nav-text">5.2 SQLè¯­å¥è§„èŒƒ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96"><span class="nav-number">7.</span> <span class="nav-text">6. ç´¢å¼•ä¼˜åŒ–</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E9%94%81%E4%BC%98%E5%8C%96%E2%9C%A8%E2%9C%A8%E2%9C%A8"><span class="nav-number">8.</span> <span class="nav-text">7.é”ä¼˜åŒ–âœ¨âœ¨âœ¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-%E5%85%A8%E5%B1%80%E9%94%81-Global-Read-lock"><span class="nav-number">8.1.</span> <span class="nav-text">7.1 å…¨å±€é” Global Read lock</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-%E4%BB%8B%E7%BB%8D"><span class="nav-number">8.1.1.</span> <span class="nav-text">a. ä»‹ç»</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-%E6%A3%80%E6%B5%8B%E6%96%B9%E6%B3%95%F0%9F%95%B5%EF%B8%8F%E2%80%8D%E2%99%82%EF%B8%8F"><span class="nav-number">8.1.2.</span> <span class="nav-text">b. æ£€æµ‹æ–¹æ³•ğŸ•µï¸â€â™‚ï¸</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%8F%E5%85%B8%E6%95%85%E9%9A%9C%E6%A1%88%E4%BE%8B1%EF%BC%9A5-7-xtrabackup-x2F-mysqldump%E5%A4%87%E4%BB%BD%E6%97%B6%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%BA%E7%8E%B0hang%E7%8A%B6%E6%80%81%EF%BC%8C%E6%89%80%E6%9C%89%E4%BF%AE%E6%94%B9%E6%9F%A5%E8%AF%A2%E9%83%BD%E4%B8%8D%E8%83%BD%E8%BF%9B%E8%A1%8C"><span class="nav-number">8.1.3.</span> <span class="nav-text">ç»å…¸æ•…éšœæ¡ˆä¾‹1ï¼š5.7 xtrabackup&#x2F;mysqldumpå¤‡ä»½æ—¶æ•°æ®åº“å‡ºç°hangçŠ¶æ€ï¼Œæ‰€æœ‰ä¿®æ”¹æŸ¥è¯¢éƒ½ä¸èƒ½è¿›è¡Œ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%85%E9%9A%9C%E6%A1%88%E4%BE%8B2%EF%BC%9A-5-7%E7%89%88%E6%9C%AC-innobackupex%E5%A4%87%E4%BB%BD%E5%85%A8%E5%BA%93%EF%BC%8C%E8%BF%9B%E7%A8%8B%E6%AD%BB%E4%BA%86%EF%BC%8Cmysql%E9%87%8C%E5%B0%B1%E6%98%AF%E5%85%A8%E5%BA%93%E8%AF%BB%E9%94%81%EF%BC%8C%E5%90%8E%E8%BE%B9insert-%E5%85%A8%E9%98%BB%E5%A1%9E%E4%BA%86"><span class="nav-number">8.1.4.</span> <span class="nav-text">æ•…éšœæ¡ˆä¾‹2ï¼š 5.7ç‰ˆæœ¬ Â innobackupexå¤‡ä»½å…¨åº“ï¼Œè¿›ç¨‹æ­»äº†ï¼Œmysqlé‡Œå°±æ˜¯å…¨åº“è¯»é”ï¼Œåè¾¹insert å…¨é˜»å¡äº†</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-row-lock-wait-%E9%94%81%E7%AD%89%E5%BE%85"><span class="nav-number">8.2.</span> <span class="nav-text">7.2 row lock wait é”ç­‰å¾…</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-%E4%BB%8B%E7%BB%8D-1"><span class="nav-number">8.2.1.</span> <span class="nav-text">a.ä»‹ç»</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-%E8%A1%8C%E9%94%81%E7%9B%91%E6%8E%A7%E5%8F%8A%E5%88%86%E6%9E%90%F0%9F%95%B5%EF%B8%8F%E2%80%8D%E2%99%82%EF%B8%8F"><span class="nav-number">8.2.2.</span> <span class="nav-text">b. è¡Œé”ç›‘æ§åŠåˆ†æğŸ•µï¸â€â™‚ï¸</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#c-%E4%BC%98%E5%8C%96%E6%96%B9%E5%90%91"><span class="nav-number">8.2.3.</span> <span class="nav-text">c. ä¼˜åŒ–æ–¹å‘</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%85%E9%9A%9C%E6%A1%88%E4%BE%8B3-16C-top-CPU%E4%BD%BF%E7%94%A8%E6%80%BB%E9%87%8F-1200-1300-%E5%B9%B3%E5%9D%87-80-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">8.2.4.</span> <span class="nav-text">æ•…éšœæ¡ˆä¾‹3Â : Â 16C Â  Â top Â CPUä½¿ç”¨æ€»é‡ 1200%-1300, å¹³å‡ 80%+ Â  MySQLæ•°æ®åº“æœåŠ¡å™¨</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-%E6%9E%B6%E6%9E%84%E4%BC%98%E5%8C%96"><span class="nav-number">9.</span> <span class="nav-text">8.æ¶æ„ä¼˜åŒ–</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-%E5%AE%89%E5%85%A8%E4%BC%98%E5%8C%96"><span class="nav-number">10.</span> <span class="nav-text">9.å®‰å…¨ä¼˜åŒ–</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D"><span class="nav-number">11.</span> <span class="nav-text">10.å¸¸ç”¨å·¥å…·ä»‹ç»</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81-PT%EF%BC%88percona-toolkits%EF%BC%89%E5%B7%A5%E5%85%B7%E7%9A%84%E5%BA%94%E7%94%A8"><span class="nav-number">11.1.</span> <span class="nav-text">ä¸€ã€ PTï¼ˆpercona-toolkitsï¼‰å·¥å…·çš„åº”ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-pt-archiver-%E5%BD%92%E6%A1%A3%E8%A1%A8"><span class="nav-number">11.1.1.</span> <span class="nav-text">2.1 pt-archiver å½’æ¡£è¡¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-pt-osc-%E4%BF%AE%E6%94%B9%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="nav-number">11.1.2.</span> <span class="nav-text">2.2 pt-osc ä¿®æ”¹è¡¨ç»“æ„</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-pt-table-checksum-%E6%A0%A1%E9%AA%8C%E4%B8%BB%E4%BB%8E%E6%95%B0%E6%8D%AE"><span class="nav-number">11.1.3.</span> <span class="nav-text">2.3 pt-table-checksum æ ¡éªŒä¸»ä»æ•°æ®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-pt-table-sync-%E4%BF%AE%E5%A4%8D%E4%B8%BB%E4%BB%8E%E6%95%B0%E6%8D%AE"><span class="nav-number">11.1.4.</span> <span class="nav-text">2.4 pt-table-sync ä¿®å¤ä¸»ä»æ•°æ®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-pt-show-grants-%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93%E7%94%A8%E6%88%B7%E7%9A%84%E6%96%B9%E6%B3%95-%E2%9C%A8"><span class="nav-number">11.1.5.</span> <span class="nav-text">2.5. # pt-show-grants (å¤‡ä»½æ•°æ®åº“ç”¨æˆ·çš„æ–¹æ³•)âœ¨ </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-pt-slave-find-%E6%98%BE%E7%A4%BA%E4%B8%BB%E4%BB%8E%E7%BB%93%E6%9E%84-%E5%8F%AF%E4%BA%86%E8%A7%A3%E4%B8%8BORCH"><span class="nav-number">11.1.6.</span> <span class="nav-text">2.5Â Â pt-slave-findÂ Â æ˜¾ç¤ºä¸»ä»ç»“æ„ (å¯äº†è§£ä¸‹ORCH)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6-%E7%9B%91%E6%8E%A7%E4%B8%BB%E4%BB%8E%E5%BB%B6%E6%97%B6"><span class="nav-number">11.1.7.</span> <span class="nav-text">2.6Â Â ç›‘æ§ä¸»ä»å»¶æ—¶</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="139"
      src="/images/custom/avatar.jpg">
  <p class="site-author-name" itemprop="name">139</p>
  <div class="site-description" itemprop="description">ä¸€ä¸ªæ™®é€šçš„JAVAå¼€å‘çš„åšå®¢</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">54</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">æµ™ICPå¤‡2023004484å·-1 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">139</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
